# 🏥 검진 설계 시스템 고도화 마스터 플랜 (Confidence & Logic)

**생성일**: 미상  
**작업일자**: 미상  
**작업내용**: 검진 설계 시스템 고도화 마스터 플랜 (Confidence & Logic)

---

## 1. 개요 (Vision)
단순한 검사 항목 나열을 넘어, **환자의 페르소나를 분석**하고, **기본/정밀/대체 검사의 논리적 층위**를 구성하며, **확실한 의학적 근거(RAG)**를 제시하여 신뢰도 높은 검진 설계를 제공한다.

---

## 2. 핵심 개선 전략 (3 Pillars)

### 🏛️ Pillar 1: 입체적 추천 로직 (Layered Recommendation)
검사를 평면적으로 나열하지 않고, **역할과 목적**에 따라 3단계로 구조화한다.

| 층위 (Layer) | 역할 | 설득 논리 (Bridge Strategy) | 예시 |
| :--- | :--- | :--- | :--- |
| **L1. 필수 기본 (Must)** | 국가검진/기본항목 | **"어차피 하는 검사, OO님은 여기를 더 보세요."**<br>과거 이력/가족력 기반 집중 점검 포인트 제시. | "혈압은 기본 항목이지만, 가족력이 있으니 수치 변화를 꼼꼼히 챙겨야 합니다." |
| **L2. 정밀 보완 (Better)** | 비급여/옵션 | **"기본 검사의 사각지대를 메우세요."**<br>기본 검사로는 알 수 없는 리스크(Gap)를 지적하고 해결책 제시. | "혈압계로는 혈관 속을 못 봅니다. 경동맥 초음파로 동맥경화 여부를 직접 확인하세요." |
| **L3. 대체/심화 (Alternative)** | 신기술/대체재 | **"더 편하고 정확한 방법이 있습니다."**<br>고통스럽거나 번거로운 검사의 대안 제시. | "내시경이 힘드셨다면, 분변 DNA 검사로 간편하게 대장암 위험을 확인해보세요." |

### 👤 Pillar 2: 페르소나 기반 화법 (Persona-driven Tone)
Step 1에서 환자의 성향을 정의하고, Step 2에서 그에 맞는 화법을 구사한다.

| 페르소나 유형 | 특징 | 공략 포인트 | 화법 예시 |
| :--- | :--- | :--- | :--- |
| **데이터 중시형 (Analyst)** | 수치, 근거 민감 | **RAG 근거/통계** | "학회 가이드라인에 따르면..." |
| **불안/염려형 (Worrier)** | 가족력/증상 걱정 | **안심/조기발견** | "이것만 확인하면 안심하실 수 있습니다." |
| **효율 추구형 (Pragmatist)** | 시간/비용 민감 | **가성비/핵심** | "딱 필요한 이것만 챙기세요." |

### 💎 Pillar 3: 근거의 시각화 (Visible Evidence)
AI의 말을 믿게 하기 위해, **RAG가 찾아온 '진짜 문서'**를 눈앞에 보여준다.

*   **UI 요소**: `[📄 근거 보기]` 버튼, 신뢰도 뱃지 (⭐⭐⭐), 출처(Source) 명시.
*   **인터랙션**: 버튼 클릭 시 → 해당 가이드라인 원문/페이지가 담긴 모달 팝업.

---

## 3. 단계별 실행 계획 (Roadmap)

### Phase 1: 페르소나 및 층위 구조화 (Backend)
1.  **Step 1 프롬프트 개선**:
    *   `persona_type` 도출 로직 추가 (데이터형/불안형/효율형).
    *   GFR 등 수치 해석 기준(Guideline) 정교화 (과잉 해석 방지).
2.  **Step 2-2 프롬프트 개선**:
    *   `Priority 2, 3`을 `L2(정밀)`, `L3(대체)` 개념으로 명확히 분리.
    *   추천 항목 선정 시 `hospital_recommended` 우선순위 강화 및 페르소나별 화법 적용.

### Phase 2: 데이터 파이프라인 최적화 (Backend)
1.  **Evidence ID 매핑**: RAG 결과(`rag_evidences`)와 추천 항목(`strategies`)을 연결하는 `evidence_id` 시스템 도입.
2.  **추천 로직 강화**: 문진(증상) 및 사용자 선택(Concerns)이 추천 결과에 강력하게 반영되도록 가중치 로직 추가.

### Phase 3: 프론트엔드 신뢰도 UX 구현 (Frontend)
1.  **근거 모달 구현**: `CheckupDesignResult.tsx` 수정하여 `rag_evidences`를 모달로 표시.
2.  **레이아웃 개선**: "기본 검진 vs 정밀 옵션"을 시각적으로 구분하여 보여주는 UI 적용.

---

## 4. 검증 시나리오

1.  **페르소나 테스트**: 동일 데이터라도 "불안형" vs "효율형"일 때 멘트가 달라지는지 확인.
2.  **논리 구조 테스트**: "기본 검사로 충분하다"가 아니라 "기본 검사는 이게 부족하니 이걸 추가하자"는 논리가 나오는지 확인.
3.  **근거 팝업 테스트**: 화면에서 `[근거]` 버튼을 눌렀을 때, 실제 가이드라인 내용이 뜨는지 확인.

---

**승인 요청**: 위 계획대로 **Phase 1 (페르소나 및 층위 구조화)**부터 작업을 시작하시겠습니까?



