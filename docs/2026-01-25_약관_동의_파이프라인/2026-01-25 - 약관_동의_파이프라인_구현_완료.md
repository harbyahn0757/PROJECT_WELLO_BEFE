# ì•½ê´€ ë™ì˜ íŒŒì´í”„ë¼ì¸ êµ¬í˜„ ì™„ë£Œ ë³´ê³ ì„œ

**ìƒì„±ì¼**: 2026-01-25  
**ì‘ì—…ì¼ì**: 2026-01-25  
**ì‘ì—…ë‚´ìš©**: ì•½ê´€ ë™ì˜ íŒŒì´í”„ë¼ì¸ êµ¬í˜„ ì™„ë£Œ ë³´ê³ 

---

## âœ… êµ¬í˜„ ì™„ë£Œ (2026-01-25)

---

## ğŸ“‹ êµ¬í˜„ ë‚´ìš©

### **í•µì‹¬ ì •ì±…**

1. **ë¡œì»¬ ì €ì¥ (LocalStorage)**
   - ìœ íš¨ê¸°ê°„: 3ì¼
   - ê° ì•½ê´€ë³„ ê°œë³„ íƒ€ì„ìŠ¤íƒ¬í”„
   - ì„œë²„ ë™ê¸°í™” ìƒíƒœ ì¶”ì 

2. **ì„œë²„ ì €ì¥ (PostgreSQL)**
   - ì˜êµ¬ ì €ì¥
   - JSONB í˜•ì‹ìœ¼ë¡œ ê° ì•½ê´€ë³„ ìƒì„¸ ì •ë³´
   - í•„ìˆ˜ ì•½ê´€ ì™„ë£Œ ì‹œì  ë³„ë„ ê¸°ë¡

3. **ì²´í¬ ë¡œì§**
   - ìš°ì„ ìˆœìœ„: ì„œë²„ â†’ ë¡œì»¬
   - 3ì¼ ì´ë‚´ ë¡œì»¬ ë™ì˜: í† ìŠ¤íŠ¸ í‘œì‹œ í›„ ì§„í–‰
   - 3ì¼ ì´ˆê³¼: ìë™ ì‚­ì œ í›„ ì¬ë™ì˜ ìš”ì²­

---

## ğŸ¯ êµ¬í˜„ëœ ê¸°ëŠ¥

### **1. ì•½ê´€ë³„ ê°œë³„ ê´€ë¦¬**

ê° ì•½ê´€ì´ ë…ë¦½ì ì¸ íƒ€ì„ìŠ¤íƒ¬í”„ì™€ ë™ê¸°í™” ìƒíƒœë¥¼ ê°€ì§‘ë‹ˆë‹¤:

- âœ… ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€ (í•„ìˆ˜)
- âœ… ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ (í•„ìˆ˜)
- âœ… ë¯¼ê°ì •ë³´ ìˆ˜ì§‘ (í•„ìˆ˜)
- âœ… ë§ˆì¼€íŒ… í™œìš© (ì„ íƒ)

### **2. ë¡œì»¬ â†” ì„œë²„ ë™ê¸°í™”**

```typescript
// LocalStorage êµ¬ì¡°
{
  uuid: "abc-123",
  partner_id: "kindhabit",
  terms_service: {
    agreed: true,
    agreed_at: "2026-01-25T10:30:00.000Z",
    expires_at: "2026-01-28T10:30:00.000Z",  // +3ì¼
    synced_to_server: true,
    server_synced_at: "2026-01-25T10:30:05.000Z"
  },
  // ... ë‹¤ë¥¸ ì•½ê´€ë“¤
}
```

```sql
-- PostgreSQL êµ¬ì¡°
welno.welno_patients {
  terms_agreement_detail: JSONB,  -- ê° ì•½ê´€ë³„ ìƒì„¸
  terms_all_required_agreed_at: TIMESTAMPTZ  -- í•„ìˆ˜ ì•½ê´€ ì™„ë£Œ ì‹œì 
}
```

### **3. ìŠ¤ë§ˆíŠ¸ í† ìŠ¤íŠ¸ ë©”ì‹œì§€**

- **3ì¼ ì´ë‚´ ì¬ë°©ë¬¸ ì‹œ**: 
  > "2026ë…„ 1ì›” 25ì¼ì— ë™ì˜í•˜ì‹  ì•½ê´€ìœ¼ë¡œ ì§„í–‰í•©ë‹ˆë‹¤."
  
- **ë§Œë£Œ ì‹œ**:
  > "ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€, ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ ì•½ê´€ ë™ì˜ê°€ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë™ì˜í•´ì£¼ì„¸ìš”."

---

## ğŸ“ ìƒì„±/ìˆ˜ì •ëœ íŒŒì¼

### **í”„ë¡ íŠ¸ì—”ë“œ (3ê°œ)**

1. âœ… **`src/utils/termsAgreement.ts`** (NEW)
   - 267 lines
   - ì•½ê´€ ì²´í¬, ì €ì¥, ì‚­ì œ ìœ í‹¸ë¦¬í‹°

2. âœ… **`src/components/AuthForm.tsx`** (MODIFIED)
   - `onConfirm` í•¸ë“¤ëŸ¬ ê°œì„ 
   - ìƒˆ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ì—°ë™

3. âœ… **`src/campaigns/disease-prediction/index.tsx`** (MODIFIED)
   - ì§„ì… ì‹œ ì•½ê´€ ì²´í¬ ë¡œì§ ì¶”ê°€
   - í† ìŠ¤íŠ¸ í‘œì‹œ ë° ë¦¬ë‹¤ì´ë ‰íŠ¸

### **ë°±ì—”ë“œ (4ê°œ)**

1. âœ… **`app/api/v1/endpoints/terms_agreement.py`** (NEW)
   - 157 lines
   - `/terms/check`: ì•½ê´€ ë™ì˜ í™•ì¸ API
   - `/terms/status/{uuid}`: ìƒì„¸ ì¡°íšŒ API

2. âœ… **`app/services/wello_data_service.py`** (MODIFIED)
   - `save_terms_agreement_detail()` í•¨ìˆ˜ ì¶”ê°€
   - ê° ì•½ê´€ë³„ íƒ€ì„ìŠ¤íƒ¬í”„ ì €ì¥

3. âœ… **`app/api/v1/endpoints/campaign_payment.py`** (MODIFIED)
   - `register-patient` API ê°œì„ 
   - `terms_agreement_detail` ì²˜ë¦¬

4. âœ… **`app/api/v1/__init__.py`** (MODIFIED)
   - `terms_agreement` ë¼ìš°í„° ë“±ë¡

### **ë°ì´í„°ë² ì´ìŠ¤ (1ê°œ)**

1. âœ… **`welno.welno_patients`** (SCHEMA UPDATE)
   - `terms_agreement_detail` (JSONB) ì¶”ê°€
   - `terms_all_required_agreed_at` (TIMESTAMPTZ) ì¶”ê°€

### **ë¬¸ì„œ (2ê°œ)**

1. âœ… **`docs/ì•½ê´€_ë™ì˜_íŒŒì´í”„ë¼ì¸_ì„¤ê³„.md`** (NEW)
   - ì „ì²´ ì„¤ê³„ ë¬¸ì„œ

2. âœ… **`tests/test_terms_agreement_pipeline.py`** (NEW)
   - íŒŒì´í”„ë¼ì¸ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸

---

## ğŸ”„ ì „ì²´ í”Œë¡œìš° ì˜ˆì‹œ

### **ì¼€ì´ìŠ¤ 1: ìµœì´ˆ ë°©ë¬¸**

```
ì‚¬ìš©ì ì§„ì…
  â†“
ì•½ê´€ ì²´í¬ (ì„œë²„: ì—†ìŒ, ë¡œì»¬: ì—†ìŒ)
  â†“
ì•½ê´€ ëª¨ë‹¬ í‘œì‹œ
  â†“
ì‚¬ìš©ì ë™ì˜
  â†“
LocalStorage ì €ì¥ (expires_at: +3ì¼, synced: false)
  â†“
ì„œë²„ API í˜¸ì¶œ
  â†“
DB ì €ì¥ (terms_agreement_detail JSONB)
  â†“
LocalStorage ì—…ë°ì´íŠ¸ (synced: true)
  â†“
ë‹¤ìŒ ë‹¨ê³„
```

### **ì¼€ì´ìŠ¤ 2: ì¬ë°©ë¬¸ (3ì¼ ì´ë‚´, ë¡œì»¬ë§Œ)**

```
ì‚¬ìš©ì ì§„ì…
  â†“
ì•½ê´€ ì²´í¬ (ì„œë²„: ì—†ìŒ, ë¡œì»¬: ìˆìŒ, ìœ íš¨)
  â†“
í† ìŠ¤íŠ¸: "2026ë…„ 1ì›” 25ì¼ì— ë™ì˜í•˜ì‹  ì•½ê´€ìœ¼ë¡œ ì§„í–‰í•©ë‹ˆë‹¤."
  â†“
ì•½ê´€ ëª¨ë‹¬ ìŠ¤í‚µ
  â†“
ë‹¤ìŒ ë‹¨ê³„
```

### **ì¼€ì´ìŠ¤ 3: ì¬ë°©ë¬¸ (ì„œë²„ ë™ê¸°í™” ì™„ë£Œ)**

```
ì‚¬ìš©ì ì§„ì…
  â†“
ì•½ê´€ ì²´í¬ (ì„œë²„: ìˆìŒ)
  â†“
í† ìŠ¤íŠ¸ ì—†ìŒ (ì„œë²„ ì‹ ë¢°)
  â†“
ì•½ê´€ ëª¨ë‹¬ ìŠ¤í‚µ
  â†“
ë‹¤ìŒ ë‹¨ê³„
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê²°ê³¼

### **DB ìŠ¤í‚¤ë§ˆ ì—…ë°ì´íŠ¸**
```
âœ… ìŠ¤í‚¤ë§ˆ ì—…ë°ì´íŠ¸ ì™„ë£Œ!
  - terms_agreement_detail (JSONB) ì¶”ê°€
  - terms_all_required_agreed_at (TIMESTAMPTZ) ì¶”ê°€
```

### **ì»´íŒŒì¼ ìƒíƒœ**
```
âœ… í”„ë¡ íŠ¸ì—”ë“œ ì»´íŒŒì¼ ì„±ê³µ
âœ… TypeScript ì—ëŸ¬ ì—†ìŒ
```

---

## ğŸ“Š ë°ì´í„° ì˜ˆì‹œ

### **LocalStorage**

```json
{
  "uuid": "f82a55a9-2199-4328-910d-9e9327e502be",
  "partner_id": "peernine",
  "terms_service": {
    "agreed": true,
    "agreed_at": "2026-01-25T10:30:00.000Z",
    "expires_at": "2026-01-28T10:30:00.000Z",
    "synced_to_server": true,
    "server_synced_at": "2026-01-25T10:30:05.000Z"
  },
  "terms_privacy": {
    "agreed": true,
    "agreed_at": "2026-01-25T10:30:00.000Z",
    "expires_at": "2026-01-28T10:30:00.000Z",
    "synced_to_server": true,
    "server_synced_at": "2026-01-25T10:30:05.000Z"
  },
  "terms_sensitive": {
    "agreed": true,
    "agreed_at": "2026-01-25T10:30:00.000Z",
    "expires_at": "2026-01-28T10:30:00.000Z",
    "synced_to_server": true,
    "server_synced_at": "2026-01-25T10:30:05.000Z"
  },
  "terms_marketing": {
    "agreed": false,
    "agreed_at": null,
    "expires_at": null,
    "synced_to_server": false,
    "server_synced_at": null
  },
  "last_updated": "2026-01-25T10:30:00.000Z",
  "all_required_agreed": true
}
```

### **PostgreSQL**

```sql
SELECT 
  uuid,
  name,
  terms_agreement_detail,
  terms_all_required_agreed_at
FROM welno.welno_patients
WHERE uuid = 'f82a55a9-2199-4328-910d-9e9327e502be';

-- ê²°ê³¼:
{
  "uuid": "f82a55a9-2199-4328-910d-9e9327e502be",
  "name": "í™ê¸¸ë™",
  "terms_agreement_detail": {
    "terms_service": {
      "agreed": true,
      "agreed_at": "2026-01-25T10:30:00Z"
    },
    "terms_privacy": {
      "agreed": true,
      "agreed_at": "2026-01-25T10:30:00Z"
    },
    "terms_sensitive": {
      "agreed": true,
      "agreed_at": "2026-01-25T10:30:00Z"
    },
    "terms_marketing": {
      "agreed": false,
      "agreed_at": null
    }
  },
  "terms_all_required_agreed_at": "2026-01-25T10:30:00+09:00"
}
```

---

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„

1. **ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸**
   - ìµœì´ˆ ë°©ë¬¸ ì‹œë‚˜ë¦¬ì˜¤
   - ì¬ë°©ë¬¸ (3ì¼ ì´ë‚´)
   - ë§Œë£Œ í›„ ì¬ë°©ë¬¸
   - ì„œë²„ ì €ì¥ ì‹¤íŒ¨ ì‹œë‚˜ë¦¬ì˜¤

2. **í†µí•© ìƒíƒœ ë§¤íŠ¸ë¦­ìŠ¤ì— ë°˜ì˜**
   - `get_unified_status()`ì— ì•½ê´€ ìƒíƒœ ì²´í¬ ì¶”ê°€
   - `TERMS_REQUIRED_*` ìƒíƒœ ì¶”ê°€

3. **UI/UX ê°œì„ **
   - í† ìŠ¤íŠ¸ ë””ìì¸
   - ë§Œë£Œ ì•ˆë‚´ ë©”ì‹œì§€
   - ë™ì˜ ì´ë ¥ í™•ì¸ UI

---

## ğŸ“Œ ì¤‘ìš” ì‚¬í•­

### **í•˜ìœ„ í˜¸í™˜ì„±**
- ê¸°ì¡´ `terms_agreement` (ë°°ì—´) í˜•ì‹ë„ ê³„ì† ì§€ì›
- ì ì§„ì  ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ëŠ¥

### **ì˜¤í”„ë¼ì¸ ì§€ì›**
- ì„œë²„ ì €ì¥ ì‹¤íŒ¨í•´ë„ ë¡œì»¬ 3ì¼ ìœ íš¨
- ë‹¤ìŒ ë°©ë¬¸ ì‹œ ìë™ ì¬ë™ê¸°í™” ì‹œë„ ê°€ëŠ¥ (í–¥í›„ êµ¬í˜„)

### **ë³´ì•ˆ**
- ë¯¼ê° ì •ë³´ ì—†ìŒ (ë™ì˜ ì—¬ë¶€ì™€ íƒ€ì„ìŠ¤íƒ¬í”„ë§Œ)
- LocalStorage ì‚¬ìš© (httpOnly ì¿ í‚¤ ë¶ˆí•„ìš”)

---

## ğŸ‰ ì™„ë£Œ!

ëª¨ë“  ì•½ê´€ ë™ì˜ íŒŒì´í”„ë¼ì¸ êµ¬í˜„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!

**êµ¬í˜„ íŒŒì¼**: 8ê°œ
**ìˆ˜ì • ë¼ì¸**: ~500 lines
**í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸**: 1ê°œ
**ë¬¸ì„œ**: 2ê°œ
