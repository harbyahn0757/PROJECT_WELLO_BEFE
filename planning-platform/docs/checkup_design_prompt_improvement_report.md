# 검진 설계 프롬프트 점검 및 개선 보고서

## 📋 현재 상황 분석

### 1. 현재 프롬프트의 문제점

#### ❌ 스토리텔링 부재
- **현재 상태**: 데이터 분석 중심의 나열식 구조
- **문제**: "기본 검진 → 한계 노출 → 정밀 검진 제안"의 자연스러운 흐름이 없음
- **영향**: 환자가 왜 추가 검진이 필요한지 납득하기 어려움

#### ❌ 일반검진 표현 오류
- **현재 상태**: "일반검진에 포함되어 있지만, 당신의 상황에서는 기본검진 외에 이것도 더 자세히 보는 것이 좋을 것 같습니다"
- **문제**: 일반검진을 "추천 항목"처럼 표현
- **올바른 표현**: "일반검진은 기본적으로 받으시지만, 특히 주의깊게 확인해야 할 항목이 있습니다"

#### ❌ The Bridge Strategy 미적용
- **요구사항**: Anchor(기본) → Gap(한계) → Offer(해결) 구조
- **현재**: 단순 나열식 추천
- **부재 요소**:
  - 기본 검진의 가치 인정 부족
  - 의학적 사각지대(Gap) 명확한 노출 부족
  - 자연스러운 업셀링 전환 부족

#### ❌ 맥락 연결 약함
- **현재**: "과거 검진에서 XX, 문진에서 YY, 선택 항목 ZZ" 형식의 나열
- **문제**: 각 요소가 독립적으로 제시됨
- **필요**: 통합된 스토리로 연결

### 2. 기술적 문제

#### ❌ 파일 확장자 불일치
- **파일**: `footnoteParser.ts` (에러 발생)
- **실제**: JSX 문법 사용 중
- **해결**: `.tsx`로 변경 필요

---

## 🎯 개선 포인트 (상세)

### 1. 스토리텔링 구조 강화

#### 1.1 The Bridge Strategy 적용

**현재 구조**:
```
- 과거 검진 결과 나열
- 문진 내용 나열
- 추천 항목 나열
```

**개선 구조**:
```
[1단계: 기본 검진의 재해석]
  → "올해 받으실 일반검진에서 특히 주의깊게 봐야 할 항목"
  → 기본 검진의 가치 인정 + 환자 맞춤 포인트 제시

[2단계: 의학적 사각지대(Gap) 노출]
  → "하지만 기본 검진만으로는 확인할 수 없는 한계"
  → 구체적인 의학적 한계 설명

[3단계: 정밀 검진(Upselling) 제안]
  → "따라서 이 정밀 검진으로 그 한계를 극복"
  → 투자 가치 관점의 설득
```

#### 1.2 bridging_narrative 필드 강화

**현재**:
```json
{
  "step1_basic_limit": "기본 검진의 [항목명]으로는 [한계점] 때문에 확인이 어렵습니다.",
  "step2_patient_context": "특히 환자분의 [증상/가족력]을 고려했을 때...",
  "step3_solution": "따라서 [추천 정밀검진]을 통해..."
}
```

**개선**:
```json
{
  "step1_anchor": "올해 대상이신 일반검진의 [항목명]으로 [확인 가능한 내용]을 보는 것은 매우 중요합니다.",
  "step2_gap": "하지만 [항목명]은 [구체적 한계]만 보여줄 뿐, [확인 불가능한 내용]은 알 수 없는 '반쪽짜리 확인'입니다.",
  "step3_patient_context": "특히 환자분의 [구체적 증상/가족력/이력]을 고려할 때, 이 부분을 놓치면 [구체적 위험]이 있습니다.",
  "step4_offer": "따라서 [정밀검진명]을 더해 '[확인 가능한 내용]'과 '[추가 확인 내용]'을 동시에 확인해야 완벽한 안심이 가능합니다."
}
```

#### 1.3 톤앤매너 개선

**현재**: 전문적이지만 딱딱함

**개선**:
- "비쌉니다" → "미래의 치료비보다 예방이 저렴합니다"
- "추천합니다" → "완벽한 안심을 위해 필요합니다"
- "필요합니다" → "놓치면 위험할 수 있습니다"

---

### 2. 일반검진 표현 수정

#### 2.1 프롬프트 수정

**현재 (잘못된 표현)**:
```
"일반검진에 포함되어 있지만, 당신의 상황에서는 기본검진 외에 이것도 더 자세히 보는 것이 좋을 것 같습니다."
```

**개선 (올바른 표현)**:
```
"일반검진은 기본적으로 받으시지만, 당신의 상황(과거 검진에서 XX 경계/이상, 문진에서 YY 확인, ZZ 선택)에서는 
특히 주의깊게 확인해야 할 항목이 있습니다."
```

#### 2.2 JSON 구조 수정

**현재**:
```json
{
  "basic_checkup_guide": {
    "title": "기본(국가) 검진 100% 활용하기",
    "description": "올해 받으실 기본 검진 항목 중, 환자분의 이력상 특히 주의 깊게 봐야 할 포인트입니다."
  }
}
```

**개선**:
```json
{
  "basic_checkup_guide": {
    "title": "일반검진 200% 활용 포인트",
    "description": "올해 대상이신 일반검진 항목 중, OOO님은 아래 수치들을 꼭 체크하셔야 합니다.",
    "focus_items": [
      {
        "item_name": "공복혈당 (Diabetes)",
        "why_important": "3년 전부터 수치가 95-99 사이로, 당뇨 전단계 경계선에 있습니다.",
        "check_point": "올해 수치가 100을 넘어서면 당뇨 전단계로 진단될 수 있으므로 주의깊게 확인하세요."
      }
    ]
  }
}
```

#### 2.3 UI 표현 수정

**현재**: "추천 항목" 뱃지

**개선**: "주의깊게 확인" 뱃지 또는 "필수 체크 포인트" 뱃지

---

### 3. 프롬프트 구조 개선

#### 3.1 시스템 메시지 강화

**현재**:
```
당신은 대한민국의 전문 검진 설계 의료진입니다.
```

**개선**:
```
당신은 대한민국 최고의 대학병원 검진 센터장이자, 환자의 데이터를 꿰뚫어 보는 '헬스 큐레이터'입니다.

당신의 목표는 환자에게 **"가장 효율적이고 빈틈없는 검진 플랜"**을 제안하는 것입니다.

**핵심 작성 원칙 (The Bridge Strategy):**

1. **기본 검진(국가/일반)의 존중:** 먼저 무료로 받을 수 있는 기본 검진 항목에서 환자가 '눈여겨봐야 할 수치'가 무엇인지 짚어주세요.

2. **사각지대(Gap) 조명:** 기본 검진만으로는 확인할 수 없는 '의학적 한계'를 환자의 데이터(증상, 가족력)와 연결하여 설명하세요.

3. **자연스러운 업셀링:** 그 한계를 극복하기 위해 병원의 정밀 검진(비급여 항목)이 왜 필수적인지 '투자 가치' 관점에서 설득하세요.

**톤앤매너:**
- 전문적이지만 딱딱하지 않게, 환자를 진심으로 걱정하는 신뢰감 있는 어조를 사용하세요.
- "비쌉니다" 대신 "미래의 치료비보다 예방이 저렴합니다"라는 뉘앙스를 유지하세요.
```

#### 3.2 JSON 응답 구조 개선

**추가 필드**:
```json
{
  "patient_summary": "환자의 건강 상태와 주요 리스크를 3줄로 요약 (스토리텔링 도입부)",
  
  "basic_checkup_guide": {
    "title": "일반검진 200% 활용 포인트",
    "description": "올해 대상이신 일반검진 항목 중, OOO님은 아래 수치들을 꼭 체크하셔야 합니다.",
    "focus_items": [
      {
        "item_name": "공복혈당",
        "why_important": "3년 전부터 수치가 95-99 사이로, 당뇨 전단계 경계선에 있습니다.",
        "check_point": "올해 수치가 100을 넘어서면 당뇨 전단계로 진단될 수 있으므로 주의깊게 확인하세요."
      }
    ]
  },
  
  "strategies": [
    {
      "strategy_title": "매력적인 전략 제목 (예: 침묵의 장기, 췌장까지 완벽하게)",
      "related_concern": "환자가 선택한 염려 항목 or 문진 증상",
      "priority": 1,
      "bridging_narrative": {
        "step1_anchor": "올해 대상이신 일반검진의 [항목명]으로 [확인 가능한 내용]을 보는 것은 매우 중요합니다.",
        "step2_gap": "하지만 [항목명]은 [구체적 한계]만 보여줄 뿐, [확인 불가능한 내용]은 알 수 없는 '반쪽짜리 확인'입니다.",
        "step3_patient_context": "특히 환자분의 [구체적 증상/가족력/이력]을 고려할 때, 이 부분을 놓치면 [구체적 위험]이 있습니다.",
        "step4_offer": "따라서 [정밀검진명]을 더해 '[확인 가능한 내용]'과 '[추가 확인 내용]'을 동시에 확인해야 완벽한 안심이 가능합니다."
      },
      "recommended_item": {
        "name": "복부 조영 CT",
        "category": "소화기 정밀",
        "is_upselling": true,
        "reason_summary": "초음파로 보기 힘든 췌장/담낭의 미세 병변 확인",
        "hospital_advantage": "본 병원의 128채널 CT로 1mm 크기의 병변도 찾아낼 수 있습니다."
      }
    }
  ],
  
  "doctor_comment": "마무리 인사 및 검진 독려 메시지"
}
```

---

### 4. 기술적 개선 사항

#### 4.1 파일 확장자 수정

**문제**: `footnoteParser.ts`에서 JSX 문법 사용

**해결**:
1. 파일명을 `footnoteParser.tsx`로 변경
2. 또는 `.ts` 파일에서 JSX 제거하고 문자열 반환으로 변경

**권장**: `.tsx`로 변경 (React 컴포넌트 반환하므로)

#### 4.2 프롬프트 예시 강화

**추가 필요**:
- bridging_narrative 작성 예시
- 일반검진 표현 예시
- 스토리텔링 톤앤매너 예시

---

## 📊 개선 우선순위

### 🔴 긴급 (즉시 수정)

1. **파일 확장자 수정** (`footnoteParser.ts` → `.tsx`)
2. **일반검진 표현 수정** (프롬프트 내 모든 "추천" 표현 → "주의깊게 확인")
3. **시스템 메시지에 The Bridge Strategy 추가**

### 🟡 중요 (이번 주 내)

4. **bridging_narrative 필드 구조 개선** (4단계 구조)
5. **JSON 응답 구조에 basic_checkup_guide 추가**
6. **프롬프트 예시 강화**

### 🟢 개선 (다음 주)

7. **톤앤매너 가이드라인 상세화**
8. **UI 표현 개선** (뱃지, 카드 디자인)
9. **테스트 및 검증**

---

## 🎨 UI/UX 개선 제안

### 1. 화면 구성

```
[상단] basic_checkup_guide 섹션
  → "우리는 당신의 기본 권리(무료 검진)부터 챙겨줍니다" 인상

[중간] 전환 효과
  → "하지만 이것만으로는 부족합니다" 섹션
  → strategies의 bridging_narrative 내용을 카드 형태로 표시

[하단] 정밀 검진 제안
  → is_upselling: true인 항목에 "의사 강력 추천" 또는 "가족력 맞춤 솔루션" 태그
```

### 2. 뱃지 시스템

- **일반검진 항목**: "주의깊게 확인" (주황색)
- **정밀 검진**: "의사 강력 추천" (빨간색)
- **선택 검진**: "예방 차원" (회색)

### 3. 카드 디자인

각 strategy 카드:
- **상단**: strategy_title (큰 글씨)
- **중간**: bridging_narrative 4단계 (단계별 아이콘 + 텍스트)
- **하단**: recommended_item 정보

---

## 📝 수정 체크리스트

### 백엔드 (checkup_design_prompt.py)

- [ ] 시스템 메시지에 The Bridge Strategy 추가
- [ ] 일반검진 표현 수정 (모든 "추천" → "주의깊게 확인")
- [ ] bridging_narrative 필드 구조 개선 (4단계)
- [ ] JSON 응답 구조에 basic_checkup_guide 추가
- [ ] 프롬프트 예시 강화
- [ ] 톤앤매너 가이드라인 추가

### 프론트엔드

- [ ] `footnoteParser.ts` → `.tsx` 파일명 변경
- [ ] UI에서 일반검진 표현 수정
- [ ] basic_checkup_guide 섹션 UI 추가
- [ ] bridging_narrative 4단계 표시 UI 추가
- [ ] 뱃지 시스템 개선
- [ ] 카드 디자인 개선

---

## 🔍 검증 방법

### 1. 프롬프트 검증

- [ ] AI 응답에 basic_checkup_guide 포함 여부
- [ ] bridging_narrative 4단계 구조 확인
- [ ] 일반검진 표현이 "주의깊게 확인"으로 변경되었는지
- [ ] 스토리텔링 흐름이 자연스러운지

### 2. UI 검증

- [ ] 파일 확장자 수정 후 빌드 에러 해결 확인
- [ ] 각주 파싱 정상 동작 확인
- [ ] basic_checkup_guide 섹션 표시 확인
- [ ] bridging_narrative 카드 표시 확인

---

## 📌 다음 단계

1. **즉시 수정**: 파일 확장자 및 일반검진 표현
2. **프롬프트 개선**: The Bridge Strategy 적용
3. **UI 개선**: 새로운 섹션 및 카드 디자인
4. **테스트**: 실제 데이터로 검증

