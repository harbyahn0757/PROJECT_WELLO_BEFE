# WELNO 플랫폼 기술 역량 답변서

> 메디링스 데이터사이언스 기술 컨설팅 질의에 대한 답변

---

## 1. 데이터 연동 및 통합 (Data Integration)

### 핵심 질문: 검진-상담-만족도 데이터가 하나의 UUID로 통합 분석 가능한가?

**현재 상태: 부분적으로 가능 (개선 진행 중)**

| 데이터 소스 | 저장 위치 | 사용자 식별 필드 | 연결 키 |
|------------|----------|----------------|--------|
| 검진 데이터 | partnerData (JSON) | `patient.name` + `patient.birth_date` | `web_app_key` |
| 상담 (RAG Chat) | `tb_partner_rag_chat_log` (PostgreSQL) | `user_uuid` | `web_app_key` |
| 만족도 조사 | `tb_survey_responses_dynamic` (PostgreSQL) | `respondent_uuid` | `web_app_key` |
| 행동 이벤트 | `medilinx-logs-data` (Elasticsearch) | `data.user.webAppKey` | `web_app_key` |

**공통 식별자: `web_app_key`**
- 파트너사(Jerry/Kraken)가 환자별 고정값으로 발급
- 채팅 위젯과 설문 위젯 모두 동일한 `web_app_key`를 전달
- ES 이벤트에도 `webAppKey`로 기록

### 상세 질문 답변

**"특정 수치가 나빠서 상담을 길게 한 사람이 병원 만족도가 낮은지" 추적 가능한가?**

> **현재**: 3개 테이블의 사용자 식별 필드가 다르게 설계되어 직접 JOIN이 불가.
> **개선 후**: `web_app_key`로 통합되면 아래 분석이 가능해짐:
> - 검진 이상 항목 수 vs 상담 시간(메시지 수) 상관관계
> - 상담 깊이(conversation_depth) vs 만족도 점수 교차분석
> - 위험 태그 보유 환자의 만족도 평균 비교

**병원 CRM(EHR/EMR) 연동 범위와 업데이트 주기**

> - **연동 데이터**: 검진 수치 (혈압, 혈당, 콜레스테롤, BMI 등 15개 핵심 항목), 환자 기본정보 (이름, 생년월일, 성별, 전화번호)
> - **전달 방식**: 파트너사가 `welnoPartnerDataJson`으로 위젯 호출 시 전달 (실시간)
> - **업데이트 주기**: 환자가 위젯에 접속할 때마다 최신 데이터 전달 (push 방식)
> - **제한사항**: EHR/EMR 직접 연동은 아니며, 파트너사 중간 레이어를 통한 간접 연동

---

## 2. 태깅 및 라벨링 로직 (Tagging & Labeling Logic)

### 핵심 질문: Rule-based인가, LLM 기반인가?

**하이브리드 방식: LLM 기반 + Rule-based 폴백**

```
상담 완료
  ↓
[1차] Google Gemini Flash Lite (gemini-2.0-flash-lite)
  → 구조화된 프롬프트로 13개 태깅 필드 생성
  ↓ (실패 시)
[2차] Rule-based 키워드 매칭
  → 15개 건강 토픽 사전 + 감정 키워드 사전
  ↓
최종 태그 저장 (tb_chat_session_tags)
```

### 생성되는 태깅 필드 (13개)

| 필드 | 타입 | 설명 |
|------|------|------|
| `interest_tags` | [{topic, intensity}] | 관심 건강 주제 (high/medium/low) |
| `risk_tags` | string[] | 위험 요소 (검진 이상 항목 기반) |
| `keyword_tags` | string[] | 대화 키워드 (최대 20개) |
| `sentiment` | enum | positive / negative / neutral / worried / grateful |
| `conversation_depth` | enum | deep / moderate / shallow |
| `engagement_score` | 0-100 | 참여도 (반복 주제, 질문 수 기반) |
| `action_intent` | enum | active / considering / passive |
| `nutrition_interests` | string[] | 영양/식단 관심사 |
| `risk_level` | enum | low / medium / high |
| `key_concerns` | string[] | 핵심 우려사항 (최대 3개) |
| `follow_up_needed` | boolean | 후속 관리 필요 여부 |
| `summary` | text | 대화 요약 |
| `data_quality_score` | 0-100 | 검진 데이터 품질 점수 |

### 상세 질문 답변

**임계값(Threshold)을 유연하게 수정 가능한가?**

> **가능.** 태깅 시스템은 아래 수준에서 커스터마이징 지원:
> - **LLM 프롬프트**: 시스템 프롬프트에 태깅 기준이 명시되어 있어, 프롬프트 수정으로 기준 변경 가능
> - **Rule-based 사전**: `HEALTH_TOPIC_KEYWORDS` (15개 토픽), `SENTIMENT_KEYWORDS` (3개 카테고리)가 코드 내 딕셔너리로 관리
> - **데이터 품질 기준**: 15개 필수 검진 항목 목록이 정의되어 있어 커스텀 가능
> - **위험도 산출**: LLM 판단과 검진 수치 기반 판단 중 높은 쪽을 채택하는 로직

**비정형 데이터 → 정형 라벨 자동화 파이프라인이 존재하나?**

> **존재.** 상담 완료 시 자동으로 비동기 태깅 파이프라인이 실행됨:
> 1. 전체 대화 이력 + 검진 데이터를 LLM에 전달
> 2. JSON 스키마로 구조화된 태그 생성
> 3. PostgreSQL에 저장
> 4. 배치 재태깅 기능으로 기존 세션도 재분석 가능 (`force` 플래그)
> 5. 태깅 모델/버전 추적 (`tagging_model`, `tagging_version` 필드)

---

## 3. 파트너사 전환 최적화 (Partner Conversion Tech)

### 핵심 질문: 위험군별 파트너사 매칭 및 개인화 메시지 자동 발송이 가능한가?

**현재: 퍼널 추적만 구현, 개인화 매칭은 미구현**

### 현재 구현된 전환 추적

```
[ES 이벤트]     →  [채팅 세션]     →  [설문 응답]
webAppKey 기반       user_uuid 기반     respondent_uuid 기반
unique users 카운트   세션 수 카운트      응답 수 카운트
      ↓                  ↓                  ↓
  chat_rate = chats / users    survey_rate = surveys / users
```

**Google Analytics 이벤트 추적 (6개 카테고리):**
- `landing_page`: 페이지 조회, 시작 버튼 클릭
- `agreement_panel`: 동의 체크, 계정 생성
- `survey_step`: 단계 시작/완료/건너뛰기
- `report_page`: 카드 스와이프/클릭, 다운로드
- `loading_screen`: 로딩 시작/완료/타임아웃

### 상세 질문 답변

**A/B 테스트 기능이 구현되어 있나?**
> **미구현.** 현재 행동의향(passive/considering/active) 상태값은 태깅으로 분류되지만, 이에 따른 자동 메시지 발송이나 랜딩 페이지 분기 기능은 없음.

**전환(Click-through) 데이터를 CRM으로 피드백하는 구조인가?**
> **부분적.** GA 이벤트로 전환 행동은 추적되나, 메디링스 자체 DB로 피드백하는 closed-loop는 구축되지 않음. ES 이벤트 기반 행동 데이터만 수집 중.

### 구현 가능한 확장

| 기능 | 난이도 | 설명 |
|------|--------|------|
| 위험군별 파트너 매칭 | 중 | `risk_tags` + `interest_tags` → 파트너 상품 매칭 룰 엔진 |
| 행동의향별 메시지 차등 | 중 | `action_intent` 기반 푸시/알림 타이밍 조절 |
| A/B 테스트 프레임워크 | 상 | 사용자 코호트 분리 + 전환율 비교 분석 |
| Click-through 피드백 | 하 | 파트너 리디렉트 URL에 추적 파라미터 추가 |

---

## 4. 병원 경영용 CRM 고도화 (Hospital Management Analytics)

### 핵심 질문: 만족도 리포트가 평균 점수만 보여주는가, 교차분석까지 가능한가?

**현재: 평균 점수 + 문항별 분포 + 시계열 추이 (교차분석은 미구현)**

### 현재 제공되는 분석

| 분석 유형 | 제공 여부 | 내용 |
|-----------|----------|------|
| 전체 평균 점수 | O | 5점 만점 기준 + 별점 표시 |
| 문항별 평균/분포 | O | 막대/파이/레이더/라인 차트 |
| 일별 추이 | O | 문항별 일별 평균 라인 차트 |
| 문항 순위 | O | 평균 점수 기준 상/하위 랭킹 |
| 자유 의견 목록 | O | 최근 5개 코멘트 표시 |
| 엑셀 내보내기 | O | 개별 응답 + 통계 + 분포 시트 |
| 검진 항목별 교차분석 | X | 미구현 |
| 인구통계별 세분화 | X | 미구현 |

### 상세 질문 답변

**"내시경 환자만 대기시간 점수가 낮다" 같은 Cross-tab 분석이 가능한가?**

> **현재 불가.** 설문 응답과 검진 데이터가 별도 테이블에 저장되어 있고, 공통 키(`web_app_key`) 연결이 완성되지 않은 상태. `web_app_key` 통합 후 아래 분석이 가능해짐:
> - 검진 항목별 만족도 교차분석
> - 이상 소견 유무별 재방문 의향 비교
> - 상담 깊이별 만족도 상관관계

**환자 사후 관리 시 관심사 태그 활용 메시지 추천 기능이 있나?**

> **미구현.** 현재 태깅 데이터(관심사, 위험도, 영양 관심사)는 백오피스에서 조회만 가능. 이를 활용한 자동 메시지 추천은 추가 개발 필요.
>
> 단, 태깅 인프라가 이미 갖춰져 있으므로, 추가 개발 범위는:
> - 태그 기반 메시지 템플릿 매핑 테이블
> - 발송 스케줄러 (N일 후 자동 발송)
> - 병원 관리자 UI에서 메시지 확인/승인

---

## 5. 확장성 및 데이터 수집 (Scalability)

### 핵심 질문: 라이프스타일 데이터 수집을 위해 설문 문항을 유동적으로 변경 가능한가?

**가능. 동적 설문 템플릿 시스템 구축 완료.**

### 설문 시스템 역량

| 기능 | 상태 | 설명 |
|------|------|------|
| 문항 동적 추가/삭제 | O | 드래그 순서 변경 포함 |
| 4가지 질문 유형 | O | rating(5점), text, single_choice, multiple_choice |
| 템플릿 CRUD | O | 생성/수정/삭제/활성화 |
| 템플릿별 버전 관리 | O | `question_count` + `version` 필드 |
| 평가 라벨 커스터마이즈 | O | 기본: 매우불만족~매우만족, 변경 가능 |
| 필수/선택 문항 설정 | O | 문항별 `required` 플래그 |
| 차트 유형 선택 | O | 문항별 bar/pie/radar/line 선택 |

### 상세 질문 답변

**라이프스타일(수면, 식단, 운동량) 추가 수집이 가능한가?**

> **가능.** 현재 설문 템플릿 시스템으로 즉시 추가 가능:
> - rating 타입: "수면의 질은 어떠신가요?" (1-5점)
> - single_choice 타입: "주 운동 횟수는?" (0회/1-2회/3-4회/5회 이상)
> - text 타입: "식단 관련 고민을 적어주세요"
>
> 병원별로 다른 템플릿 적용 가능 (1개 활성 템플릿/병원)

**데이터 마트가 구축되어 있어 DS팀이 직접 분석 가능한 환경인가?**

> **별도 데이터 마트는 없음.** 현재 구조:
>
> | 시스템 | 용도 | 접근 방식 |
> |--------|------|----------|
> | PostgreSQL | 상담/설문/태깅 데이터 | SQL 직접 쿼리 가능 |
> | Elasticsearch | 행동 이벤트/사용자 여정 | ES Query DSL |
> | Redis | 세션 캐시 | 분석 대상 아님 |
>
> **현재 제약**: 운영 DB에 직접 쿼리하는 구조로, 대용량 분석 시 성능 영향 가능.
>
> **권장 개선**: 분석 전용 읽기 레플리카 또는 데이터 웨어하우스(BigQuery 등) 구축으로 DS팀의 독립적 분석 환경 확보.

---

## 요약: 기술 역량 현황 매트릭스

| 영역 | 현재 수준 | 단기 확장 가능성 |
|------|----------|----------------|
| 데이터 통합 (UUID 매핑) | `web_app_key` 존재, 연결 미완성 | **높음** — 테이블 컬럼 추가로 해결 |
| 태깅/라벨링 | LLM + Rule-based 하이브리드 완성 | **높음** — 프롬프트/사전 수정으로 커스텀 |
| 전환 최적화 | 퍼널 추적만 구현 | **중간** — 매칭 룰 엔진 추가 필요 |
| 병원 CRM 분석 | 평균/추이/분포 제공 | **높음** — `web_app_key` 통합 후 교차분석 |
| 확장성/데이터 수집 | 동적 설문 완성 | **높음** — 즉시 문항 추가 가능 |
| 데이터 접근성 | 운영 DB 직접 쿼리 | **중간** — 분석 레플리카 구축 필요 |
