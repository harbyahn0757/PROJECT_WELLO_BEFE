# WELNO 파트너 RAG 건강상담 챗봇 - 대화 이력 분석 리포트
> 분석일: 2026-02-13 | 분석 대상: 68세션 (2/9~2/13)

## 1. 현황 요약

| 항목 | 수치 |
|---|---|
| 총 세션 수 | 68건 |
| 운영 기간 | 2026-02-09 ~ 2026-02-13 (5일간) |
| 고유 병원 수 | 13개 |
| 고유 사용자 수 | 28명 |
| 평균 메시지 수 | 1.28회/세션 |
| 단일 턴(1회) 세션 | 54건 (79.4%) |
| 다중 턴(2회+) 세션 | 14건 (20.6%) |

- 2/12에 47건 집중 (내부 테스트 포함)
- "안광수" 계정 27개 세션 (전체 39.7%) - 대부분 개발/QA 테스트
- 응답 미생성 세션 3건 존재

## 2. AI 인사말/도입부 패턴 분석

### 발견된 6가지 이상의 도입부 패턴

| 패턴 | 예시 |
|---|---|
| "{병원명} 건강 상담가" | "김해경 님, 안녕하세요. 효성병원(청주) 건강 상담가입니다." |
| "메디링스 병원 건강 상담가 AI" | "안녕하세요, 안광수 님! 메디링스 병원의 건강 상담가 AI입니다." |
| "MediLinx 전문 건강 상담가" | "안광수 님, 안녕하세요. MediLinx 전문 건강 상담가입니다." |
| "Dr. Welno" | "안녕하세요, 최안안 님. 전문 건강 상담가 Dr. Welno입니다." |
| "{병원명} 헬스케어 도우미" | "안녕하세요, 이상윤 님! 분당차병원 건강증진센터 헬스케어 도우미입니다." |
| 인사 없이 바로 본론 | "이상복 님, 2026년 2월 9일 진행하신 검진 결과에서..." |

### 핵심 문제점
- **시스템 프롬프트에서 병원명 하드코딩 안 됨** → LLM이 자유 생성
- **"메디링스 병원"은 존재하지 않는 병원** (MediLinx = 파트너 시스템명 → 할루시네이션)
- 같은 세션 내에서도 병원명이 바뀌는 케이스 존재
- 근본 원인: `partner_rag_chat_service.py` 669행 시스템 프롬프트가 `"너는 Dr. Welno야"`로만 지정

## 3. 응답 품질 분석

### 좋은 사례
- 이양순: 신사구체 → 혈압약 → 스트레스 (4턴 자연스러운 연결, 수치 정확 인용)
- 박규호: 체중관리 (구체 수치 + 대한비만학회 출처 인용)
- 윤여옥: 위고비/삭센다 질문에 적절한 거부 + 진짜 위험(혈당 529) 지적

### 문제 사례
1. **검진 데이터 없는 환자에게 간암 검진 권고** (김예은) - health_metrics 전부 0
2. **주민번호 입력에 경고 없이 수용** (이상옥 "710807")
3. **생년월일 1900-01-16을 실제로 100세+ 취급** (최안안) - 데이터 오류
4. **판정과 수치 불일치 감지하면서도 DISCREPANCY 태그 미생성** (이상복 혈색소 20.1 + 빈혈의심)
5. **응답 잘림** (안광수 - 토큰 한도 초과 추정)
6. **사용자 의도 오해** (조현근 "중성지방 검사 없다" → AI가 "있습니다" 반박)

### 할루시네이션
- "메디링스 병원(02-780-8003)" - 존재하지 않는 병원명 다수 반복
- "100세가 넘으신 연세에도 꾸준히 건강을 관리하시는 모습" - 데이터 오류를 실제로 해석

## 4. 사용자 질문 패턴

| 순위 | 유형 | 비중 |
|---|---|---|
| 1 | 건강상태 총평 요청 ("내 건강 어때?") | ~40% |
| 2 | 특정 수치/항목 질문 ("AST가 뭐지?") | ~25% |
| 3 | 관리법/조언 요청 ("체중감량 식단") | ~15% |
| 4 | 인사/탐색 ("?", "??", "ㅇㅋ") | ~15% |
| 5 | 약물/시술 문의 | ~3% |
| 6 | 비건강 관련 | ~2% |

## 5. UX/흐름 개선 포인트

### P0 (즉시)
1. 시스템 프롬프트에 **병원명 고정** + "메디링스" 금지어
2. 응답 미생성 3건 **원인 파악 및 에러 핸들링**

### P1 (1주)
3. 데이터 부재(모든 값 0) 시 **명확한 안내 메시지**
4. 생년월일 "1900-01-16" 같은 **이상 데이터 필터링**
5. 개인정보(주민번호) 입력 감지 시 **경고 메시지**

### P2 (2주)
6. 세션 이력 연결 (동일 사용자 **맥락 유지**)
7. 정상 판정 환자 **응답 간소화**
8. `[CLIENT_RAG_DISCREPANCY]` 태그 **실제 동작하도록 프롬프트 강화**

### P3 (한달)
9. 최소 입력("?", "ㅇㅋ") 시 **선택지 기반 안내**
10. "종료" 의사 표현 시 SUGGESTIONS 비생성

## 6. 기술적 이슈

- **[SUGGESTIONS]** 태그: 65건 중 64건에 포함. 프론트 렌더링 실패 시 태그 원문 노출 위험
- **[CLIENT_RAG_DISCREPANCY]** 태그: **전체 68세션 중 0건** - 실제 불일치 있지만 태그 미생성
- **응답 미생성 3건**: 에러 핸들링 부재로 빈 세션만 기록
- **병원 전화번호**: client_info 없으면 RAG에서 추출 → 잘못된 번호 안내 가능
- **인사말 아키텍처**: warmup greeting(위젯용)과 대화 본문 자기소개가 별도 → 불일치
