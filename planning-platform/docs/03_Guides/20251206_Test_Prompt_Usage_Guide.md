# í”„ë¡¬í”„íŠ¸ í…ŒìŠ¤íŠ¸ ë„êµ¬ ì‚¬ìš© ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”
ì´ ë„êµ¬ëŠ” ê¸°ì¡´ ì‹œìŠ¤í…œì˜ GPT ì„œë¹„ìŠ¤ì™€ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì¬ì‚¬ìš©í•˜ì—¬ í”„ë¡¬í”„íŠ¸ë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆëŠ” ìŠ¤í¬ë¦½íŠ¸ì…ë‹ˆë‹¤.

## ğŸš€ ê¸°ë³¸ ì‚¬ìš©ë²•

### 1. ê°„ë‹¨í•œ ì‹¤í–‰
```bash
cd /home/workspace/PROJECT_WELLO_BEFE/planning-platform/backend
python test_prompt.py
```

### 2. Pythonì—ì„œ ì§ì ‘ ì‚¬ìš©

#### ì˜ˆì‹œ 1: ê°„ë‹¨í•œ í”„ë¡¬í”„íŠ¸ í…ŒìŠ¤íŠ¸
```python
import asyncio
from test_prompt import test_simple_prompt

# ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
result = asyncio.run(test_simple_prompt())
print(f"ì„±ê³µ ì—¬ë¶€: {result['success']}")
```

#### ì˜ˆì‹œ 2: JSON ì‘ë‹µ í…ŒìŠ¤íŠ¸
```python
import asyncio
from test_prompt import test_json_response

# JSON ì‘ë‹µ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
result = asyncio.run(test_json_response())
```

#### ì˜ˆì‹œ 3: ì»¤ìŠ¤í…€ í”„ë¡¬í”„íŠ¸ í…ŒìŠ¤íŠ¸
```python
import asyncio
from test_prompt import test_custom_prompt

system_msg = "ë‹¹ì‹ ì€ ê±´ê°• ì „ë¬¸ê°€ì…ë‹ˆë‹¤."
user_msg = "45ì„¸ ë‚¨ì„±ì—ê²Œ ì¶”ì²œí•  ê²€ì§„ í•­ëª©ì„ ì•Œë ¤ì£¼ì„¸ìš”."

result = asyncio.run(test_custom_prompt(
    system_msg=system_msg,
    user_msg=user_msg,
    model="gpt-4o",
    temperature=0.7,
    max_tokens=2000,
    json_mode=False,
    save_log=True
))
```

#### ì˜ˆì‹œ 4: PromptTester í´ë˜ìŠ¤ ì§ì ‘ ì‚¬ìš©
```python
import asyncio
from test_prompt import PromptTester

async def my_test():
    tester = PromptTester()
    
    result = await tester.test_prompt(
        system_message="ë‹¹ì‹ ì€ ì˜ë£Œ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.",
        user_message="ê³ í˜ˆì•• í™˜ìì—ê²Œ í•„ìš”í•œ ê²€ì§„ í•­ëª©ì€?",
        model="gpt-4o-mini",
        temperature=0.5,
        max_tokens=1500,
        json_mode=False,
        save_log=True,
        patient_uuid="patient_001"
    )
    
    return result

result = asyncio.run(my_test())
```

## ğŸ“ í•¨ìˆ˜ íŒŒë¼ë¯¸í„° ì„¤ëª…

### `test_prompt()` íŒŒë¼ë¯¸í„°

| íŒŒë¼ë¯¸í„° | íƒ€ì… | ê¸°ë³¸ê°’ | ì„¤ëª… |
|---------|------|--------|------|
| `system_message` | str | í•„ìˆ˜ | ì‹œìŠ¤í…œ ë©”ì‹œì§€ (ì—­í•  ì •ì˜) |
| `user_message` | str | í•„ìˆ˜ | ì‚¬ìš©ì ë©”ì‹œì§€ (ì‹¤ì œ í”„ë¡¬í”„íŠ¸) |
| `model` | str | `"gpt-4o-mini"` | GPT ëª¨ë¸ (`gpt-4o-mini`, `gpt-4o` ë“±) |
| `temperature` | float | `0.5` | ì°½ì˜ì„± ìˆ˜ì¤€ (0.0-1.0) |
| `max_tokens` | int | `2000` | ìµœëŒ€ ì‘ë‹µ í† í° ìˆ˜ |
| `json_mode` | bool | `False` | JSON ì‘ë‹µ ëª¨ë“œ ì‚¬ìš© ì—¬ë¶€ |
| `save_log` | bool | `True` | ë¡œê·¸ ì €ì¥ ì—¬ë¶€ |
| `patient_uuid` | str | `"test_user"` | í™˜ì UUID (ë¡œê¹…ìš©) |
| `session_id` | str | `None` | ì„¸ì…˜ ID (ì—†ìœ¼ë©´ ìë™ ìƒì„±) |

## ğŸ¯ ì‹¤ì „ ì˜ˆì‹œ: ê²€ì§„ ì„¤ê³„ í”„ë¡¬í”„íŠ¸ í…ŒìŠ¤íŠ¸

```python
import asyncio
from test_prompt import PromptTester

async def test_checkup_design_prompt():
    tester = PromptTester()
    
    system_message = """ë‹¹ì‹ ì€ ëŒ€í•™ë³‘ì› ê²€ì§„ì„¼í„°ì¥ì´ì ì˜ˆë°©ì˜í•™ ì „ë¬¸ì˜ì…ë‹ˆë‹¤.
í™˜ìì˜ ê±´ê°• ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬ ë§ì¶¤í˜• ê²€ì§„ í•­ëª©ì„ ì¶”ì²œí•´ì£¼ì„¸ìš”."""
    
    user_message = """
## í™˜ì ì •ë³´
- ì´ë¦„: í™ê¸¸ë™
- ë‚˜ì´: 45ì„¸
- ì„±ë³„: ë‚¨ì„±

## ê³¼ê±° ê±´ê°•ê²€ì§„ ë°ì´í„°
### 1. 2023ë…„ 09/15 - ì„œìš¸ëŒ€ë³‘ì›
**ì´ìƒ í•­ëª©:**
- ì´ì½œë ˆìŠ¤í…Œë¡¤: 240 mg/dL (ì´ìƒ)

**ê²½ê³„ í•­ëª©:**
- í˜ˆì••(ìˆ˜ì¶•ê¸°): 135 mmHg (ê²½ê³„)
- ê³µë³µí˜ˆë‹¹: 110 mg/dL (ê²½ê³„)

## ë¬¸ì§„ ì‘ë‹µ
- ê°€ì¡±ë ¥: ë‹¹ë‡¨, ê³ í˜ˆì••
- í¡ì—°: í˜„ì¬ í¡ì—° ì¤‘
- ìš´ë™: ì£¼ 1-2íšŒ

## ì‚¬ìš©ìê°€ ì„ íƒí•œ ì—¼ë ¤ í•­ëª©
1. í˜ˆì•• (2023-09-15): 135 mmHg [ê²½ê³„]
2. í˜ˆë‹¹ (2023-09-15): 110 mg/dL [ê²½ê³„]

ìœ„ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì¶”ì²œ ê²€ì§„ í•­ëª©ì„ JSON í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”:
{
  "priority_1": {
    "items": ["í˜ˆì••ì¸¡ì •", "í˜ˆë‹¹ê²€ì‚¬"],
    "focus_items": [
      {
        "item_name": "í˜ˆì••ì¸¡ì •",
        "why_important": "ì´ìœ ",
        "check_point": "í™•ì¸ í¬ì¸íŠ¸"
      }
    ]
  },
  "priority_2": {
    "items": ["ê²½ë™ë§¥ ì´ˆìŒíŒŒ"],
    "health_context": "ì‹¬í˜ˆê´€ ê±´ê°•"
  },
  "doctor_comment": {
    "overall_assessment": "ì „ë°˜ì  í‰ê°€",
    "key_recommendations": ["ì¶”ì²œ1", "ì¶”ì²œ2"]
  }
}
"""
    
    result = await tester.test_prompt(
        system_message=system_message,
        user_message=user_message,
        model="gpt-4o",
        temperature=0.5,
        max_tokens=3000,
        json_mode=True,
        save_log=True,
        patient_uuid="test_patient_001"
    )
    
    if result['success']:
        print("\nâœ… í…ŒìŠ¤íŠ¸ ì„±ê³µ!")
        print(f"í† í° ì‚¬ìš©: {result['usage']['total_tokens']:,}ê°œ")
        print(f"ì†Œìš” ì‹œê°„: {result['elapsed_time']:.2f}ì´ˆ")
        print(f"ì„¸ì…˜ ID: {result['session_id']}")
        
        # ì‘ë‹µ ì €ì¥
        import json
        with open('test_response.json', 'w', encoding='utf-8') as f:
            json.dump(json.loads(result['response']), f, ensure_ascii=False, indent=2)
        print("\nğŸ’¾ ì‘ë‹µì´ test_response.jsonì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.")
    else:
        print(f"\nâŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: {result['error']}")
    
    return result

# ì‹¤í–‰
asyncio.run(test_checkup_design_prompt())
```

## ğŸ“Š ì¶œë ¥ ì˜ˆì‹œ

```
================================================================================
ğŸ§ª í”„ë¡¬í”„íŠ¸ í…ŒìŠ¤íŠ¸ ì‹œì‘
================================================================================
ğŸ¬ ì„¸ì…˜ ID ìƒì„±: 20241206_143022_test_pati

ğŸ“‹ ìš”ì²­ ì •ë³´:
  - ëª¨ë¸: gpt-4o
  - ì˜¨ë„: 0.5
  - ìµœëŒ€ í† í°: 3000
  - JSON ëª¨ë“œ: True
  - ë¡œê·¸ ì €ì¥: True

ğŸ“ ì‹œìŠ¤í…œ ë©”ì‹œì§€ ê¸¸ì´: 145 ì
ğŸ“ ì‚¬ìš©ì ë©”ì‹œì§€ ê¸¸ì´: 1,234 ì

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ” ì‹œìŠ¤í…œ ë©”ì‹œì§€ ë¯¸ë¦¬ë³´ê¸° (ì²˜ìŒ 500ì):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ë‹¹ì‹ ì€ ëŒ€í•™ë³‘ì› ê²€ì§„ì„¼í„°ì¥ì´ì ì˜ˆë°©ì˜í•™ ì „ë¬¸ì˜ì…ë‹ˆë‹¤.
í™˜ìì˜ ê±´ê°• ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬ ë§ì¶¤í˜• ê²€ì§„ í•­ëª©ì„ ì¶”ì²œí•´ì£¼ì„¸ìš”.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ” ì‚¬ìš©ì ë©”ì‹œì§€ ë¯¸ë¦¬ë³´ê¸° (ì²˜ìŒ 500ì):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

## í™˜ì ì •ë³´
- ì´ë¦„: í™ê¸¸ë™
- ë‚˜ì´: 45ì„¸
- ì„±ë³„: ë‚¨ì„±

## ê³¼ê±° ê±´ê°•ê²€ì§„ ë°ì´í„°
### 1. 2023ë…„ 09/15 - ì„œìš¸ëŒ€ë³‘ì›
**ì´ìƒ í•­ëª©:**
- ì´ì½œë ˆìŠ¤í…Œë¡¤: 240 mg/dL (ì´ìƒ)
...

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸš€ GPT API í˜¸ì¶œ ì¤‘...
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âœ… API í˜¸ì¶œ ì„±ê³µ (ì†Œìš” ì‹œê°„: 5.32ì´ˆ)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“Š ì‘ë‹µ ì •ë³´:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - ëª¨ë¸: gpt-4o-2024-11-20
  - í”„ë¡¬í”„íŠ¸ í† í°: 1,523
  - ì™„ë£Œ í† í°: 842
  - ì´ í† í°: 2,365

================================================================================
ğŸ’¬ GPT ì‘ë‹µ:
================================================================================
{
  "priority_1": {
    "items": ["í˜ˆì••ì¸¡ì •", "í˜ˆë‹¹ê²€ì‚¬"],
    "focus_items": [...]
  },
  ...
}

================================================================================

ğŸ’¾ ë¡œê·¸ ì €ì¥ë¨: logs/patient_test_pat.json
   ì„¸ì…˜ ID: 20241206_143022_test_pati
```

## ğŸ”§ í™˜ê²½ ë³€ìˆ˜

ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” ê¸°ì¡´ ì‹œìŠ¤í…œì˜ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤:

- `OPENAI_API_KEY`: OpenAI API í‚¤
- `OPENAI_MODEL`: ê¸°ë³¸ GPT ëª¨ë¸ (ì„¤ì •ì—ì„œ ê°€ì ¸ì˜´)

í™˜ê²½ ë³€ìˆ˜ëŠ” `app/core/config.py`ì˜ `settings`ì—ì„œ ìë™ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤.

## ğŸ“ ë¡œê·¸ íŒŒì¼

í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì‹œ ë¡œê·¸ëŠ” ë‹¤ìŒ ìœ„ì¹˜ì— ì €ì¥ë©ë‹ˆë‹¤:

```
backend/logs/patient_{uuid_prefix}.json
```

ë¡œê·¸ êµ¬ì¡°:
```json
{
  "patient_uuid": "test_user",
  "patient_name": "í…ŒìŠ¤íŠ¸ í™˜ì",
  "hospital_id": "test_hospital",
  "sessions": [
    {
      "session_id": "20241206_143022_test_user",
      "started_at": "2024-12-06T14:30:22",
      "steps": [
        {
          "step_number": "TEST",
          "step_name": "í”„ë¡¬í”„íŠ¸ í…ŒìŠ¤íŠ¸",
          "model": "gpt-4o",
          "prompt": "...",
          "response": "...",
          "timestamp": "2024-12-06T14:30:27"
        }
      ]
    }
  ]
}
```

## ğŸ’¡ íŒ

### 1. í”„ë¡¬í”„íŠ¸ ê¸¸ì´ ìµœì í™”
- ê¸´ í”„ë¡¬í”„íŠ¸ëŠ” í† í° ë¹„ìš©ì´ ì¦ê°€í•˜ë¯€ë¡œ í•„ìš”í•œ ì •ë³´ë§Œ í¬í•¨
- ë¯¸ë¦¬ë³´ê¸° ê¸°ëŠ¥ìœ¼ë¡œ ì‹¤ì œ ì „ì†¡ ë‚´ìš© í™•ì¸

### 2. ëª¨ë¸ ì„ íƒ
- `gpt-4o-mini`: ë¹ ë¥´ê³  ì €ë ´ (ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ìš©)
- `gpt-4o`: ê°•ë ¥í•˜ì§€ë§Œ ë¹„ì‹¸ê³  ëŠë¦¼ (ë³µì¡í•œ í”„ë¡¬í”„íŠ¸ìš©)

### 3. ì˜¨ë„(Temperature) ì¡°ì ˆ
- `0.0-0.3`: ì¼ê´€ì„± ë†’ìŒ (ì •í™•í•œ ì •ë³´ í•„ìš” ì‹œ)
- `0.4-0.7`: ê· í˜•ì¡íŒ ì°½ì˜ì„± (ì¶”ì²œ)
- `0.8-1.0`: ì°½ì˜ì„± ë†’ìŒ (ë‹¤ì–‘í•œ ì‘ë‹µ í•„ìš” ì‹œ)

### 4. JSON ëª¨ë“œ í™œìš©
- êµ¬ì¡°í™”ëœ ì‘ë‹µì´ í•„ìš”í•œ ê²½ìš° `json_mode=True` ì‚¬ìš©
- JSON ìŠ¤í‚¤ë§ˆë¥¼ í”„ë¡¬í”„íŠ¸ì— ëª…ì‹œí•˜ë©´ ë” ì •í™•í•œ ì‘ë‹µ

## ğŸ› ë¬¸ì œ í•´ê²°

### API í‚¤ ì˜¤ë¥˜
```
âŒ API í˜¸ì¶œ ì‹¤íŒ¨
ì—ëŸ¬: API í‚¤ ì—†ìŒ
```
â†’ í™˜ê²½ ë³€ìˆ˜ì—ì„œ `OPENAI_API_KEY`ê°€ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸

### ëª¨ë“ˆ ì„í¬íŠ¸ ì˜¤ë¥˜
```
ModuleNotFoundError: No module named 'app'
```
â†’ ë°˜ë“œì‹œ `backend/` ë””ë ‰í† ë¦¬ì—ì„œ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰

### ë¡œê·¸ íŒŒì¼ ê¶Œí•œ ì˜¤ë¥˜
```
PermissionError: [Errno 13] Permission denied: 'logs/...'
```
â†’ `logs/` ë””ë ‰í† ë¦¬ì— ì“°ê¸° ê¶Œí•œì´ ìˆëŠ”ì§€ í™•ì¸

## ğŸ“š ì¶”ê°€ ì°¸ê³ 

- GPT ì„œë¹„ìŠ¤ ì½”ë“œ: `app/services/gpt_service.py`
- ì„¸ì…˜ ë¡œê±° ì½”ë“œ: `app/services/session_logger.py`
- í™˜ê²½ ì„¤ì •: `app/core/config.py`

