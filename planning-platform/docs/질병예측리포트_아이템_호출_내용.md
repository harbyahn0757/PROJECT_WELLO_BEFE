# ì§ˆë³‘ì˜ˆì¸¡ ë¦¬í¬íŠ¸ ì•„ì´í…œ í´ë¦­ ì‹œ ë‚´ë¶€ í˜¸ì¶œ ë‚´ìš©

## ğŸ“ í˜¸ì¶œ íë¦„

### 1. ì‚¬ìš©ì ì•¡ì…˜
- ë©”ì¸ í˜ì´ì§€ì—ì„œ "ì§ˆë³‘ì˜ˆì¸¡ ë¦¬í¬íŠ¸ ë³´ê¸°" ì¹´ë“œ í´ë¦­
- `MainPage.tsx`ì˜ `handleCardClick('prediction')` í•¨ìˆ˜ ì‹¤í–‰

---

## ğŸ”§ ë‚´ë¶€ ì²˜ë¦¬ ë¡œì§

### 2. í™˜ê²½ ê°ì§€ ë° ì„¤ì •
```typescript
// í™˜ê²½ êµ¬ë¶„
const IS_DEVELOPMENT = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
const IS_PRODUCTION = !IS_DEVELOPMENT;

// í™˜ê²½ë³„ API URL
PARTNER_MARKETING_API_BASE:
  - ê°œë°œ: 'http://localhost:8000'
  - í”„ë¡œë•ì…˜: 'https://xogxog.com'

// í™˜ê²½ë³„ ë¦¬ë‹¤ì´ë ‰íŠ¸ URL
CAMPAIGN_REDIRECT_URL:
  - ê°œë°œ: 'http://localhost:3012'
  - í”„ë¡œë•ì…˜: 'https://xogxog.com/campaigns/bnr_planning_XogXAims'

// ì›°ë…¸ íŒŒíŠ¸ë„ˆ API í‚¤ (ê³ ì •ê°’)
WELNO_PARTNER_API_KEY: 'welno_5a9bb40b5108ecd8ef864658d5a2d5ab'
```

### 3. í™˜ì ì •ë³´ ìˆ˜ì§‘
```typescript
// URL íŒŒë¼ë¯¸í„°ì—ì„œ ì¶”ì¶œ
const urlParams = new URLSearchParams(location.search);
const uuid = urlParams.get('uuid');  // mkt_uuidë¡œ ì‚¬ìš©

// í™˜ì ì •ë³´ (ìš°ì„ ìˆœìœ„: state > URL íŒŒë¼ë¯¸í„°)
const patientName = patient?.name || urlParams.get('name') || '';
const patientBirthdayRaw = patient?.birthday || urlParams.get('birthday') || '';

// ìƒë…„ì›”ì¼ í˜•ì‹ ë³€í™˜ (YYYY-MM-DD â†’ YYYYMMDD)
let patientBirthday = '';
if (patientBirthdayRaw) {
  patientBirthday = patientBirthdayRaw.replace(/-/g, '');
}
```

---

## ğŸŒ ì‹¤ì œ API í˜¸ì¶œ

### 4. íŒŒíŠ¸ë„ˆ ì¸ì¦ API í˜¸ì¶œ

**ì—”ë“œí¬ì¸íŠ¸:**
```
ê°œë°œ: POST http://localhost:8000/api/partner-marketing/partner-auth
í”„ë¡œë•ì…˜: POST https://xogxog.com/api/partner-marketing/partner-auth
```

**ìš”ì²­ í—¤ë”:**
```json
{
  "Content-Type": "application/json"
}
```

**ìš”ì²­ ë°”ë”” (JSON):**
```json
{
  "api_key": "welno_5a9bb40b5108ecd8ef864658d5a2d5ab",  // í•„ìˆ˜
  "mkt_uuid": "uuidê°’",                                  // ì„ íƒ (ìˆìœ¼ë©´ ì¶”ê°€)
  "name": "í™˜ìì´ë¦„",                                    // ì„ íƒ (ìˆìœ¼ë©´ ì¶”ê°€)
  "birthday": "19810927",                                // ì„ íƒ (ìˆìœ¼ë©´ ì¶”ê°€, YYYYMMDD í˜•ì‹)
  "redirect_url": "http://localhost:3012"               // í•„ìˆ˜ (í™˜ê²½ë³„)
}
```

**ìš”ì²­ ë°”ë”” êµ¬ì„± ë¡œì§:**
```typescript
const requestPayload = {
  api_key: WELNO_PARTNER_API_KEY,        // í•­ìƒ í¬í•¨
  redirect_url: CAMPAIGN_REDIRECT_URL    // í•­ìƒ í¬í•¨
};

// ì¡°ê±´ë¶€ ì¶”ê°€
if (uuid) {
  requestPayload.mkt_uuid = uuid;        // UUIDê°€ ìˆìœ¼ë©´ ì¶”ê°€
}

if (patientName) {
  requestPayload.name = patientName;     // ì´ë¦„ì´ ìˆìœ¼ë©´ ì¶”ê°€
}

if (patientBirthday) {
  requestPayload.birthday = patientBirthday;  // ìƒë…„ì›”ì¼ì´ ìˆìœ¼ë©´ ì¶”ê°€
}
```

**Fetch ì˜µì…˜:**
```typescript
{
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify(requestPayload),
  redirect: 'follow'  // ë¦¬ë‹¤ì´ë ‰íŠ¸ ìë™ ë”°ë¼ê°€ê¸°
}
```

---

## ğŸ“¤ ì‘ë‹µ ì²˜ë¦¬

### 5. ë¦¬ë‹¤ì´ë ‰íŠ¸ ì²˜ë¦¬

**ì¼€ì´ìŠ¤ 1: HTTP 302 ë¦¬ë‹¤ì´ë ‰íŠ¸ (ìë™)**
```typescript
if (response.redirected) {
  // ë°±ì—”ë“œì—ì„œ HTTP 302 ë¦¬ë‹¤ì´ë ‰íŠ¸ ì‘ë‹µ
  window.location.href = response.url;
}
```

**ì¼€ì´ìŠ¤ 2: JSON ì‘ë‹µì— redirect_url í¬í•¨**
```typescript
if (response.ok) {
  const result = await response.json();
  if (result.redirect_url) {
    window.location.href = result.redirect_url;
  }
}
```

**ì˜ˆìƒ ë¦¬ë‹¤ì´ë ‰íŠ¸ URL í˜•ì‹:**
```
{redirect_url}?uid={mkt_uuid}&page=event-fixed&token={session_token}&partner_id=welno&name={name}&birthday={birthday}
```

**ì˜ˆì‹œ:**
- ê°œë°œ: `http://localhost:3012/?uid=a1b2c3d4-...&page=event-fixed&token=xxx&partner_id=welno&name=ì•ˆê´‘ìˆ˜&birthday=19810927`
- í”„ë¡œë•ì…˜: `https://xogxog.com/campaigns/bnr_planning_XogXAims/?uid=a1b2c3d4-...&page=event-fixed&token=xxx&partner_id=welno&name=ì•ˆê´‘ìˆ˜&birthday=19810927`

---

## âš ï¸ ì—ëŸ¬ ì²˜ë¦¬

### 6. ì—ëŸ¬ ì‘ë‹µ ì²˜ë¦¬

**400 ì—ëŸ¬ (í•„ìˆ˜ íŒŒë¼ë¯¸í„° ëˆ„ë½):**
```typescript
errorMessage = 'í•„ìˆ˜ íŒŒë¼ë¯¸í„°ê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤. (api_key í•„ìˆ˜)';
```

**401 ì—ëŸ¬ (ìœ íš¨í•˜ì§€ ì•Šì€ API Key):**
```typescript
errorMessage = 'ìœ íš¨í•˜ì§€ ì•Šì€ API Keyì…ë‹ˆë‹¤.';
```

**404 ì—ëŸ¬ (íŒŒíŠ¸ë„ˆ ê³„ì • ì—†ìŒ):**
```typescript
errorMessage = 'íŒŒíŠ¸ë„ˆ ê³„ì •ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì‹œìŠ¤í…œ ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.';
```

**ê¸°íƒ€ ì—ëŸ¬:**
```typescript
// JSON ì‘ë‹µì—ì„œ detail ë˜ëŠ” message ì¶”ì¶œ
const errorData = await response.json();
errorMessage = errorData.detail || errorData.message || 'ì§ˆë³‘ì˜ˆì¸¡ ë¦¬í¬íŠ¸ ì ‘ì†ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
```

**ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬:**
```typescript
catch (error) {
  alert('ì§ˆë³‘ì˜ˆì¸¡ ë¦¬í¬íŠ¸ ì ‘ì† ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
}
```

---

## ğŸ“‹ ìš”ì•½

### í˜¸ì¶œ ìˆœì„œ
1. ì‚¬ìš©ì í´ë¦­ â†’ `handleCardClick('prediction')`
2. í™˜ê²½ ê°ì§€ (ê°œë°œ/í”„ë¡œë•ì…˜)
3. í™˜ì ì •ë³´ ìˆ˜ì§‘ (UUID, ì´ë¦„, ìƒë…„ì›”ì¼)
4. API ìš”ì²­ í˜ì´ë¡œë“œ êµ¬ì„±
5. `POST /api/partner-marketing/partner-auth` í˜¸ì¶œ
6. ë¦¬ë‹¤ì´ë ‰íŠ¸ URLë¡œ ì´ë™

### ì „ë‹¬ë˜ëŠ” íŒŒë¼ë¯¸í„°
| íŒŒë¼ë¯¸í„° | í•„ìˆ˜ | ì„¤ëª… | ì˜ˆì‹œ |
|----------|------|------|------|
| `api_key` | âœ… | ì›°ë…¸ íŒŒíŠ¸ë„ˆ API Key | `welno_5a9bb40b5108ecd8ef864658d5a2d5ab` |
| `redirect_url` | âœ… | ë¦¬ë‹¤ì´ë ‰íŠ¸ ê¸°ë³¸ URL | ê°œë°œ: `http://localhost:3012`<br>í”„ë¡œë•ì…˜: `https://xogxog.com/campaigns/bnr_planning_XogXAims` |
| `mkt_uuid` | âŒ | ë§ˆì¼€íŒ… UUID (ìˆìœ¼ë©´ ì¶”ê°€) | `a1b2c3d4-e5f6-7890-abcd-ef1234567890` |
| `name` | âŒ | í™˜ì ì´ë¦„ (ìˆìœ¼ë©´ ì¶”ê°€) | `ì•ˆê´‘ìˆ˜` |
| `birthday` | âŒ | ìƒë…„ì›”ì¼ YYYYMMDD (ìˆìœ¼ë©´ ì¶”ê°€) | `19810927` |

### í™˜ê²½ë³„ ì°¨ì´ì 
| í•­ëª© | ê°œë°œ í™˜ê²½ | í”„ë¡œë•ì…˜ í™˜ê²½ |
|------|----------|--------------|
| API URL | `http://localhost:8000/api/partner-marketing/partner-auth` | `https://xogxog.com/api/partner-marketing/partner-auth` |
| ë¦¬ë‹¤ì´ë ‰íŠ¸ URL | `http://localhost:3012` | `https://xogxog.com/campaigns/bnr_planning_XogXAims` |
| ê°ì§€ ê¸°ì¤€ | `hostname === 'localhost'` ë˜ëŠ” `hostname === '127.0.0.1'` | ê·¸ ì™¸ ëª¨ë“  ê²½ìš° |

---

**ì‘ì„±ì¼**: 2025-11-23
**íŒŒì¼ ìœ„ì¹˜**: `planning-platform/frontend/src/pages/MainPage.tsx` (413-510 ë¼ì¸)


