# WELNO ì „ì²´ í”Œë¡œìš° ë„ì‹í™” (ìµœì¢…íŒ)

## ğŸ¯ ë©”ì¸ í™”ë©´ ì ‘ì† ì¼€ì´ìŠ¤ ë¶„ë¥˜

```
ì‚¬ìš©ì ì ‘ì†
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ URL í™•ì¸: http://localhost:9282/welno                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
    ?uuid=xxx&hospital=xxx íŒŒë¼ë¯¸í„° ìˆìŒ?
    â†“                              â†“
   YES                            NO
    â†“                              â†“
[ì¼€ì´ìŠ¤ 1]                    [ì¼€ì´ìŠ¤ 2]
ê¸°ì¡´ ì‚¬ìš©ì                    ì‹ ê·œ/ë³µêµ¬ í•„ìš”
```

---

## ğŸ“Š ì¼€ì´ìŠ¤ 1: URLì— íŒŒë¼ë¯¸í„° ìˆìŒ (ê¸°ì¡´ ì‚¬ìš©ì)

```
http://localhost:9282/welno?uuid=xxx&hospital=xxx
    â†“
MainPage.tsx ë Œë”ë§
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ useEffect: URL íŒŒë¼ë¯¸í„° ìë™ ê°ì§€    â”‚
â”‚ - uuid ì¶”ì¶œ                          â”‚
â”‚ - hospital ì¶”ì¶œ                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Contextì— ì €ì¥ (state.patient)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ í”Œë¡œíŒ… ë²„íŠ¼ í‘œì‹œ                     â”‚
â”‚ "ìƒë‹´ì˜ˆì•½ ì‹ ì²­"                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
ì‚¬ìš©ìê°€ "ê²€ì§„ê²°ê³¼ì¶”ì´" ì¹´ë“œ í´ë¦­
    â†“
handleCardClick('chart')
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UUID & Hospital ID í™•ì¸              â”‚
â”‚ - URL íŒŒë¼ë¯¸í„°ì—ì„œ ê°€ì ¸ì˜´ (O)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
navigate('/welno/results-trend?uuid=xxx&hospital=xxx')
    â†“
âœ… ê²°ê³¼ í™”ë©´ í‘œì‹œ
```

---

## ğŸ“Š ì¼€ì´ìŠ¤ 2: URLì— íŒŒë¼ë¯¸í„° ì—†ìŒ (ì‹ ê·œ/ë³µêµ¬)

```
http://localhost:9282/welno
    â†“
MainPage.tsx ë Œë”ë§
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì´ˆê¸°í™” ì²´í¬ (useEffect)                        â”‚
â”‚ 1. URL íŒŒë¼ë¯¸í„° ì—†ìŒ í™•ì¸                      â”‚
â”‚ 2. cleanupAllStorage ì¡°ê±´ í™•ì¸                 â”‚
â”‚    - LOGIN_INPUT_DATA ìˆê³  tilko_session_id ì—†ìŒ? â”‚
â”‚      â†’ ì „ì²´ localStorage ì´ˆê¸°í™”                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ë°ì´í„° ì†ŒìŠ¤ í™•ì¸ (ìš°ì„ ìˆœìœ„)         â”‚
    â”‚ 1. IndexedDB (WelnoHealthDB)        â”‚
    â”‚ 2. localStorage (welno_health_data) â”‚
    â”‚ 3. Context (state.patient)          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
ë°ì´í„° ìˆìŒ?
    â†“                    â†“
   YES                  NO
    â†“                    â†“
[ì„œë¸Œì¼€ì´ìŠ¤ 2-A]    [ì„œë¸Œì¼€ì´ìŠ¤ 2-B]
```

---

## ğŸ“Š ì„œë¸Œì¼€ì´ìŠ¤ 2-A: ë°ì´í„° ìˆìŒ (ê³¼ê±° ì„±ê³µ ì´ë ¥)

```
IndexedDB ë˜ëŠ” localStorageì— ë°ì´í„° ë°œê²¬
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WelnoDataContext.loadPatientData()   â”‚
â”‚ - uuid, hospitalId ë¡œë“œ              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Contextì— ì €ì¥ (state.patient)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ í”Œë¡œíŒ… ë²„íŠ¼ í‘œì‹œ                     â”‚
â”‚ "ìƒë‹´ì˜ˆì•½ ì‹ ì²­"                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
ì‚¬ìš©ìê°€ "ê²€ì§„ê²°ê³¼ì¶”ì´" ì¹´ë“œ í´ë¦­
    â†“
handleCardClick('chart')
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UUID & Hospital ID í™•ì¸              â”‚
â”‚ - Contextì—ì„œ ê°€ì ¸ì˜´ (O)             â”‚
â”‚ - ë˜ëŠ” IndexedDBì—ì„œ ì¬í™•ì¸          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
navigate('/welno/results-trend?uuid=xxx&hospital=xxx')
    â†“
âœ… ê²°ê³¼ í™”ë©´ í‘œì‹œ
```

---

## ğŸ“Š ì„œë¸Œì¼€ì´ìŠ¤ 2-B: ë°ì´í„° ì—†ìŒ (ì™„ì „ ì‹ ê·œ)

```
IndexedDB, localStorage, Context ëª¨ë‘ ë°ì´í„° ì—†ìŒ
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ í”Œë¡œíŒ… ë²„íŠ¼ í‘œì‹œ                     â”‚
â”‚ "ì¸ì¦í•˜ê³  ë‚´ ê²€ì§„ì¶”ì´ í™•ì¸í•˜ê¸°"      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ì‚¬ìš©ì ì„ íƒ 2ê°€ì§€                           â”‚
    â”‚ A) í”Œë¡œíŒ… ë²„íŠ¼ í´ë¦­                         â”‚
    â”‚ B) "ê²€ì§„ê²°ê³¼ì¶”ì´" ì¹´ë“œ í´ë¦­                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“                                  â†“
   [A: í”Œë¡œíŒ… ë²„íŠ¼]               [B: ì¹´ë“œ í´ë¦­]
```

---

## ğŸ”˜ í”Œë¡œìš° A: í”Œë¡œíŒ… ë²„íŠ¼ í´ë¦­

```
í”Œë¡œíŒ… ë²„íŠ¼ "ì¸ì¦í•˜ê³  ë‚´ ê²€ì§„ì¶”ì´ í™•ì¸í•˜ê¸°" í´ë¦­
    â†“
App.tsx: FloatingButton.handleClick()
    â†“
location.pathname === '/welno' í™•ì¸
    â†“
    YES â†’ handleAuthClick()
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Contextì— patient ë°ì´í„° ìˆìŒ?      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“                    â†“
   YES                  NO
    â†“                    â†“
window.welnoAuthForm   navigate('/welno/login')
.startInfoConfirmation()     â†“
    â†“                    [ë¡œê·¸ì¸ í˜ì´ì§€]
[ì •ë³´ í™•ì¸ ì‹œì‘]
```

---

## ğŸ”˜ í”Œë¡œìš° B: ì¹´ë“œ í´ë¦­

```
"ê²€ì§„ê²°ê³¼ì¶”ì´" ì¹´ë“œ í´ë¦­
    â†“
MainPage.tsx: handleCardClick('chart')
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. URL íŒŒë¼ë¯¸í„° í™•ì¸ (uuid, hospital)â”‚
â”‚ 2. Context í™•ì¸ (state.patient)      â”‚
â”‚ 3. IndexedDB í™•ì¸                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
ë°ì´í„° ì°¾ìŒ?
    â†“                    â†“
   YES                  NO
    â†“                    â†“
navigate(           navigate('/welno/login')
'/welno/results-trend      â†“
?uuid=xxx&hospital=xxx')  [ë¡œê·¸ì¸ í˜ì´ì§€]
    â†“
âœ… ê²°ê³¼ í™”ë©´
```

---

## ğŸ”‘ ë¡œê·¸ì¸ í˜ì´ì§€ (/welno/login) ì „ì²´ í”Œë¡œìš°

```
/welno/login ì ‘ì†
    â†“
AuthForm.tsx ë§ˆìš´íŠ¸
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì´ˆê¸°í™” ì²´í¬ (useEffect ìˆœì„œ)                    â”‚
â”‚ 1. ì„¸ì…˜ ë³µêµ¬ ì²´í¬ (checkExistingSession)        â”‚
â”‚    - localStorage: tilko_session_id í™•ì¸        â”‚
â”‚    - Redis: ì„œë²„ ì„¸ì…˜ ìƒíƒœ í™•ì¸                 â”‚
â”‚ 2. ì…ë ¥ ë°ì´í„° ë³µêµ¬ (restoreLoginInputData)     â”‚
â”‚    - localStorage: LOGIN_INPUT_DATA í™•ì¸        â”‚
â”‚    - 1ì‹œê°„ ì´ìƒ ì§€ë‚œ ë°ì´í„°ëŠ” ì‚­ì œ              â”‚
â”‚ 3. ì‹ í˜¸ ê°ì§€ (localStorageChange ì´ë²¤íŠ¸)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ì¼€ì´ìŠ¤ ë¶„ê¸°                         â”‚
    â”‚ A) Redis ì„¸ì…˜ ìˆìŒ (5ë¶„ ì´ë‚´)      â”‚
    â”‚ B) localStorage ì…ë ¥ ë°ì´í„° ìˆìŒ   â”‚
    â”‚ C) ì™„ì „ ì‹ ê·œ                        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ ì¼€ì´ìŠ¤ A: Redis ì„¸ì…˜ ë³µêµ¬

```
Redisì— ì„¸ì…˜ ìˆìŒ (5ë¶„ ì´ë‚´)
    â†“
ì„¸ì…˜ ìƒíƒœ í™•ì¸
    â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ auth_pending: ì¸ì¦ ëŒ€ê¸° ì¤‘    â”‚
    â”‚ auth_completed: ì¸ì¦ ì™„ë£Œ     â”‚
    â”‚ fetching_*: ë°ì´í„° ìˆ˜ì§‘ ì¤‘    â”‚
    â”‚ completed: ì™„ë£Œ               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
handleSimpleSessionRecovery(sessionId, status)
    â†“
ê° ìƒíƒœì— ë§ëŠ” í™”ë©´ìœ¼ë¡œ ë³µêµ¬
```

---

## ğŸ“ ì¼€ì´ìŠ¤ B: localStorage ì…ë ¥ ë°ì´í„° ë³µêµ¬

```
localStorage: LOGIN_INPUT_DATA ìˆìŒ
    â†“
1ì‹œê°„ ì´ë‚´ ë°ì´í„°?
    â†“                    â†“
   YES                  NO
    â†“                    â†“
restoreLoginInputData()  ë°ì´í„° ì‚­ì œ
    â†“                    â†“
setEditableName(...)   [ì‹ ê·œ ì…ë ¥]
setEditablePhone(...)
setEditableBirthday(...)
    â†“
setShowConfirmation(true)
setCurrentConfirmationStep('name')
    â†“
[ì •ë³´ í™•ì¸ í™”ë©´ í‘œì‹œ]
```

---

## ğŸ†• ì¼€ì´ìŠ¤ C: ì™„ì „ ì‹ ê·œ ì‚¬ìš©ì

```
ì„¸ì…˜ ì—†ìŒ, ì…ë ¥ ë°ì´í„° ì—†ìŒ
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ í”Œë¡œíŒ… ë²„íŠ¼ í‘œì‹œ                     â”‚
â”‚ "ì¸ì¦í•˜ê³  ë‚´ ê²€ì§„ì¶”ì´ í™•ì¸í•˜ê¸°"      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
í”Œë¡œíŒ… ë²„íŠ¼ í´ë¦­
    â†“
App.tsx: handleAuthClick()
    â†“
window.welnoAuthForm.startInfoConfirmation()
    â†“
AuthForm.tsx: startInfoConfirmation()
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ìƒíƒœ ì´ˆê¸°í™”                          â”‚
â”‚ - setAuthRequested(false)            â”‚
â”‚ - setShowConfirmation(true)          â”‚
â”‚ - setCurrentConfirmationStep('name') â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
[ì •ë³´ ì…ë ¥ í™”ë©´ í‘œì‹œ]
```

---

## ğŸ“‹ ì •ë³´ ì…ë ¥ â†’ ì¸ì¦ â†’ ë°ì´í„° ìˆ˜ì§‘ í”Œë¡œìš°

```
[1ë‹¨ê³„: ì •ë³´ í™•ì¸]
showConfirmation = true
authRequested = false
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ë‹¨ê³„ë³„ ì…ë ¥                            â”‚
â”‚ 1. name: ì´ë¦„ ì…ë ¥                     â”‚
â”‚ 2. phone: ì „í™”ë²ˆí˜¸ ì…ë ¥                â”‚
â”‚ 3. birthday: ìƒë…„ì›”ì¼ ì…ë ¥             â”‚
â”‚ 4. auth_method: ì¸ì¦ ë°©ë²• ì„ íƒ         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
ê° ë‹¨ê³„ë§ˆë‹¤ handleNextStep() í˜¸ì¶œ
    â†“
ìµœì¢… ë‹¨ê³„ì—ì„œ handleAllConfirmed() í˜¸ì¶œ
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ë°±ì—”ë“œ API í˜¸ì¶œ (ìˆœì„œ)                 â”‚
â”‚ 1. POST /session/start                 â”‚
â”‚    - ì„¸ì…˜ ìƒì„± (Redis)                 â”‚
â”‚    - session_id ë°›ìŒ                   â”‚
â”‚ 2. POST /session/{id}/simple-auth      â”‚
â”‚    - Tilko API ì¸ì¦ ìš”ì²­               â”‚
â”‚    - cxId, txId, token ë°›ìŒ            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
[2ë‹¨ê³„: ì¸ì¦ ëŒ€ê¸°]
showConfirmation = false
authRequested = true
currentStatus = 'auth_pending'
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ í”Œë¡œíŒ… ë²„íŠ¼ ë³€ê²½                       â”‚
â”‚ "ì¸ì¦ì„ ì™„ë£Œí–ˆì–´ìš”" (auth_waiting)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ í´ë§ ì‹œì‘ (startTokenMonitoring)       â”‚
â”‚ - 10ì´ˆë§ˆë‹¤ ì„¸ì…˜ ìƒíƒœ í™•ì¸              â”‚
â”‚ - WebSocket ì‹¤íŒ¨ ëŒ€ë¹„ìš©                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
ì‚¬ìš©ìê°€ í°ì—ì„œ ì¸ì¦ ì™„ë£Œ
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Redis ì„¸ì…˜ ìƒíƒœ ë³€ê²½                   â”‚
â”‚ auth_pending â†’ auth_completed          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
í´ë§ì—ì„œ ê°ì§€
    â†“
setCurrentStatus('auth_completed')
setTokenReceived(true)
    â†“
[3ë‹¨ê³„: ë°ì´í„° ìˆ˜ì§‘ ëŒ€ê¸°]
í”Œë¡œíŒ… ë²„íŠ¼: "ì¸ì¦ì„ ì™„ë£Œí–ˆì–´ìš”"
    â†“
ì‚¬ìš©ìê°€ "ì¸ì¦ì„ ì™„ë£Œí–ˆì–´ìš”" ë²„íŠ¼ í´ë¦­
    â†“
handleManualDataCollection()
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ë°±ì—”ë“œ API í˜¸ì¶œ                        â”‚
â”‚ POST /session/{id}/collect-data        â”‚
â”‚ - ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë°ì´í„° ìˆ˜ì§‘ ì‹œì‘      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
[4ë‹¨ê³„: ë°ì´í„° ìˆ˜ì§‘ ì¤‘]
currentStatus = 'collecting'
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ë°±ì—”ë“œ ë°±ê·¸ë¼ìš´ë“œ ì‘ì—…                 â”‚
â”‚ 1. Tilko API: ê±´ê°•ê²€ì§„ ë°ì´í„° ìˆ˜ì§‘     â”‚
â”‚    - get_health_screening_data()       â”‚
â”‚ 2. Tilko API: ì²˜ë°©ì „ ë°ì´í„° ìˆ˜ì§‘       â”‚
â”‚    - get_prescription_data()           â”‚
â”‚ 3. DB ì €ì¥ (wello_patients, wello_health_data) â”‚
â”‚ 4. íŒŒì¼ ì €ì¥ (tilko_data/)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
í”„ë¡ íŠ¸ì—”ë“œ í´ë§ (pollCollectionStatus)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1ì´ˆë§ˆë‹¤ ì„¸ì…˜ ìƒíƒœ í™•ì¸                 â”‚
â”‚ GET /session/{id}/status               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
status === 'completed' ê°ì§€
    â†“
setCurrentStatus('data_completed')
    â†“
[5ë‹¨ê³„: ì™„ë£Œ]
setShowCollectionCompleteModal(true)
    â†“
ëª¨ë‹¬: "ìˆ˜ì§‘ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤"
    â†“
ì‚¬ìš©ìê°€ í™•ì¸ ë²„íŠ¼ í´ë¦­
    â†“
navigate('/welno/results-trend?uuid=xxx&hospital=xxx')
    â†“
âœ… ê²°ê³¼ í™”ë©´ í‘œì‹œ
```

---

## ğŸŒ ì™¸ë¶€ API í˜¸ì¶œ ìˆœì„œë„

```
[í”„ë¡ íŠ¸ì—”ë“œ â†’ ë°±ì—”ë“œ â†’ Tilko API]

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ì„¸ì…˜ ì‹œì‘                                            â”‚
â”‚ POST /welno-api/v1/tilko/session/start                  â”‚
â”‚   Request: { private_auth_type, user_name, birthdate,   â”‚
â”‚              phone_no, gender, patient_uuid, hospital_id }â”‚
â”‚   Response: { session_id }                               â”‚
â”‚   Redis ì €ì¥: session_id â†’ session_data                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ì¸ì¦ ìš”ì²­                                            â”‚
â”‚ POST /welno-api/v1/tilko/session/{id}/simple-auth       â”‚
â”‚   Backend â†’ Tilko: get_public_key()                     â”‚
â”‚   Backend â†’ Tilko: simple_auth()                        â”‚
â”‚   Response: { cxId, txId, token, reqTxId }              â”‚
â”‚   Redis ì—…ë°ì´íŠ¸: temp_auth_data                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ì¸ì¦ ìƒíƒœ í™•ì¸ (í´ë§)                                â”‚
â”‚ GET /welno-api/v1/tilko/session/{id}/status             â”‚
â”‚   Backend â†’ Tilko: check_auth_status()                  â”‚
â”‚   Response: { status: 'auth_completed' }                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ë°ì´í„° ìˆ˜ì§‘ ì‹œì‘                                     â”‚
â”‚ POST /welno-api/v1/tilko/session/{id}/collect-data      â”‚
â”‚   Backend â†’ Tilko: get_health_screening_data()          â”‚
â”‚   Backend â†’ Tilko: get_prescription_data()              â”‚
â”‚   Backend â†’ DB: save_patient_data()                     â”‚
â”‚   Backend â†’ File: íŒŒì¼ ì €ì¥                             â”‚
â”‚   Redis ì—…ë°ì´íŠ¸: health_data, prescription_data        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ì™„ë£Œ í™•ì¸ (í´ë§)                                     â”‚
â”‚ GET /welno-api/v1/tilko/session/{id}/status             â”‚
â”‚   Response: { status: 'completed',                      â”‚
â”‚               health_data, prescription_data }           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ ë°ì´í„° ì €ì¥ ìœ„ì¹˜

```
[ìˆ˜ì§‘ ì™„ë£Œ í›„ ë°ì´í„° ì €ì¥ ê²½ë¡œ]

1. Redis (ì„ì‹œ)
   - session_id â†’ session_data
   - ë§Œë£Œ: 5ë¶„

2. PostgreSQL (ì˜êµ¬)
   - wello_patients (í™˜ì ì •ë³´)
   - wello_health_data (ê±´ê°•ê²€ì§„)
   - wello_prescription_data (ì²˜ë°©ì „)

3. íŒŒì¼ ì‹œìŠ¤í…œ (ë°±ì—…)
   - tilko_data/{session_id}/
     â”œâ”€â”€ patient_data.json
     â”œâ”€â”€ health_data.json
     â””â”€â”€ prescription_data.json

4. IndexedDB (ë¸Œë¼ìš°ì €, ìºì‹œ)
   - WelnoHealthDB.health_data
     â””â”€â”€ { uuid, hospitalId, healthData, prescriptionData }

5. localStorage (ë¸Œë¼ìš°ì €, ì„ì‹œ)
   - welno_health_data
   - tilko_session_id
   - tilko_session_data
   - LOGIN_INPUT_DATA
```

---

## ğŸš¨ ë¬¸ì œì  ë° ë³µì¡ì„± ì›ì¸

### 1. **ë°ì´í„° ì†ŒìŠ¤ê°€ ë„ˆë¬´ ë§ìŒ** (5ê°œ)
- URL íŒŒë¼ë¯¸í„°
- Context (state.patient)
- IndexedDB
- localStorage
- Redis ì„¸ì…˜

### 2. **ìƒíƒœ ê´€ë¦¬ê°€ ë¶„ì‚°ë¨**
- AuthForm.tsx: showConfirmation, authRequested, currentStatus
- App.tsx: isAuthWaiting, isInfoConfirming, patient
- localStorage: 10ê°œ ì´ìƒì˜ í”Œë˜ê·¸
- Redis: ì„¸ì…˜ ìƒíƒœ

### 3. **í”Œë¡œíŒ… ë²„íŠ¼ í‘œì‹œ ì¡°ê±´ì´ ë³µì¡í•¨**
```typescript
shouldHide = 
  isPasswordModalOpen ||
  isInfoConfirming ||
  isAuthWaiting ||
  isAuthMethodSelection ||
  isManualCollecting ||
  isCollecting ||
  isMainPage ||
  location.pathname === '/collecting' ||
  ... (10ê°œ ì´ìƒì˜ ì¡°ê±´)
```

### 4. **ì…ë ¥ ë°ì´í„° ë³µêµ¬ ë¡œì§ì´ ì—¬ëŸ¬ ê³³ì—ì„œ ì‹¤í–‰ë¨**
- App.tsx: cleanupAllStorage
- AuthForm.tsx: restoreLoginInputData
- AuthForm.tsx: ìë™ ì´ë¦„ ì—…ë°ì´íŠ¸
- AuthForm.tsx: ì„¸ì…˜ ë³µêµ¬

### 5. **í´ë§ê³¼ WebSocketì´ ì¤‘ë³µë¨**
- í´ë§: startTokenMonitoring (10ì´ˆë§ˆë‹¤)
- í´ë§: pollCollectionStatus (1ì´ˆë§ˆë‹¤)
- WebSocket: ì‹¤ì‹œê°„ ì•Œë¦¼ (ì‚¬ìš© ì•ˆ ë¨?)

### 6. **ê²½ë¡œê°€ ì¤‘ë³µë˜ê³  ì¼ê´€ì„± ì—†ìŒ**
- `/login` vs `/welno/login`
- `/results-trend` vs `/welno/results-trend`
- navigate í˜¸ì¶œ ì‹œ ì¼ë¶€ëŠ” base path í¬í•¨, ì¼ë¶€ëŠ” ë¯¸í¬í•¨

---

## âœ… ê°œì„  ë°©ì•ˆ (ê°„ë‹¨ ìš”ì•½)

1. **ë°ì´í„° ì†ŒìŠ¤ í†µí•©**
   - IndexedDBë¥¼ ë‹¨ì¼ ì§„ì‹¤ ê³µê¸‰ì›ìœ¼ë¡œ ì‚¬ìš©
   - localStorageëŠ” ì„ì‹œ ì„¸ì…˜ë§Œ

2. **ìƒíƒœ ê´€ë¦¬ ë‹¨ìˆœí™”**
   - Contextë¡œ ëª¨ë“  ìƒíƒœ í†µí•©
   - localStorage í”Œë˜ê·¸ ìµœì†Œí™”

3. **í”Œë¡œíŒ… ë²„íŠ¼ ë¡œì§ ë‹¨ìˆœí™”**
   - pathname ê¸°ë°˜ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ë°©ì‹
   - ë³µì¡í•œ ì¡°ê±´ ì œê±°

4. **ì…ë ¥ ë°ì´í„° ë³µêµ¬ ë‹¨ì¼í™”**
   - AuthFormì—ì„œë§Œ ì²˜ë¦¬
   - App.tsxì—ì„œëŠ” ì •ë¦¬ë§Œ

5. **í´ë§ vs WebSocket í†µì¼**
   - WebSocket ì œê±°í•˜ê³  í´ë§ë§Œ ì‚¬ìš©
   - ë˜ëŠ” WebSocketë§Œ ì‚¬ìš©í•˜ê³  í´ë§ ì œê±°

6. **ê²½ë¡œ ì¼ê´€ì„±**
   - ëª¨ë“  navigate í˜¸ì¶œì— `/welno` base path ëª…ì‹œ
   - ìƒëŒ€ ê²½ë¡œ ì‚¬ìš© ê¸ˆì§€
