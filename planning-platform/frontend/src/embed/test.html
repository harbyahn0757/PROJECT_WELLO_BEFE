<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welno RAG Chat Widget Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 40px;
            background: #f5f5f5;
            line-height: 1.6;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .test-section {
            margin-bottom: 40px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
        }
        
        .test-section h2 {
            color: #7B5E4F;
            margin-top: 0;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            background: #7B5E4F;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        
        button:hover {
            background: #6B4E3F;
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .config-section {
            background: #e8f4f8;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .config-section h3 {
            margin-top: 0;
            color: #2c5282;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        textarea {
            height: 80px;
            resize: vertical;
        }
        
        .status {
            padding: 10px 15px;
            border-radius: 6px;
            margin-top: 15px;
            font-weight: 500;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .sample-data {
            background: #fff3cd;
            padding: 15px;
            border-radius: 6px;
            margin-top: 10px;
            border: 1px solid #ffeaa7;
        }
        
        .sample-data h4 {
            margin-top: 0;
            color: #856404;
        }
        
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 13px;
            border: 1px solid #e9ecef;
        }
        
        .log {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin-top: 15px;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }
        
        .log-entry.error {
            color: #dc3545;
        }
        
        .log-entry.success {
            color: #28a745;
        }
        
        .log-entry.info {
            color: #17a2b8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¥ Welno RAG Chat Widget í…ŒìŠ¤íŠ¸</h1>
        
        <!-- ì„¤ì • ì„¹ì…˜ -->
        <div class="config-section">
            <h3>âš™ï¸ ìœ„ì ¯ ì„¤ì •</h3>
            
            <div class="form-group">
                <label for="apiKey">API Key:</label>
                <input type="text" id="apiKey" value="test_pk_12345678901234567890123456789012" placeholder="íŒŒíŠ¸ë„ˆ API Key ì…ë ¥">
            </div>
            
            <div class="form-group">
                <label for="baseUrl">Base URL:</label>
                <input type="text" id="baseUrl" value="http://localhost:8082" placeholder="API ì„œë²„ URL">
            </div>
            
            <div class="form-group">
                <label for="uuid">ì‚¬ìš©ì ID:</label>
                <input type="text" id="uuid" value="test_widget_user" placeholder="ì‚¬ìš©ì ê³ ìœ  ID">
            </div>
            
            <div class="form-group">
                <label for="hospitalId">ë³‘ì›/íŒŒíŠ¸ë„ˆ ID:</label>
                <input type="text" id="hospitalId" value="test_widget_clinic" placeholder="ë³‘ì› ë˜ëŠ” íŒŒíŠ¸ë„ˆ ID">
            </div>
            
            <div class="form-group">
                <label for="position">ìœ„ì¹˜:</label>
                <select id="position">
                    <option value="bottom-right">ìš°ì¸¡ í•˜ë‹¨</option>
                    <option value="bottom-left">ì¢Œì¸¡ í•˜ë‹¨</option>
                    <option value="top-right">ìš°ì¸¡ ìƒë‹¨</option>
                    <option value="top-left">ì¢Œì¸¡ ìƒë‹¨</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="buttonColor">ë²„íŠ¼ ìƒ‰ìƒ:</label>
                <input type="color" id="buttonColor" value="#A69B8F">
            </div>
            
            <div class="form-group">
                <label for="partnerData">íŒŒíŠ¸ë„ˆ ë°ì´í„° (JSON):</label>
                <textarea id="partnerData" placeholder='{"patient_info": {"name": "ê¹€í…ŒìŠ¤íŠ¸", "age": 35}, "health_metrics": {"bmi": 22.5}}'></textarea>
            </div>
        </div>
        
        <!-- í…ŒìŠ¤íŠ¸ ë²„íŠ¼ë“¤ -->
        <div class="test-section">
            <h2>ğŸ§ª í…ŒìŠ¤íŠ¸ ê¸°ëŠ¥</h2>
            
            <div class="button-group">
                <button onclick="initWidget()">ìœ„ì ¯ ì´ˆê¸°í™”</button>
                <button onclick="openWidget()">ìœ„ì ¯ ì—´ê¸°</button>
                <button onclick="closeWidget()">ìœ„ì ¯ ë‹«ê¸°</button>
                <button onclick="destroyWidget()">ìœ„ì ¯ ì œê±°</button>
                <button onclick="testAPI()">API ì—°ê²° í…ŒìŠ¤íŠ¸</button>
                <button onclick="clearLog()">ë¡œê·¸ ì§€ìš°ê¸°</button>
            </div>
            
            <div id="status" class="status info" style="display: none;">
                ìœ„ì ¯ ìƒíƒœê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
            </div>
        </div>
        
        <!-- ìƒ˜í”Œ ë°ì´í„° -->
        <div class="sample-data">
            <h4>ğŸ“‹ ìƒ˜í”Œ íŒŒíŠ¸ë„ˆ ë°ì´í„°</h4>
            <p>ì•„ë˜ JSONì„ ë³µì‚¬í•´ì„œ "íŒŒíŠ¸ë„ˆ ë°ì´í„°" í•„ë“œì— ë¶™ì—¬ë„£ì–´ ë³´ì„¸ìš”:</p>
            <pre>{
  "patient_info": {
    "name": "ê¹€í…ŒìŠ¤íŠ¸",
    "age": 35,
    "gender": "M",
    "height": 175,
    "weight": 70
  },
  "health_metrics": {
    "bmi": 22.9,
    "blood_pressure": "120/80",
    "blood_sugar": 95,
    "cholesterol": 180,
    "checkup_date": "2024-01-15"
  }
}</pre>
        </div>
        
        <!-- ë¡œê·¸ -->
        <div class="test-section">
            <h2>ğŸ“‹ ë¡œê·¸</h2>
            <div id="log" class="log">
                <div class="log-entry info">[INFO] í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ</div>
            </div>
        </div>
    </div>

    <!-- ìœ„ì ¯ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ -->
    <script src="WelnoRagChatWidget.js"></script>
    
    <script>
        let widget = null;
        
        // ë¡œê·¸ í•¨ìˆ˜
        function addLog(message, type = 'info') {
            const log = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }
        
        // ìƒíƒœ í‘œì‹œ
        function showStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
            
            setTimeout(() => {
                status.style.display = 'none';
            }, 3000);
        }
        
        // ìœ„ì ¯ ì´ˆê¸°í™”
        function initWidget() {
            try {
                if (widget) {
                    widget.destroy();
                }
                
                // ì„¤ì • ê°’ ìˆ˜ì§‘
                const apiKey = document.getElementById('apiKey').value.trim();
                const baseUrl = document.getElementById('baseUrl').value.trim();
                const uuid = document.getElementById('uuid').value.trim();
                const hospitalId = document.getElementById('hospitalId').value.trim();
                const position = document.getElementById('position').value;
                const buttonColor = document.getElementById('buttonColor').value;
                const partnerDataText = document.getElementById('partnerData').value.trim();
                
                if (!apiKey) {
                    throw new Error('API KeyëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.');
                }
                
                let partnerData = null;
                if (partnerDataText) {
                    try {
                        partnerData = JSON.parse(partnerDataText);
                    } catch (e) {
                        throw new Error('íŒŒíŠ¸ë„ˆ ë°ì´í„° JSON í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    }
                }
                
                // ìœ„ì ¯ ìƒì„±
                widget = new WelnoRagChatWidget({
                    apiKey: apiKey,
                    baseUrl: baseUrl,
                    uuid: uuid,
                    hospitalId: hospitalId,
                    position: position,
                    buttonColor: buttonColor,
                    partnerData: partnerData,
                    
                    // ì½œë°± ì„¤ì •
                    onOpen: () => {
                        addLog('ìœ„ì ¯ì´ ì—´ë ¸ìŠµë‹ˆë‹¤.', 'success');
                    },
                    onClose: () => {
                        addLog('ìœ„ì ¯ì´ ë‹«í˜”ìŠµë‹ˆë‹¤.', 'info');
                    },
                    onMessage: (message) => {
                        addLog(`ë©”ì‹œì§€: [${message.role}] ${message.content.substring(0, 50)}...`, 'info');
                    },
                    onError: (error) => {
                        addLog(`ì—ëŸ¬: ${error.message}`, 'error');
                    }
                });
                
                // ì´ˆê¸°í™”
                widget.init();
                
                addLog('ìœ„ì ¯ ì´ˆê¸°í™” ì™„ë£Œ', 'success');
                showStatus('ìœ„ì ¯ì´ ì„±ê³µì ìœ¼ë¡œ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                
            } catch (error) {
                addLog(`ì´ˆê¸°í™” ì‹¤íŒ¨: ${error.message}`, 'error');
                showStatus(`ì´ˆê¸°í™” ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }
        
        // ìœ„ì ¯ ì—´ê¸°
        function openWidget() {
            if (!widget) {
                showStatus('ë¨¼ì € ìœ„ì ¯ì„ ì´ˆê¸°í™”í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            widget.open();
        }
        
        // ìœ„ì ¯ ë‹«ê¸°
        function closeWidget() {
            if (!widget) {
                showStatus('ë¨¼ì € ìœ„ì ¯ì„ ì´ˆê¸°í™”í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            widget.close();
        }
        
        // ìœ„ì ¯ ì œê±°
        function destroyWidget() {
            if (!widget) {
                showStatus('ì œê±°í•  ìœ„ì ¯ì´ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            widget.destroy();
            widget = null;
            
            addLog('ìœ„ì ¯ì´ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
            showStatus('ìœ„ì ¯ì´ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        }
        
        // API ì—°ê²° í…ŒìŠ¤íŠ¸
        async function testAPI() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const baseUrl = document.getElementById('baseUrl').value.trim();
            
            if (!apiKey) {
                showStatus('API Keyë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            try {
                addLog('API ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
                
                const response = await fetch(`${baseUrl}/api/v1/rag-chat/partner/status`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    addLog(`API ì—°ê²° ì„±ê³µ: ${data.partner_info.partner_name}`, 'success');
                    showStatus(`API ì—°ê²° ì„±ê³µ! íŒŒíŠ¸ë„ˆ: ${data.partner_info.partner_name}`, 'success');
                } else {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.detail || `HTTP ${response.status}`);
                }
                
            } catch (error) {
                addLog(`API ì—°ê²° ì‹¤íŒ¨: ${error.message}`, 'error');
                showStatus(`API ì—°ê²° ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }
        
        // ë¡œê·¸ ì§€ìš°ê¸°
        function clearLog() {
            const log = document.getElementById('log');
            log.innerHTML = '<div class="log-entry info">[INFO] ë¡œê·¸ê°€ ì§€ì›Œì¡ŒìŠµë‹ˆë‹¤.</div>';
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìƒ˜í”Œ ë°ì´í„° ì„¤ì •
        document.addEventListener('DOMContentLoaded', () => {
            const sampleData = {
                "patient_info": {
                    "name": "ê¹€í…ŒìŠ¤íŠ¸",
                    "age": 35,
                    "gender": "M",
                    "height": 175,
                    "weight": 70
                },
                "health_metrics": {
                    "bmi": 22.9,
                    "blood_pressure": "120/80",
                    "blood_sugar": 95,
                    "cholesterol": 180,
                    "checkup_date": "2024-01-15"
                }
            };
            
            document.getElementById('partnerData').value = JSON.stringify(sampleData, null, 2);
            addLog('ìƒ˜í”Œ ë°ì´í„°ê°€ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        });
    </script>
</body>
</html>