/**
 * 통합 건강 타임라인 스타일
 * 현재 디자인 시스템 톤 유지하면서 모던한 아코디언 형태 구현
 */
@use '../../../styles/variables' as *;

.unified-timeline {
  width: 100%;
  max-width: 800px;
  margin: 0 auto;
  padding: $spacing-sm 4px 150px 4px; // 하단에 플로팅 버튼 영역만큼 패딩 추가 (더 크게)
  font-family: $font-family-base;

  // 로딩 상태
  .timeline-loading {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 300px;
    
    .loading-spinner {
      text-align: center;
      
      .spinner {
        width: 40px;
        height: 40px;
        border: 3px solid $gray-200;
        border-top: 3px solid $brand-brown;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto $spacing-md;
      }
      
      p {
        color: $gray-600;
        font-size: $font-base;
      }
    }
  }

  // 빈 상태
  .timeline-empty {
    text-align: center;
    padding: $spacing-2xl;
    color: $gray-600;
    
    .empty-icon {
      margin-bottom: $spacing-lg;
      
      svg {
        width: 48px;
        height: 48px;
        color: $gray-400;
        stroke-width: 1.5;
      }
    }
    
    h3 {
      font-size: $font-xl;
      font-weight: $font-weight-semibold;
      color: $gray-800;
      margin-bottom: $spacing-sm;
    }
    
    p {
      font-size: $font-base;
      line-height: 1.5;
    }
  }

  // 헤더
  .timeline-header {
    margin-bottom: $spacing-lg; // $spacing-2xl → $spacing-lg로 축소
    
    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: $spacing-lg;
      
      .header-text {
        text-align: left;
        flex: 1;
        
        h2 {
          font-size: $font-2xl;
          font-weight: $font-weight-bold;
          color: $gray-900;
          margin-bottom: $spacing-xs; // $spacing-sm → $spacing-xs로 축소
        }
        
        p {
          font-size: $font-base;
          color: $gray-600;
          line-height: 1.5;
        }
      }
      
      .view-toggle {
        display: flex;
        background: $gray-100;
        border-radius: $border-radius-lg;
        padding: 4px;
        gap: 2px;
        
        .toggle-btn {
          display: flex;
          align-items: center;
          justify-content: center;
          width: 32px;
          height: 32px;
          border: none;
          background: transparent;
          border-radius: $border-radius-md;
          cursor: pointer;
          transition: all 0.2s ease;
          color: $gray-500;
          
          svg {
            width: 10px;
            height: 10px;
            stroke-width: 2;
          }
          
          img {
            width: 10px;
            height: 10px;
            object-fit: contain;
          }
          
          &:hover {
            color: $gray-700;
            background: rgba(255, 255, 255, 0.5);
          }
          
          &.active {
            background: $white;
            color: $brand-brown;
            box-shadow: $shadow-sm;
          }
          
          // 각 타입별 색상 통일
          &.checkup {
            &.active {
              color: $brand-brown;
              background: rgba(139, 69, 19, 0.1); // 갈색 배경
            }
            &:hover {
              color: $brand-brown;
              background: rgba(139, 69, 19, 0.05); // 갈색 호버 배경
            }
          }
          
          &.pharmacy {
            &.active {
              background: rgba(245, 158, 11, 0.1);
            }
            &:hover {
              background: rgba(245, 158, 11, 0.05);
            }
          }
          
          &.treatment {
            &.active {
              color: $info;
              background: rgba(66, 153, 225, 0.1);
            }
            &:hover {
              color: $info;
              background: rgba(66, 153, 225, 0.05);
            }
          }
        }
      }
    }
  }

  // 타임라인 컨텐츠
  .timeline-content {
    .year-section {
      margin-bottom: $spacing-md; // 년도 섹션 간격 축소 (xl → md)
      margin-left: 0; // 년도 왼쪽 마진 제거
      
      &:last-child {
        margin-bottom: 0;
      }
    }
    
    .month-section {
      margin-bottom: $spacing-sm; // 월 섹션 간격 더 축소 (md → sm)
      margin-left: 8px; // 년도에서 들여쓰기 (16px → 8px)
      
      &:last-child {
        margin-bottom: 0;
      }
    }
    
    .date-section {
      margin-bottom: $spacing-xs; // 날짜 섹션 간격 더 축소 (sm → xs)
      margin-left: 12px; // 월에서 들여쓰기 (16px → 12px)
      
      &:last-child {
        margin-bottom: 0;
      }
    }
    
    .year-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 2px; // 년도-월 간격 최소화 (4px → 2px)
      padding: 8px 0; // 상하 패딩 추가
      border-bottom: none; // 하단 줄 제거
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); // 부드러운 전환
      
      // sticky 상태일 때만 sticky 적용
      &.is-sticky {
        position: sticky;
        top: 0; // 스크롤 컨테이너 상단에 고정
        z-index: 12; // date-header(10)보다 위
        background: #F5F5F5; // 배경색 설정 (스크롤 시 투과 방지)
      }
      
      .year-title {
        font-size: $font-lg; // $font-xl에서 $font-lg로 축소
        font-weight: $font-weight-bold;
        color: $brand-brown; // 진한 갈색으로 변경
        margin: 0;
      }
      
      .year-count {
        font-size: $font-base;
        color: $gray-500;
        background: transparent; // 배경 제거
        padding: 0; // 패딩 제거
        border-radius: 0; // 보더 반경 제거
      }
    }
    
    .month-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 2px; // 월 헤더 하단 간격 더 축소 (xs → 2px)
      margin-top: 0; // 년도와 가깝게 (음수 마진 제거)
      padding: 8px 0; // 상하 패딩 추가
      border-bottom: none; // 하단 줄 제거
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); // 부드러운 전환
      
      // sticky 상태일 때만 sticky 적용
      &.is-sticky {
        position: sticky;
        top: 0; // 스크롤 컨테이너 상단에 고정
        z-index: 11; // date-header(10)보다 위, year-header(12)보다 아래
        background: #F5F5F5; // 배경색 설정 (스크롤 시 투과 방지)
      }
      
      .month-title {
        font-size: $font-base;
        font-weight: $font-weight-semibold;
        color: $gray-700;
        margin: 0;
      }
      
      .month-count {
        font-size: $font-sm;
        color: $gray-500;
        background: transparent;
        padding: 0;
      }
    }
    
    .date-header {
      padding: 8px 0 4px 0; // 상하 패딩 추가 (고정 시 가독성 향상)
      margin-bottom: 2px; // 날짜 헤더 하단 간격 대폭 축소
      margin-top: -8px; // 상단 패딩 상쇄
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); // 더 부드러운 전환 (ease-in-out)
      
      // sticky 상태일 때만 sticky 적용
      &.is-sticky {
        position: sticky;
        top: 0; // 스크롤 컨테이너 상단에 고정
        z-index: 10; // 다른 요소 위에 표시
        background: #F5F5F5; // 배경색 설정 (스크롤 시 투과 방지)
      }
      
      .date-title {
        font-size: $font-sm; // 폰트 크기 축소 (sm → xs)
        font-weight: $font-weight-semibold; // sticky 시 가독성을 위해 semibold로 변경
        color: $gray-700; // 색상 진하게 (500 → 700, 가독성 향상)
        background: transparent;
        padding: 0;
        border-radius: 0;
        display: inline-block;
      }
      
      // sticky 상태일 때 스타일 (년도/월/날짜 합쳐서 표시)
      &.is-sticky {
        padding: 10px 0 6px 0; // 패딩 조정
        background: #F5F5F5;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05); // 그림자 추가
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); // 부드러운 전환
        
        .date-title {
          font-size: $font-base; // sticky 시 폰트 크기 증가
          font-weight: $font-weight-semibold;
          color: $gray-800; // 더 진한 색상
          transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); // 부드러운 전환
        }
      }
    }
    
    .records-list {
      display: flex;
      flex-direction: column;
      gap: $spacing-xs; // 카드 간격 더 축소 (sm → xs)
      margin-left: 8px; // 아이템 시작 x 좌표를 오른쪽으로 이동 (음수 → 양수)
      
      .record-item-wrapper {
        display: flex;
        align-items: flex-start;
        gap: 2px; // 날짜와 카드 사이 간격 더 최소화 (4px → 2px)
        
        .record-date-external {
          display: none; // 외부 날짜 표시 숨김 (날짜 헤더가 있으므로 중복 제거)
        }
        
        .record-item {
          flex: 1;
          background: rgba(255, 255, 255, 0.7); // 투명도 추가
          border: 1px solid $gray-200;
          border-radius: $border-radius-lg;
          overflow: hidden;
          transition: all 0.3s ease;
          backdrop-filter: blur(10px); // 배경 블러 효과
          
          &:hover {
            background: rgba(255, 255, 255, 0.9); // 호버 시 더 불투명하게
            border-color: $gray-300;
            box-shadow: $shadow-sm;
          }
          
          &.expanded {
            background: rgba(255, 255, 255, 0.95); // 펼쳐졌을 때 더 불투명하게
            border-color: $brand-brown;
            box-shadow: $shadow-md;
            
            .record-content {
              // DOM이 추가된 후 transition 활성화 (requestAnimationFrame으로 처리)
              transition: max-height 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94), 
                          opacity 0.3s ease-out 0s,
                          padding 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
              
              max-height: 2000px; // 충분히 큰 값
              padding: $spacing-lg; // 패딩 복원
              will-change: max-height, opacity, padding; // 성능 최적화
              
              // 스피너가 있을 때: 뿌옅게 펼쳐지고 스피너는 선명하게
              &.has-loading {
                opacity: 0.3; // 뿌옅게 펼쳐짐
                
                .medication-loading {
                  opacity: 1; // 스피너는 선명하게 (펼쳐질 때부터 보임)
                }
              }
              
              // 스피너가 없어지면: 뿌연 것도 부드럽게 사라지고 선명하게
              &.has-content {
                opacity: 1; // 전체 선명하게
                transition: opacity 0.4s ease-out; // 부드럽게 전환
              }
            }
            
            // 닫힐 때: expanded가 제거되면서 전환
            &:not(.expanded) .record-content {
              transition: max-height 0.6s cubic-bezier(0.4, 0, 0.2, 1),
                          opacity 0.4s ease-in 0s,
                          padding 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            }
          }
          
          // 타입별 좌측 보더 (더 얇게)
          &.checkup {
            border-left: 2px solid $brand-brown; // 갈색으로 변경
          }
          
          &.prescription {
            border-left: 2px solid $info;
          }
          
          &.pharmacy {
            border-left: 2px solid $warning;
          }
          
          // 검진 아이템 펼쳤을 때 배경색
          &.checkup {
            .record-content {
              background: #FEF9EE; // 처방약품 섹션과 동일한 배경색
            }
          }
        }
      }
      
      .record-header {
        display: flex;
        align-items: flex-start;
        padding: $spacing-sm; // 패딩 더 축소 (md → sm)
        cursor: pointer;
        transition: background-color 0.2s ease;
        
        &:hover {
          background: $gray-50;
        }
        
        .record-icon {
          margin-right: $spacing-md; // 간격 조금 늘림
          flex-shrink: 0;
          
          .icon-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: none; // 외곽선 없음
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            font-size: 14px;
            font-weight: $font-weight-medium;
            white-space: nowrap;
            
            span {
              display: inline-block;
            }
            
            &.checkup {
              background: #F5F0E8; // 베이지 배경
              color: #8B4513; // 갈색 텍스트
            }
            
            &.prescription {
              background: #E3F2FD; // 파란색 배경
              color: #1976D2; // 파란색 텍스트
            }
            
            &.pharmacy {
              background: #FFF3E0; // 오렌지/피치 배경
              color: #F57C00; // 오렌지 텍스트
            }
          }
        }
        
        .record-info {
          flex: 1;
          min-width: 0;
          
          .record-main {
            display: flex;
            align-items: center;
            gap: $spacing-xs;
            margin-bottom: 4px;
            flex-wrap: nowrap;
            white-space: nowrap;
            overflow: hidden; // 컨테이너 오버플로우 숨김
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            font-size: 14px;
            
            .record-title {
              font-size: 14px;
              font-weight: $font-weight-semibold;
              color: $gray-900;
              flex-shrink: 0;
            }
            
            .record-separator {
              color: $gray-400;
              font-size: 14px;
              flex-shrink: 0;
            }
            
            .record-institution {
              font-size: 14px;
              font-weight: $font-weight-medium;
              color: $gray-700;
              flex-shrink: 2; // 더 많이 축소 가능하도록
              min-width: 0;
              overflow: hidden;
              text-overflow: ellipsis;
              max-width: 180px; // 최대 너비 제한 증가 (120px → 180px)
              margin-right: 4px; // 오른쪽 여유 공간 추가
              transition: all 0.2s ease;
              
              // 확장되지 않았을 때: 말줄임표
              &:not(.expanded) {
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
              }
              
              // 확장되었을 때: 전체 표시
              &.expanded {
                max-width: none;
                white-space: normal;
                overflow: visible;
                text-overflow: clip;
                flex-shrink: 0;
                word-break: break-word;
              }
              
              // 7글자 이상일 때만 클릭 가능 및 호버 효과
              &.clickable {
                &:hover {
                  color: $brand-brown;
                  text-decoration: underline;
                }
              }
            }
            
            .record-treatment {
              font-size: 14px;
              color: $gray-600;
              flex-shrink: 3; // 가장 많이 축소 가능하도록
              min-width: 0;
              overflow: hidden;
              text-overflow: ellipsis;
              max-width: 80px; // 최대 너비 제한
            }
            
            .record-status {
              font-size: $font-sm;
              font-weight: $font-weight-medium;
              padding: 2px 6px;
              border-radius: $border-radius-sm;
              background: rgba(255, 255, 255, 0.8);
              border: 1px solid currentColor;
              flex-shrink: 0;
              margin-left: 4px; // auto에서 고정값으로 변경
              max-width: 60px; // 최대 너비 제한 추가
              overflow: hidden;
              text-overflow: ellipsis;
              white-space: nowrap;
            }
          }
          
          .record-meta {
            display: flex;
            align-items: center;
            gap: $spacing-xs;
            margin-bottom: $spacing-xs;
            font-size: $font-base;
            color: $gray-600;
            
            .record-separator {
              color: $gray-400;
            }
            
            .record-institution {
              font-weight: $font-weight-medium;
            }
          }
          
          .record-summary {
            display: flex;
            flex-wrap: wrap;
            gap: $spacing-xs;
            font-size: $font-sm;
            
            .treatment-type,
            .visit-count,
            .medication-count,
            .prescription-count {
              background: #F2F2F2;
              color: #626262;
              padding: 2px 6px;
              border-radius: $border-radius-sm;
              font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
              font-size: 10px;
              font-weight: $font-weight-medium;
            }
            
            // 검진 상태 뱃지 (정상, 경계, 이상)
            .checkup-status-badge {
              padding: 2px 6px;
              border-radius: $border-radius-sm;
              font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
              font-size: 10px;
              font-weight: $font-weight-medium;
              
              &.status-normal {
                background: rgba(139, 69, 19, 0.1); // 갈색 배경
                color: $brand-brown; // 갈색 텍스트
                border: 1px solid rgba(139, 69, 19, 0.3); // 갈색 보더
              }
              
              &.status-warning {
                background: rgba(245, 158, 11, 0.1);
                color: $warning;
                border: 1px solid rgba(245, 158, 11, 0.3);
              }
              
              &.status-abnormal {
                background: rgba(239, 68, 68, 0.1);
                color: #ef4444;
                border: 1px solid rgba(239, 68, 68, 0.3);
              }
            }
          }
        }
        
        .record-toggle {
          flex-shrink: 0;
          margin-left: 4px; // $spacing-sm에서 고정값으로 변경
          display: flex;
          align-items: center;
          gap: $spacing-xs;
          
          .toggle-button {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px; // 28px에서 24px로 축소
            height: 24px; // 28px에서 24px로 축소
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid $gray-300;
            cursor: pointer;
            transition: all 0.2s ease;
            
            &:hover {
              background: rgba(255, 255, 255, 1);
              border-color: $gray-400;
              box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }
            
            &:active {
              transform: scale(0.95);
            }
          }
          
          .toggle-icon {
            width: 16px;
            height: 16px;
            color: $gray-500;
            transition: transform 0.3s ease, color 0.2s ease;
            
            .toggle-button:hover & {
              color: $gray-700;
            }
            
            &.medication-icon {
              color: $info;
              
              &:hover {
                color: darken($info, 10%);
              }
            }
          }
          
          .medication-badge {
            width: 20px;
            height: 20px;
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid $warning;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            
            &:hover {
              background: rgba(245, 158, 11, 0.2);
              transform: scale(1.1);
            }
            
            img {
              width: 12px;
              height: 12px;
              object-fit: contain;
            }
          }
        }
        
        &.expanded .record-toggle .toggle-button .toggle-icon {
          transform: rotate(180deg);
        }
      }
      
      .record-content {
        border-top: 1px solid $gray-100;
        padding: $spacing-lg;
        background: $gray-50;
        max-height: 0;
        overflow: hidden;
        opacity: 0;
        padding-top: 0;
        padding-bottom: 0;
        will-change: max-height, opacity, padding; // 성능 최적화
        // 초기에는 transition 없음 (덜컥거림 방지)
        transition: none;
        
        // 약품 리스트 로딩 스피너 (WELNO 로고 아이콘 작고 투명하게)
        .medication-loading {
          display: flex;
          justify-content: center;
          align-items: center;
          min-height: 60px;
          opacity: 1; // 펼쳐질 때부터 바로 보임
          position: relative; // z-index를 위한 상대 위치
          z-index: 1; // 스피너가 위에 보이도록
          
          .loading-spinner-small {
            .welno-icon-blink-small {
              width: 24px;
              height: 24px;
              object-fit: contain;
              animation: faviconBlink 1.5s ease-in-out infinite;
              opacity: 0.5; // 투명하게
              filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
            }
          }
        }
        
        // 약품 리스트 페이드인
        .medication-content-fade {
          opacity: 0.3; // 뿌옅게 시작 (스피너가 있을 때)
          animation: fadeInToFull 0.4s ease forwards; // 스피너 사라진 후 선명하게 (부드럽게)
          position: relative;
        }
      }
    }
  }

  // 상세 정보 스타일
  .record-details {
    .details-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: $spacing-md;
      margin-bottom: $spacing-lg;
      
      .detail-item {
        display: flex;
        flex-direction: column;
        gap: 4px;
        
        .detail-label {
          font-size: $font-sm;
          font-weight: $font-weight-medium;
          color: $gray-500;
          text-transform: uppercase;
          letter-spacing: 0.5px;
        }
        
        .detail-value-container {
          display: flex;
          flex-direction: column;
          gap: 2px;
          
          .detail-value {
            font-size: $font-base;
            font-weight: $font-weight-semibold;
            color: $gray-900;
          }
          
          .detail-reference {
            font-size: $font-sm;
            color: $gray-500;
            line-height: 1.3;
          }
        }
        
        .detail-value {
          font-size: $font-base;
          font-weight: $font-weight-semibold;
          color: $gray-900;
        }
      }
    }
    
    .detail-description {
      .detail-label {
        font-size: $font-sm;
        font-weight: $font-weight-medium;
        color: $gray-500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: $spacing-xs;
        display: block;
      }
      
      .detail-text {
        font-size: $font-base;
        color: $gray-700;
        line-height: 1.5;
        margin: 0;
        padding: $spacing-sm;
        background: $white;
        border-radius: $border-radius-md;
        border: 1px solid $gray-200;
      }
      
      .detail-raw {
        font-size: $font-base;
        color: $gray-700;
        line-height: 1.5;
        
        p {
          margin: 4px 0;
        }
      }
    }
    
    // 처방전 전용 스타일
    .prescription-summary {
      margin-bottom: $spacing-lg;
      
      .summary-stats {
        display: flex;
        gap: $spacing-lg;
        
        .stat-item {
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 4px;
          
          .stat-label {
            font-size: $font-sm;
            font-weight: $font-weight-medium;
            color: $gray-500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
          }
          
          .stat-value {
            font-size: $font-lg;
            font-weight: $font-weight-bold;
            color: $brand-brown;
          }
        }
      }
    }
    
    .medication-list {
      margin-bottom: 8px; // 섹션 바깥쪽 여백 줄임
      
      .detail-label {
        font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
        font-size: 12px; // 폰트 크기 12px
        font-weight: $font-weight-medium; // 미디엄
        color: #626262; // 폰트 색상
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 8px; // 여백 줄임
        display: block;
      }
      
      .medications {
        display: flex;
        flex-direction: column;
        gap: $spacing-xs;
        background: #FEF9EE; // 배경색 추가
        padding: $spacing-sm; // 내부 여백 추가
        border-radius: $border-radius-md; // 모서리 둥글게
        margin-top: 0; // 상단 여백 제거
        
        .medication-item {
          display: flex;
          flex-direction: column;
          padding: 6px $spacing-sm; // 상하 여백 줄임 (상단 6px, 하단 6px)
          background: $white;
          border: 1px solid $gray-200;
          border-radius: $border-radius-md;
          
          .medication-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1px; // 약품명과 효과 설명 사이 간격 더 줄임 (2px -> 1px)
            
            .medication-name {
              font-size: 14px; // 위에 글자 크기
              font-weight: $font-weight-semibold; // 세미볼드
              color: $gray-900;
              flex: 1;
              
              &.clickable {
                cursor: pointer;
                color: $brand-brown;
                text-decoration: underline;
                text-decoration-color: transparent;
                transition: all 0.2s ease;
                
                &:hover {
                  color: darken($brand-brown, 10%);
                  text-decoration-color: currentColor;
                  background: rgba($brand-brown, 0.05);
                  padding: 2px 4px;
                  border-radius: 4px;
                  margin: -2px -4px;
                }
                
                &:active {
                  transform: scale(0.98);
                }
              }
            }
            
            .medication-duration {
              font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
              font-size: 10px; // 폰트 크기 10px
              color: #A16A51; // 폰트 색상
              background: #F8EDDA; // 배경색
              padding: 1px 4px; // 뱃지 크기에 맞게 줄임
              border-radius: $border-radius-sm;
              flex-shrink: 0;
              line-height: 1.2; // 줄 간격 조정
            }
          }
          
          .medication-description {
            .medication-effect {
              font-size: 12px; // 아래 글자 크기
              font-weight: $font-weight-medium; // 미디엄
              color: $gray-600;
              line-height: 1.4;
            }
          }
        }
        
        .medication-more {
          font-size: $font-sm;
          color: $gray-500;
          text-align: center;
          padding: $spacing-sm;
          background: $gray-100;
          border-radius: $border-radius-md;
        }
      }
    }
  }

  // 푸터
  .timeline-footer {
    text-align: center;
    margin-top: $spacing-2xl;
    padding-top: $spacing-lg;
    border-top: 1px solid $gray-200;
    
    .last-update {
      font-size: $font-sm;
      color: $gray-500;
      margin: 0;
    }
  }

  // 가로형 레이아웃
  &.horizontal {
    .timeline-content {
      .records-list {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: $spacing-lg;
        
        .record-item-wrapper {
          display: flex;
          flex-direction: column;
          gap: $spacing-xs;
          
          .record-date-external {
            align-self: flex-start;
            margin-bottom: $spacing-xs;
          }
          
          .record-item {
            height: fit-content;
            
            .record-header {
              .record-info {
                .record-main {
                  .record-title {
                    font-size: $font-base;
                  }
                }
                
                .record-meta {
                  font-size: $font-sm;
                }
                
                .record-summary {
                  margin-top: $spacing-xs;
                }
              }
            }
          
          .record-content {
            .record-details {
              .details-grid {
                grid-template-columns: 1fr;
                gap: $spacing-sm;
                
                .detail-item {
                  .detail-label {
                    font-size: 10px;
                  }
                  
                  .detail-value {
                    font-size: $font-sm;
                  }
                }
              }
              
              .prescription-summary {
                .summary-stats {
                  gap: $spacing-sm;
                  
                  .stat-item {
                    .stat-value {
                      font-size: $font-base;
                    }
                  }
                }
              }
              
              .medication-list {
                .medications {
                  .medication-item {
                    padding: $spacing-xs;
                    
                    .medication-name {
                      font-size: $font-sm;
                    }
                  }
                }
              }
            }
          }
          }
        }
      }
    }
    
    // 가로형에서 년도 헤더 조정
    .year-header {
      position: sticky;
      top: 0;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      z-index: 10;
      margin-bottom: $spacing-lg;
      padding: $spacing-sm 0;
      border-radius: $border-radius-lg;
    }
  }

  // 반응형 디자인
  @media (max-width: $breakpoint-sm) {
    padding: $spacing-md;
    
    .timeline-header {
      margin-bottom: $spacing-md; // $spacing-xl → $spacing-md로 대폭 축소
      
      .header-content {
        flex-direction: row; // column → row로 변경 (한 줄 유지)
        justify-content: space-between; // 양쪽 끝 정렬
        align-items: flex-end; // 하단 정렬로 변경 (설명 텍스트 높이에 맞춤)
        gap: $spacing-sm;
        
        .header-text {
          flex: 1; // 남은 공간 차지
          
          h2 {
            font-size: $font-lg; // $font-xl → $font-lg로 축소
            margin-bottom: 2px; // 더 작은 마진
          }
          
          p {
            font-size: $font-sm; // 설명 텍스트도 더 작게
            line-height: 1.4;
          }
        }
        
        .view-toggle {
          align-self: flex-end; // 하단 정렬 (설명 텍스트와 같은 높이)
          padding: 2px; // 더 작은 패딩
          flex-shrink: 0; // 크기 고정
          margin-bottom: 1px; // 미세 조정
          
          .toggle-btn {
            width: 28px; // 32px → 28px로 축소
            height: 28px; // 32px → 28px로 축소
            
            svg {
              width: 12px; // 14px → 12px로 축소
              height: 12px;
            }
          }
        }
      }
    }
    
    // 모바일 년도 헤더 최적화
    .timeline-content {
      .year-section {
        margin-bottom: $spacing-md; // 모바일에서도 컴팩트하게
      }
      
      .year-header {
        margin-bottom: $spacing-sm; // 더 작은 마진
        padding-bottom: $spacing-xs;
        
        .year-title {
          font-size: $font-base; // 모바일에서 더 작게
        }
        
        .year-count {
          font-size: $font-sm; // 더 작은 폰트
        }
      }
    }
    
    // 가로형 레이아웃 모바일 조정
    &.horizontal {
      .timeline-content {
        .records-list {
          grid-template-columns: 1fr;
          gap: $spacing-sm; // $spacing-md → $spacing-sm로 축소
        }
      }
    }
    
    .record-item-wrapper {
      gap: $spacing-sm !important;
      
      .record-date-external {
        font-size: $font-sm !important;
        padding: 2px 6px !important;
        min-width: 50px !important;
      }
    }
    
    .record-header {
      padding: $spacing-md !important;
      
      .record-icon {
        margin-right: $spacing-sm;
        
        .icon-badge {
          width: 44px !important;
          height: 44px !important;
          font-size: 14px !important;
          
          svg {
            width: 14px !important;
            height: 14px !important;
          }
          
          img {
            width: 14px !important;
            height: 14px !important;
          }
        }
      }
      
      .record-info {
        .record-main {
          flex-direction: row;
          align-items: center;
          gap: $spacing-xs;
          flex-wrap: nowrap;
          
          .record-title {
            font-size: $font-sm !important;
          }
          
          .record-institution,
          .record-treatment {
            font-size: $font-sm !important;
          }
          
          .record-separator {
            font-size: $font-sm !important;
          }
        }
        
        .record-meta {
          flex-wrap: wrap;
        }
      }
    }
    
    .record-content {
      padding: $spacing-md !important;
    }
    
    .details-grid {
      grid-template-columns: 1fr !important;
      gap: $spacing-sm !important;
    }
    
    .prescription-summary .summary-stats {
      justify-content: space-around;
      gap: $spacing-md;
    }
  }
}

// 애니메이션
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

// 파비콘 블링크 애니메이션
@keyframes faviconBlink {
  0%, 100% { 
    opacity: 1; 
    transform: scale(1);
  }
  50% { 
    opacity: 0.3; 
    transform: scale(0.95);
  }
}

// 고도화된 검진 카드 스타일
.advanced-checkup-details {
  // 배경색 제거 (record-content에 적용)
  
  .status-badges {
    display: flex;
    gap: $spacing-xs;
    margin-bottom: $spacing-lg;
    flex-wrap: wrap;
    
    .status-badge {
      padding: 4px 8px;
      border-radius: $border-radius-md;
      font-size: $font-sm;
      font-weight: $font-weight-medium;
      border: none;
      cursor: pointer;
      transition: all 0.2s ease;
      
      &:hover {
        transform: translateY(-1px);
        box-shadow: $shadow-sm;
      }
      
      &.active {
        transform: scale(1.05);
        box-shadow: $shadow-md;
      }
      
      &.status-normal {
        background: rgba(139, 69, 19, 0.1); // 갈색 배경
        color: $brand-brown; // 갈색 텍스트
        border: 1px solid rgba(139, 69, 19, 0.3); // 갈색 보더
        
        &.active {
          background: rgba(139, 69, 19, 0.2);
          border-color: $brand-brown;
        }
      }
      
      &.status-warning {
        background: rgba(245, 158, 11, 0.1);
        color: $warning;
        border: 1px solid rgba(245, 158, 11, 0.3);
        
        &.active {
          background: rgba(245, 158, 11, 0.2);
          border-color: $warning;
        }
      }
      
      &.status-abnormal {
        background: rgba(239, 68, 68, 0.1);
        color: #ef4444;
        border: 1px solid rgba(239, 68, 68, 0.3);
        
        &.active {
          background: rgba(239, 68, 68, 0.2);
          border-color: #ef4444;
        }
      }
    }
  }
  
  .group-slider {
    display: flex;
    gap: 2px; // 간격 줄임 (4px -> 2px)
    margin-bottom: 8px; // 탭과 카드 사이 간격 줄임 ($spacing-lg -> 8px)
    background: transparent; // 배경색 투명
    border-radius: $border-radius-lg;
    padding: 3px; // 패딩 줄임 (4px -> 3px)
    overflow-x: auto;
    
    .group-tab {
      padding: 4px 8px; // 패딩 줄임 (8px 12px -> 4px 8px)
      border: none;
      background: transparent; // 배경색 통일
      border-radius: $border-radius-md;
      font-size: 11px; // 폰트 크기 줄임 ($font-sm -> 11px)
      font-weight: $font-weight-medium;
      color: $gray-600;
      cursor: pointer;
      transition: all 0.2s ease;
      white-space: nowrap;
      flex-shrink: 0;
      position: relative; // 하단 줄을 위한 상대 위치
      
      &:hover {
        background: transparent; // 배경색 통일 (hover 시에도 배경 없음)
        color: $gray-800;
      }
      
      &.active {
        background: transparent; // 배경색 통일
        color: #A16A51; // 하단 줄 색과 동일하게
        box-shadow: none; // 그림자 제거
        
        // 하단에 A16A51 색으로 줄 그리기
        &::after {
          content: '';
          position: absolute;
          bottom: 0;
          left: 0;
          right: 0;
          height: 2px;
          background: #A16A51;
          border-radius: 2px 2px 0 0;
        }
      }
    }
  }
  
  // 기존 세로 레이아웃 (백업용)
  .group-items {
    display: flex;
    flex-direction: column;
    gap: $spacing-md;
    
    .checkup-item {
      background: rgba(255, 255, 255, 0.8);
      border: 1px solid $gray-200;
      border-radius: $border-radius-lg;
      padding: $spacing-md;
      transition: all 0.2s ease;
      backdrop-filter: blur(5px);
      
      &:hover {
        background: rgba(255, 255, 255, 0.95);
        box-shadow: $shadow-sm;
      }
      
      &.status-abnormal { border-left: 2px solid #ef4444; }
      &.status-warning { border-left: 2px solid $warning; }
      &.status-normal { border-left: 2px solid $brand-brown; } // 갈색으로 변경
    }
  }
  
  // 슬라이더 컨테이너
  .slider-container {
    position: relative;
  }

  // 새로운 가로 슬라이더 레이아웃
  .group-items-slider {
    display: flex;
    gap: $spacing-md;
    overflow-x: auto;
    padding: $spacing-xs 0 $spacing-lg 0;
    scroll-snap-type: x mandatory;
    scroll-behavior: smooth;
    
    // 스크롤바 숨기기 (닷 인디케이터로 대체)
    scrollbar-width: none;
    -ms-overflow-style: none;
    &::-webkit-scrollbar {
      display: none;
    }
    
    .checkup-item-card {
      min-width: 200px;
      max-width: 250px;
      flex-shrink: 0;
      background: rgba(255, 255, 255, 0.8);
      border: 1px solid $gray-200;
      border-radius: $border-radius-lg;
      padding: $spacing-md;
      transition: all 0.2s ease;
      backdrop-filter: blur(5px);
      scroll-snap-align: start;
      position: relative; // 뱃지 절대 위치를 위한 상대 위치
      display: flex; // flex 레이아웃
      flex-direction: column; // 세로 방향
      
      &:hover {
        background: rgba(255, 255, 255, 0.95);
        box-shadow: $shadow-sm;
        transform: translateY(-2px);
      }
      
      // 왼쪽 라인 색상 제거 (깔끔한 디자인을 위해)
      
      // 상태 뱃지 - 우상단 배치
      .status-badge {
        position: absolute;
        top: calc(#{$spacing-xs} + 4px); // 조금 아래로 이동
        right: $spacing-xs;
        padding: 1px 6px; // 2px 8px → 1px 6px로 축소
        border-radius: 8px; // 12px → 8px로 축소
        font-size: 8px; // 10px - 2px
        font-weight: 600;
        color: white;
        
        &.status-normal {
          background: #61A82C; // 정상 뱃지 색상
        }
        
        &.status-warning {
          background: #EE6A31; // 경계 뱃지 색상
        }
        
        &.status-abnormal {
          background: #D73F3F; // 이상 뱃지 색상
        }
      }
      
      // 항목명 스타일
      .item-name-only {
        font-size: calc(#{$font-base} - 2px); // -2px
        font-weight: 600;
        color: $gray-800;
        margin-bottom: $spacing-xs;
        padding-right: 60px; // 뱃지 공간 확보
      }
      
      // 통합 신체계측 카드 스타일
      .body-measurements {
        display: flex;
        flex-direction: column;
        gap: calc(#{$spacing-xs} / 2); // 간격 반으로 줄임
        margin-bottom: $spacing-sm;
        
        .measurement-item {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 2px 0; // 간격 반으로 줄임 (4px -> 2px)
          
          .measurement-label {
            font-size: calc(#{$font-base} - 2px); // -2px
            color: $gray-600;
            font-weight: 500;
          }
          
          .measurement-value {
            font-size: calc(#{$font-lg} - 2px); // -2px
            font-weight: 600;
            color: $gray-900;
            
            .measurement-unit {
              font-size: calc(#{$font-lg} - 6px); // -4px (현재보다 -4)
              font-weight: 300; // 얇게 (볼드 제거)
              margin-left: 2px;
            }
          }
        }
      }
      
      // 기존 item-header-row 스타일 제거 (새로운 레이아웃으로 대체)
      
      .item-value-large {
        font-size: calc(#{$font-xl} - 2px); // -2px
        font-weight: $font-weight-bold;
        color: $gray-900;
        margin-bottom: $spacing-sm;
        text-align: center;
        padding: $spacing-xs 0;
        
        .item-unit {
          font-size: calc(#{$font-xl} - 6px); // -4px (현재보다 -4)
          font-weight: 300; // 얇게 (볼드 제거)
          margin-left: 2px;
        }
      }
      
      .item-references-compact {
        margin-top: auto; // 카드 하단으로 밀어내기
        padding-top: $spacing-xs; // 상단 여백
        
        .reference-line {
          display: flex;
          justify-content: space-between;
          align-items: center;
          font-size: calc(#{$font-sm} - 2px); // -2px
          color: $gray-600;
          margin-bottom: 2px;
          
          &:last-child {
            margin-bottom: 0;
          }
          
          .ref-label {
            font-weight: $font-weight-medium;
            color: $gray-700;
          }
          
          .ref-range {
            color: $gray-500;
            font-size: calc(#{$font-sm} - 2px); // -2px
          }
        }
      }
    }
  }
}

// 모바일 최적화
@media (max-width: 768px) {
  .unified-timeline {
    .timeline-item {
      .record-info {
        .record-main {
          flex-wrap: nowrap !important; // 강제로 한 줄 유지
          overflow: hidden;
          
          .record-institution {
            max-width: 70px; // 모바일에서 더 작게
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
          }
          
          .record-treatment {
            max-width: 50px; // 모바일에서 더 작게
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
          }
          
          .record-status {
            max-width: 50px; // 상태 뱃지도 제한
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin-left: 2px; // 모바일에서 더 작은 간격
          }
        }
        
        .record-toggle {
          margin-left: 2px; // 모바일에서 더 작은 간격
          
          .toggle-button {
            width: 20px; // 모바일에서 더 작게
            height: 20px; // 모바일에서 더 작게
            
            .toggle-icon {
              width: 10px; // 아이콘도 더 작게
              height: 10px;
            }
          }
          
          .pill-badge {
            width: 16px; // 약 뱃지도 더 작게
            height: 16px;
          }
        }
      }
      
      .record-header {
        padding: 8px; // 모바일에서 패딩 더 축소
        gap: 6px; // 요소 간 간격 축소
        
        .record-icon {
          margin-right: 6px; // 모바일에서 더 작은 마진
          
          .icon-badge {
            width: 44px !important; // 모바일에서도 44px 유지
            height: 44px !important;
            font-size: 14px !important;
            
            svg {
              width: 12px;
              height: 12px;
            }
          }
        }
      }
    }
  }

  .advanced-checkup-details {
    .group-slider {
      .group-tab {
        padding: 4px 8px; // 패딩 줄임
        font-size: 11px; // 폰트 크기 줄임
      }
    }
    
    .group-items-slider {
      .checkup-item-card {
        min-width: 160px;
        max-width: 180px;
        padding: $spacing-sm;
        
        .item-header-row {
          flex-direction: column;
          align-items: flex-start;
          gap: 2px;
          
          .item-divider {
            display: none;
          }
        }
        
        .item-value-large {
          font-size: $font-lg;
          margin-bottom: $spacing-xs;
        }
        
        .item-references-compact {
          .reference-line {
            font-size: 10px;
            
            .ref-range {
              font-size: 9px;
            }
          }
        }
      }
    }
    
    // 기존 세로 레이아웃 모바일 최적화
    .group-items {
      .checkup-item {
        padding: $spacing-sm;
        
        .item-header {
          flex-direction: column;
          align-items: flex-start;
          gap: $spacing-xs;
        }
        
        .item-value {
          font-size: $font-base;
        }
      }
    }
  }
}

.favicon-blink-spinner {
  display: flex;
  justify-content: center;
  align-items: center;
  margin-bottom: $spacing-md;
}

@keyframes slideDown {
  from {
    opacity: 0;
    max-height: 0;
  }
  to {
    opacity: 1;
    max-height: 500px;
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

@keyframes fadeInToFull {
  from {
    opacity: 0.3; // 뿌옅게 시작
  }
  to {
    opacity: 1; // 선명하게
  }
}

// 닷 슬라이더 인디케이터
.dot-indicators {
  display: flex;
  justify-content: center;
  gap: 4px; // $spacing-xs보다 더 작게
  margin-top: $spacing-xs; // $spacing-sm → $spacing-xs로 축소
  
  .dot {
    width: 6px; // 정확한 원형
    height: 6px; // 정확한 원형 (width와 height 동일)
    min-width: 6px; // 최소 너비 고정
    min-height: 6px; // 최소 높이 고정
    border-radius: 50%; // 완전한 원
    border: none;
    padding: 0; // 패딩 제거
    background: $gray-300;
    cursor: pointer;
    transition: all 0.2s ease;
    flex-shrink: 0; // 축소 방지
    
    &:hover {
      background: $gray-400;
      transform: scale(1.1); // 1.2 → 1.1로 축소
    }
    
    &.active {
      background: $brand-brown;
      transform: scale(1.2); // 1.3 → 1.2로 축소
    }
  }
}
