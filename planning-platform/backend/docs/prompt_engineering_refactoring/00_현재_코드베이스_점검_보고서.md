# í˜„ì¬ ì½”ë“œë² ì´ìŠ¤ ì ê²€ ë³´ê³ ì„œ

**ì ê²€ì¼:** 2025-12-06  
**ëª©ì :** ë¬¸ì§„ ì‹œìŠ¤í…œ ê°œì„  ë° í˜ë¥´ì†Œë‚˜ íŒì • ë¡œì§ ì¶”ê°€ë¥¼ ìœ„í•œ í˜„í™© íŒŒì•…  
**ì ê²€ ë²”ìœ„:** í”„ë¡ íŠ¸ì—”ë“œ ë¬¸ì§„ ì»´í¬ë„ŒíŠ¸ + ë°±ì—”ë“œ í”„ë¡¬í”„íŠ¸ ìƒì„± ë¡œì§

---

## ğŸ“‚ 1. í”„ë¡ íŠ¸ì—”ë“œ í˜„í™© ë¶„ì„

### 1.1 íŒŒì¼ ìœ„ì¹˜
```
planning-platform/frontend/src/components/checkup-design/CheckupDesignSurveyPanel/index.tsx
```

### 1.2 í˜„ì¬ êµ¬ì¡°

#### **SurveyResponses ì¸í„°í˜ì´ìŠ¤ (ë¼ì¸ 9~27)**
```typescript
export interface SurveyResponses {
  // ê¸°ë³¸ í•„ìˆ˜ ì§ˆë¬¸ (8ê°œ)
  weight_change: string;
  exercise_frequency: string;
  family_history: string[];
  smoking: string;
  drinking: string;
  sleep_hours: string;
  stress_level: string;
  additional_concerns: string;
  
  // ë¶„ê¸° ì§ˆë¬¸ (1ê°œ) âš ï¸ ì œê±° ëŒ€ìƒ
  optional_questions_enabled?: string; // 'yes' | 'no'
  
  // ì„ íƒ ì§ˆë¬¸ (7ê°œ) âš ï¸ ì œê±° ëŒ€ìƒ
  cancer_history?: string;
  hepatitis_carrier?: string;
  colonoscopy_experience?: string;
  lung_nodule?: string;
  gastritis?: string;
  imaging_aversion?: string[];
  genetic_test?: string;
}
```

**ì´ ì§ˆë¬¸ ìˆ˜:** 
- í•„ìˆ˜ 8ê°œ + ë¶„ê¸° 1ê°œ = 9ê°œ (ê¸°ë³¸)
- ì„ íƒ ì§ˆë¬¸ 7ê°œ (optional_questions_enabled='yes' ì„ íƒ ì‹œ)
- **ìµœëŒ€ 16ê°œ**

---

#### **basicQuestions ë°°ì—´ (ë¼ì¸ 90~190)**

| ìˆœì„œ | key | label | type | ìƒíƒœ |
|:----:|-----|-------|:----:|:----:|
| 1 | weight_change | ìµœê·¼ 3ê°œì›”ê°„ ì²´ì¤‘ ë³€í™”ê°€ ìˆìœ¼ì‹ ê°€ìš”? | radio | âœ… ìœ ì§€ (ì„ íƒì§€ ê°œì„  í•„ìš”) |
| 2 | exercise_frequency | ìµœê·¼ ìš´ë™ì„ í•˜ì‹œë‚˜ìš”? | radio | âœ… ìœ ì§€ |
| 3 | family_history | ê°€ì¡± ì¤‘ì— ë‹¤ìŒ ì§ˆí™˜ì´ ìˆìœ¼ì‹ ê°€ìš”? | checkbox | âœ… ìœ ì§€ |
| 4 | smoking | í¡ì—°í•˜ì‹œë‚˜ìš”? | radio | âœ… ìœ ì§€ |
| 5 | drinking | ìŒì£¼ ë¹ˆë„ëŠ”? | radio | âœ… ìœ ì§€ |
| 6 | sleep_hours | í‰ê·  ìˆ˜ë©´ ì‹œê°„ì€? | radio | âœ… ìœ ì§€ |
| 7 | stress_level | ìµœê·¼ ìŠ¤íŠ¸ë ˆìŠ¤ ìˆ˜ì¤€ì€? | radio | âœ… ìœ ì§€ |
| 8 | additional_concerns | ê²€ì§„ ì„¤ê³„ ì‹œ ê³ ë ¤í•´ì£¼ì…¨ìœ¼ë©´ í•˜ëŠ” íŠ¹ì´ì‚¬í•­ì´ë‚˜ ê³ ë¯¼ì‚¬í•­ì´ ìˆìœ¼ì‹ ê°€ìš”? | textarea | âœ… ìœ ì§€ |
| 9 | **optional_questions_enabled** | **ë” ì •í™•í•œ ê²€ì§„ ì„¤ê³„ë¥¼ ìœ„í•´ ì¶”ê°€ ì§ˆë¬¸ì— ë‹µí•˜ì‹œê² ì–´ìš”?** | radio | âŒ **ì œê±° ëŒ€ìƒ** |

---

#### **optionalQuestions ë°°ì—´ (ë¼ì¸ 193~281)** âŒ **ì „ì²´ ì œê±° ëŒ€ìƒ**

| ìˆœì„œ | key | label | type | ì œê±° ì‚¬ìœ  |
|:----:|-----|-------|:----:|---------|
| 10 | cancer_history | ê³¼ê±° ì•” ì§„ë‹¨ì„ ë°›ìœ¼ì‹  ì ì´ ìˆìœ¼ì‹ ê°€ìš”? | radio | ê°€ì¡±ë ¥(family_history)ìœ¼ë¡œ ëŒ€ì²´ ê°€ëŠ¥ |
| 11 | hepatitis_carrier | Bí˜• ë˜ëŠ” Cí˜• ê°„ì—¼ ë³´ê· ìì´ì‹ ê°€ìš”? | radio | ì„ìƒì  ì¤‘ìš”ë„ ë‚®ìŒ (ì˜ì‚¬ ì§„ë‹¨ ê¶Œì¥) |
| 12 | **colonoscopy_experience** | ëŒ€ì¥ë‚´ì‹œê²½ ê²€ì‚¬ë¥¼ ë°›ìœ¼ì‹  ì ì´ ìˆìœ¼ì‹ ê°€ìš”? | radio | **â¬†ï¸ í•„ìˆ˜ ì§ˆë¬¸ìœ¼ë¡œ ìŠ¹ê²©** |
| 13 | lung_nodule | í‰ë¶€ CTë‚˜ X-rayì—ì„œ í ê²°ì ˆì´ ë°œê²¬ëœ ì ì´ ìˆìœ¼ì‹ ê°€ìš”? | radio | í¡ì—° ì •ë³´ë¡œ ì¶”ë¡  ê°€ëŠ¥ |
| 14 | gastritis | í˜„ì¬ ë˜ëŠ” ê³¼ê±°ì— ìœ„ì—¼ì´ë‚˜ ì†Œí™”ë¶ˆëŸ‰ ì¦ìƒì´ ìˆìœ¼ì‹ ê°€ìš”? | radio | additional_concernsë¡œ ì…ë ¥ ê°€ëŠ¥ |
| 15 | imaging_aversion | ë‹¤ìŒ ê²€ì‚¬ ì¤‘ ê¸°í”¼í•˜ê±°ë‚˜ ë¶ˆí¸í•¨ì„ ëŠë¼ëŠ” ê²€ì‚¬ê°€ ìˆìœ¼ì‹ ê°€ìš”? | checkbox | colonoscopy_experienceë¡œ ëŒ€ì²´ |
| 16 | genetic_test | ê°€ì¡± ì¤‘ ìœ ì „ì„± ì•”(ë¸Œë¼ì¹´ ë³€ì´ ë“±)ì´ ì˜ì‹¬ë˜ëŠ” ê²½ìš°ê°€ ìˆìœ¼ì‹ ê°€ìš”? | radio | family_historyë¡œ ëŒ€ì²´ |

---

#### **ì¡°ê±´ë¶€ ë¡œì§ (ë¼ì¸ 284~355)** âš ï¸ **ë³µì¡ë„ ë†’ìŒ, ì œê±° í•„ìš”**

```typescript
const questions = useMemo(() => {
  const allQuestions = [...basicQuestions];
  
  // optional_questions_enabledê°€ 'yes'ì¸ ê²½ìš°ì—ë§Œ ì„ íƒì  ì§ˆë¬¸ ì¶”ê°€
  if (responses.optional_questions_enabled === 'yes') {
    allQuestions.push(...optionalQuestions);  // âš ï¸ ë™ì  ì§ˆë¬¸ ì¶”ê°€
  }
  
  return allQuestions;
}, [responses.optional_questions_enabled]);
```

**ë¬¸ì œì :**
1. ì‚¬ìš©ì ì„ íƒì— ë”°ë¼ ì§ˆë¬¸ ê°œìˆ˜ê°€ 9ê°œ â†’ 16ê°œë¡œ ë³€í•¨
2. ì™„ë£Œìœ¨ ì €í•˜ (16ê°œ ì§ˆë¬¸ì€ ë„ˆë¬´ ë§ìŒ)
3. UX ë³µì¡ë„ ì¦ê°€
4. ê²€ì¦ ë¡œì§ ë³µì¡í•¨ (ë¼ì¸ 414~443)

---

### 1.3 âŒ **ì œê±°í•  ë¶€ë¶„ (í”„ë¡ íŠ¸ì—”ë“œ)**

#### **1.3.1 ì¸í„°í˜ì´ìŠ¤ í•„ë“œ (ë¼ì¸ 19~26)**
```typescript
// âŒ ì œê±°
optional_questions_enabled?: string;
cancer_history?: string;
hepatitis_carrier?: string;
lung_nodule?: string;
gastritis?: string;
imaging_aversion?: string[];
genetic_test?: string;

// â¬†ï¸ ìŠ¹ê²© (ì„ íƒ â†’ í•„ìˆ˜)
colonoscopy_experience: string; // 35ì„¸ ì´ìƒë§Œ í‘œì‹œ
```

#### **1.3.2 optionalQuestions ë°°ì—´ (ë¼ì¸ 193~281)** - **ì „ì²´ ì‚­ì œ**

#### **1.3.3 optional_questions_enabled ì§ˆë¬¸ (ë¼ì¸ 181~189)** - **ì‚­ì œ**

#### **1.3.4 ì¡°ê±´ë¶€ questions ê³„ì‚° ë¡œì§ (ë¼ì¸ 284~293)** - **ì‚­ì œ**
```typescript
// âŒ ì œê±°
const questions = useMemo(() => {
  const allQuestions = [...basicQuestions];
  if (responses.optional_questions_enabled === 'yes') {
    allQuestions.push(...optionalQuestions);
  }
  return allQuestions;
}, [responses.optional_questions_enabled]);
```

#### **1.3.5 optional_questions_enabled ê´€ë ¨ ìë™ ì œì¶œ ë¡œì§ (ë¼ì¸ 322~335)** - **ì‚­ì œ**

#### **1.3.6 useEffect ì¡°ê±´ë¶€ ì´ë™ ë¡œì§ (ë¼ì¸ 346~355)** - **ì‚­ì œ**

#### **1.3.7 ê²€ì¦ ë¡œì§ì˜ ì¡°ê±´ë¶€ ë¶„ê¸° (ë¼ì¸ 419~432)** - **ë‹¨ìˆœí™”**

---

### 1.4 âœ… **ì¶”ê°€í•  ë¶€ë¶„ (í”„ë¡ íŠ¸ì—”ë“œ)**

#### **1.4.1 daily_routine ì§ˆë¬¸ (Q2ë¡œ ì‚½ì…)**
```typescript
{
  key: 'daily_routine',
  label: 'í‰ì†Œ í•˜ë£¨ ì¼ê³¼ëŠ” ì–´ë– ì‹ ê°€ìš”? (ì§ì—…/í™˜ê²½ ìœ ì¶”)',
  type: 'radio',
  options: [
    { value: 'desk_job', label: 'ì£¼ë¡œ ì•‰ì•„ì„œ ëª¨ë‹ˆí„° ì§‘ì¤‘' },
    { value: 'mental_stress', label: 'ì¤‘ìš”í•œ ê²°ì •/ì •ì‹ ì  ì••ë°•' },
    { value: 'service_job', label: 'ì‚¬ëŒ ìƒëŒ€/ê°ì • ì†Œëª¨' },
    { value: 'physical_job', label: 'ëª¸ì„ ì“°ê±°ë‚˜ ì„œ ìˆëŠ” ì¼' },
    { value: 'irregular', label: 'ë°¤ë‚® ë¶ˆê·œì¹™/ì‹ì‚¬ ë¶ˆê·œì¹™' },
    { value: 'home_maker', label: 'ê°€ì‚¬/ì€í‡´ í›„ íœ´ì‹' }
  ]
}
```

**ì‚½ì… ìœ„ì¹˜:** `exercise_frequency` ë‹¤ìŒ (í˜„ì¬ ë¼ì¸ 103 ì´í›„)

---

#### **1.4.2 colonoscopy_experience ì§ˆë¬¸ (Q9ë¡œ ì´ë™, ì¡°ê±´ë¶€)**
```typescript
{
  key: 'colonoscopy_experience',
  label: 'ëŒ€ì¥ë‚´ì‹œê²½ ê²€ì‚¬ë¥¼ ë°›ìœ¼ì‹  ì ì´ ìˆìœ¼ì‹ ê°€ìš”?',
  type: 'radio',
  options: [
    { value: 'yes_comfortable', label: 'ì˜ˆ, ë¶ˆí¸í•¨ ì—†ì´ ë°›ì•˜ìŠµë‹ˆë‹¤' },
    { value: 'yes_uncomfortable', label: 'ì˜ˆ, ë¶ˆí¸í–ˆìŠµë‹ˆë‹¤' },
    { value: 'no_afraid', label: 'ì•„ë‹ˆì˜¤, ë‘ë ¤ì›Œì„œ ë°›ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤' },
    { value: 'no_never', label: 'ì•„ë‹ˆì˜¤, ë°›ì•„ë³¸ ì ì´ ì—†ìŠµë‹ˆë‹¤' }
  ],
  showIf: (patientAge: number) => patientAge >= 35  // 35ì„¸ ì´ìƒë§Œ í‘œì‹œ
}
```

**ì¡°ê±´ë¶€ ë¡œì§ êµ¬í˜„ í•„ìš”:**
```typescript
// í™˜ì ë‚˜ì´ ë°›ì•„ì˜¤ê¸° (propsì—ì„œ)
const patientAge = patient?.age || 0;

// ì§ˆë¬¸ í•„í„°ë§
const questions = useMemo(() => {
  return basicQuestions.filter(question => {
    if (question.key === 'colonoscopy_experience') {
      return patientAge >= 35;
    }
    return true;
  });
}, [patientAge]);
```

---

#### **1.4.3 weight_change ì„ íƒì§€ ê°œì„ **

**í˜„ì¬ (ë¼ì¸ 96~100):**
```typescript
{ value: 'increase_more', label: 'ì¦ê°€ (3kg ì´ìƒ)' },
{ value: 'increase_some', label: 'ì•½ê°„ ì¦ê°€ (1-3kg)' },
{ value: 'maintain', label: 'ìœ ì§€' },
{ value: 'decrease_some', label: 'ì•½ê°„ ê°ì†Œ (1-3kg)' },
{ value: 'decrease_more', label: 'ê°ì†Œ (3kg ì´ìƒ)' }
```

**ê°œì„ ì•ˆ:**
```typescript
{ value: 'maintain', label: 'ë³€í™” ì—†ìŒ' },
{ value: 'decrease_bad', label: 'ì˜ë„ì¹˜ ì•Šê²Œ ë¹ ì§ (3kg ì´ìƒ)' },  // ì§ˆí™˜ ì˜ì‹¬
{ value: 'decrease_good', label: 'ë‹¤ì´ì–´íŠ¸ë¡œ ëºŒ' },  // ìê¸°ê´€ë¦¬
{ value: 'increase_some', label: 'ì¡°ê¸ˆ ìª˜ìŒ (1~3kg)' },
{ value: 'increase_more', label: 'ë§ì´ ìª˜ìŒ (3kg ì´ìƒ)' }
```

**ì´ìœ :** ì˜ë„ì /ë¹„ì˜ë„ì  ì²´ì¤‘ ê°ì†Œ êµ¬ë¶„ìœ¼ë¡œ í˜ë¥´ì†Œë‚˜ íŒì • ì •í™•ë„ í–¥ìƒ

---

### 1.5 ğŸ“Š **ìµœì¢… í”„ë¡ íŠ¸ì—”ë“œ ì§ˆë¬¸ êµ¬ì¡° (10ê°œ)**

| ìˆœì„œ | key | label | type | ë³€ê²½ |
|:----:|-----|-------|:----:|:----:|
| 1 | weight_change | ìµœê·¼ 1ë…„, ì²´ì¤‘ ë³€í™”ê°€ ìˆì—ˆë‚˜ìš”? | radio | ğŸ”§ ì„ íƒì§€ ê°œì„  |
| 2 | **daily_routine** | **í‰ì†Œ í•˜ë£¨ ì¼ê³¼ëŠ” ì–´ë– ì‹ ê°€ìš”?** | radio | ğŸ†• ì‹ ê·œ |
| 3 | exercise_frequency | ìµœê·¼ ìš´ë™ì„ í•˜ì‹œë‚˜ìš”? | radio | âœ… ìœ ì§€ |
| 4 | smoking | í¡ì—°í•˜ì‹œë‚˜ìš”? | radio | âœ… ìœ ì§€ |
| 5 | drinking | ìŒì£¼ ë¹ˆë„ëŠ”? | radio | âœ… ìœ ì§€ |
| 6 | sleep_hours | í‰ê·  ìˆ˜ë©´ ì‹œê°„ì€? | radio | âœ… ìœ ì§€ |
| 7 | stress_level | ìµœê·¼ ìŠ¤íŠ¸ë ˆìŠ¤ ìˆ˜ì¤€ì€? | radio | âœ… ìœ ì§€ |
| 8 | family_history | ê°€ì¡± ì¤‘ ì•“ìœ¼ì‹  ì§ˆí™˜ì´ ìˆë‚˜ìš”? | checkbox | âœ… ìœ ì§€ |
| 9 | **colonoscopy_experience** | **ëŒ€ì¥ë‚´ì‹œê²½ ê²½í—˜?** (35ì„¸ ì´ìƒë§Œ) | radio | â¬†ï¸ ìŠ¹ê²© |
| 10 | additional_concerns | íŠ¹ë³„íˆ ê±±ì •ë˜ê±°ë‚˜ í™•ì¸í•˜ê³  ì‹¶ì€ ë¶€ë¶„ì´ ìˆë‚˜ìš”? | textarea | âœ… ìœ ì§€ |

---

## ğŸ“‚ 2. ë°±ì—”ë“œ í˜„í™© ë¶„ì„

### 2.1 íŒŒì¼ ìœ„ì¹˜
```
planning-platform/backend/app/services/checkup_design_prompt.py
planning-platform/backend/app/api/v1/endpoints/checkup_design.py
```

### 2.2 í˜„ì¬ êµ¬ì¡°

#### **checkup_design_prompt.py ì£¼ìš” í•¨ìˆ˜**

| í•¨ìˆ˜ëª… | ë¼ì¸ | ì—­í•  | ìƒíƒœ |
|-------|------|------|------|
| `create_checkup_design_prompt_step1` | 2047 | STEP 1 í”„ë¡¬í”„íŠ¸ ìƒì„± (ë¶„ì„ë§Œ) | ğŸ”§ ìˆ˜ì • í•„ìš” |
| `create_checkup_design_prompt_step2_priority1` | ? | STEP 2-1 í”„ë¡¬í”„íŠ¸ (Priority 1) | âœ… ìœ ì§€ |
| `create_checkup_design_prompt_step2_upselling` | ? | STEP 2-2 í”„ë¡¬í”„íŠ¸ (Priority 2,3 + ì—…ì…€ë§) | âœ… ìœ ì§€ |

---

#### **create_checkup_design_prompt_step1 í•¨ìˆ˜ ë¶„ì„ (ë¼ì¸ 2047~)**

**í˜„ì¬ íŒŒë¼ë¯¸í„°:**
```python
def create_checkup_design_prompt_step1(
    patient_name: str,
    patient_age: Optional[int],
    patient_gender: Optional[str],
    health_data: List[Dict[str, Any]],
    prescription_data: List[Dict[str, Any]],
    selected_concerns: List[Dict[str, Any]],
    survey_responses: Optional[Dict[str, Any]] = None,  # í˜„ì¬ ë¬¸ì§„ ì‘ë‹µ
    hospital_national_checkup: Optional[List[Dict[str, Any]]] = None,
    prescription_analysis_text: Optional[str] = None,
    selected_medication_texts: Optional[List[str]] = None
) -> str:
```

**í˜„ì¬ survey_responses ì²˜ë¦¬ ë°©ì‹:**
- ë‹¨ìˆœíˆ key-value í…ìŠ¤íŠ¸ë¡œ ë³€í™˜í•˜ì—¬ í”„ë¡¬í”„íŠ¸ì— ì‚½ì…
- **í˜ë¥´ì†Œë‚˜ íŒì • ë¡œì§ ì—†ìŒ**
- **value â†’ ì‚¬ëŒì´ ì½ì„ ìˆ˜ ìˆëŠ” í…ìŠ¤íŠ¸ ë§¤í•‘ ì—†ìŒ**

---

### 2.3 âŒ **ë¬¸ì œì  (ë°±ì—”ë“œ)**

#### **2.3.1 survey_responses í•„ë“œ ë¶ˆì¼ì¹˜**

**í˜„ì¬ í”„ë¡ íŠ¸ì—”ë“œê°€ ì „ì†¡í•˜ëŠ” í•„ë“œ:**
```typescript
{
  weight_change: 'increase_more',
  exercise_frequency: 'regular',
  family_history: ['cancer', 'diabetes'],
  smoking: 'current_smoker',
  drinking: 'weekly_3plus',
  sleep_hours: 'less_5',
  stress_level: 'very_high',
  additional_concerns: 'ìµœê·¼ ë‘í†µì´ ì‹¬í•©ë‹ˆë‹¤',
  optional_questions_enabled: 'no',  // âŒ ì œê±° ì˜ˆì •
  cancer_history: null,              // âŒ ì œê±° ì˜ˆì •
  // ... (ì„ íƒ ì§ˆë¬¸ë“¤)
}
```

**ë°±ì—”ë“œì—ì„œ ë°›ì•„ì•¼ í•  í•„ë“œ (ê°œì„ ì•ˆ):**
```typescript
{
  weight_change: 'decrease_bad',  // ë³€ê²½: value ê°œì„ 
  daily_routine: 'desk_job',      // ì‹ ê·œ ì¶”ê°€
  exercise_frequency: 'regular',
  smoking: 'current_smoker',
  drinking: 'weekly_3plus',
  sleep_hours: 'less_5',
  stress_level: 'very_high',
  family_history: ['cancer', 'diabetes'],
  colonoscopy_experience: 'no_afraid',  // ìŠ¹ê²©
  additional_concerns: 'ìµœê·¼ ë‘í†µì´ ì‹¬í•©ë‹ˆë‹¤'
}
```

---

#### **2.3.2 í˜ë¥´ì†Œë‚˜ íŒì • ë¡œì§ ë¶€ì¬**

**í˜„ì¬:** survey_responsesë¥¼ ë‹¨ìˆœ í…ìŠ¤íŠ¸ë¡œë§Œ ë³€í™˜

**í•„ìš”:** 
1. `determine_persona()` í•¨ìˆ˜ êµ¬í˜„
2. ì ìˆ˜ ê¸°ë°˜ í˜ë¥´ì†Œë‚˜ íŒì •
3. ì„¤ë“ ì „ëµ ë° í†¤ì•¤ë§¤ë„ˆ ê²°ì •

---

#### **2.3.3 value â†’ label ë§¤í•‘ ë¶€ì¬**

**í˜„ì¬ ë¬¸ì œ:**
```python
# í˜„ì¬ ì½”ë“œ (ì¶”ì •)
survey_section = ""
for key, value in survey_responses.items():
    survey_section += f"- {key}: {value}\n"

# ì¶œë ¥ ì˜ˆì‹œ (ê°€ë…ì„± ë‚®ìŒ)
# - weight_change: increase_more
# - smoking: current_smoker
```

**ê°œì„  í•„ìš”:**
```python
# ê°œì„ ì•ˆ
survey_section = generate_survey_section(survey_responses)

# ì¶œë ¥ ì˜ˆì‹œ (ê°€ë…ì„± ë†’ìŒ)
# - ì²´ì¤‘ ë³€í™”: ë§ì´ ìª˜ìŒ 3kg ì´ìƒ (âš ï¸ ë¹„ë§Œ/ì§€ë°©ê°„ ìœ„í—˜)
# - í¡ì—°: í˜„ì¬ í¡ì—° (âš ï¸ í/í˜ˆê´€ ê´€ë¦¬ í•„ìˆ˜)
```

---

### 2.4 âœ… **ì¶”ê°€í•  ë¶€ë¶„ (ë°±ì—”ë“œ)**

#### **2.4.1 í˜ë¥´ì†Œë‚˜ íŒì • í•¨ìˆ˜ (ì‹ ê·œ ìƒì„±)**

**íŒŒì¼:** `checkup_design_prompt.py`  
**í•¨ìˆ˜ëª…:** `determine_persona()`  
**ìœ„ì¹˜:** STEP 1 í”„ë¡¬í”„íŠ¸ ìƒì„± í•¨ìˆ˜ ì´ì „

```python
def determine_persona(survey_responses: dict, patient_age: int) -> dict:
    """
    í˜ë¥´ì†Œë‚˜ íŒì • ì•Œê³ ë¦¬ì¦˜ (ì ìˆ˜ ê¸°ë°˜)
    
    Args:
        survey_responses: ë¬¸ì§„ ì‘ë‹µ ë°ì´í„°
        patient_age: í™˜ì ë‚˜ì´
        
    Returns:
        {
            "primary_persona": "Worrier",
            "persona_score": {
                "Worrier": 85,
                "Symptom Solver": 40,
                "Manager": 30,
                "Optimizer": 10,
                "Minimalist": 0
            },
            "bridge_strategy": "Peace of Mind",
            "tone": "ê³µê°, ì•ˆì‹¬, í™•ì‹ "
        }
    """
    # ê³„íšì„œì˜ ì•Œê³ ë¦¬ì¦˜ ê·¸ëŒ€ë¡œ êµ¬í˜„ (ì•½ 150~200ë¼ì¸)
    pass
```

**ì˜ˆìƒ ë¼ì¸ ìˆ˜:** 150~200ë¼ì¸  
**ë‚œì´ë„:** â­â­â­ (ì¤‘ê°„)

---

#### **2.4.2 ë¬¸ì§„ ì‘ë‹µ í…ìŠ¤íŠ¸ ë§¤í•‘ í•¨ìˆ˜ (ì‹ ê·œ ìƒì„±)**

**íŒŒì¼:** `checkup_design_prompt.py`  
**í•¨ìˆ˜ëª…:** `generate_survey_section()`  
**ìœ„ì¹˜:** `determine_persona()` ë‹¤ìŒ

```python
def generate_survey_section(survey_responses: dict) -> str:
    """
    ë¬¸ì§„ ì‘ë‹µì„ í”„ë¡¬í”„íŠ¸ìš© í…ìŠ¤íŠ¸ë¡œ ë³€í™˜
    
    Returns:
        ## ë¬¸ì§„ ì‘ë‹µ ìš”ì•½
        - ì²´ì¤‘ ë³€í™”: ì˜ë„ì¹˜ ì•Šê²Œ ë¹ ì§ 3kg ì´ìƒ (âš ï¸ ì§ˆí™˜ ì˜ì‹¬)
        - ì¼ê³¼ íŒ¨í„´: ì£¼ë¡œ ì•‰ì•„ì„œ ëª¨ë‹ˆí„° ì§‘ì¤‘ (ì‚¬ë¬´/ì „ë¬¸ì§, ì†Œë“ ì¤‘~ìƒ)
        ...
    """
    # value â†’ label ë§¤í•‘ í…Œì´ë¸” êµ¬í˜„ (ì•½ 100~150ë¼ì¸)
    pass
```

**ì˜ˆìƒ ë¼ì¸ ìˆ˜:** 100~150ë¼ì¸  
**ë‚œì´ë„:** â­â­ (ì‰¬ì›€)

---

#### **2.4.3 create_checkup_design_prompt_step1 í•¨ìˆ˜ ìˆ˜ì •**

**ìˆ˜ì • ìœ„ì¹˜:** ë¼ì¸ 2047~ í•¨ìˆ˜ ë‚´ë¶€

**ê¸°ì¡´ êµ¬ì¡° (ì¶”ì •):**
```python
def create_checkup_design_prompt_step1(...):
    # 1. í™˜ì ì •ë³´ ì„¹ì…˜
    patient_info = f"..."
    
    # 2. ê±´ê°• ë°ì´í„° ì„¹ì…˜
    health_data_section = f"..."
    
    # 3. ë¬¸ì§„ ì‘ë‹µ ì„¹ì…˜ (ë‹¨ìˆœ ë³€í™˜)
    survey_section = f"..."  # âš ï¸ ê°œì„  í•„ìš”
    
    # 4. í”„ë¡¬í”„íŠ¸ ì¡°í•©
    prompt = f"{patient_info}\n{health_data_section}\n{survey_section}"
    
    return prompt
```

**ê°œì„  êµ¬ì¡°:**
```python
def create_checkup_design_prompt_step1(...):
    # 1. í˜ë¥´ì†Œë‚˜ íŒì • (ì‹ ê·œ ì¶”ê°€)
    persona_result = determine_persona(survey_responses, patient_age)
    
    # 2. ë¬¸ì§„ ì‘ë‹µ í…ìŠ¤íŠ¸ ìƒì„± (ê°œì„ )
    survey_section = generate_survey_section(survey_responses)
    
    # 3. í˜ë¥´ì†Œë‚˜ ì •ë³´ ì„¹ì…˜ ìƒì„± (ì‹ ê·œ ì¶”ê°€)
    persona_section = f"""
## í™˜ì í˜ë¥´ì†Œë‚˜ ë¶„ì„ ê²°ê³¼
- **ì£¼ìš” í˜ë¥´ì†Œë‚˜**: {persona_result['primary_persona']}
- **ì„¤ë“ ì „ëµ**: {persona_result['bridge_strategy']}
- **ì¶”ì²œ í†¤ì•¤ë§¤ë„ˆ**: {persona_result['tone']}

ì´ í˜ë¥´ì†Œë‚˜ íŠ¹ì„±ì„ ê³ ë ¤í•˜ì—¬ ê±´ê°• ë¶„ì„ì„ ìˆ˜í–‰í•˜ì„¸ìš”.
âš ï¸ ê²€ì§„ í•­ëª© ì¶”ì²œì€ ì•„ì§ í•˜ì§€ ë§ˆì„¸ìš”. (ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ê±´ê°•ì •ë³´ì™€ í•©ì³ì„œ ì²˜ë¦¬)
"""
    
    # 4. ì‹œìŠ¤í…œ ë©”ì‹œì§€ ìˆ˜ì • (í˜ë¥´ì†Œë‚˜ ì •ë³´ í¬í•¨)
    system_message = f"""ë‹¹ì‹ ì€ ê±´ê°•ê²€ì§„ ì„¤ê³„ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.

{persona_section}

í˜„ì¬ ë‹¨ê³„(STEP 1)ì—ì„œëŠ”:
1. í™˜ìì˜ ê±´ê°• ìƒíƒœë¥¼ ë¶„ì„í•˜ì„¸ìš”.
2. ìœ„í—˜ ìš”ì¸ê³¼ ê´€ì‹¬ì‚¬ë¥¼ íŒŒì•…í•˜ì„¸ìš”.
3. í˜ë¥´ì†Œë‚˜ì— ë§ëŠ” í†¤ìœ¼ë¡œ ì„¤ëª…í•˜ì„¸ìš”.
4. âš ï¸ êµ¬ì²´ì ì¸ ê²€ì§„ í•­ëª© ì¶”ì²œì€ í•˜ì§€ ë§ˆì„¸ìš”.
"""
    
    # 5. ì‚¬ìš©ì ë©”ì‹œì§€ ìƒì„±
    user_message = f"""
{patient_info}

{health_data_section}

{survey_section}

{selected_concerns_section}

{prescription_section}
"""
    
    return {
        "system_message": system_message,
        "user_message": user_message,
        "persona_result": persona_result  # API ì‘ë‹µì— í¬í•¨í•˜ì—¬ ë‹¤ìŒ ë‹¨ê³„ì—ì„œ í™œìš©
    }
```

**ìˆ˜ì • ë²”ìœ„:** ì‹œìŠ¤í…œ ë©”ì‹œì§€ + ì‚¬ìš©ì ë©”ì‹œì§€ ë¶€ë¶„ë§Œ  
**ì˜ˆìƒ ë¼ì¸ ìˆ˜:** ê¸°ì¡´ í•¨ìˆ˜ ë‚´ ì•½ 50ë¼ì¸ ìˆ˜ì •

---

### 2.5 ğŸ“Š **ë°±ì—”ë“œ API ì‘ë‹µ êµ¬ì¡° ë³€ê²½**

**íŒŒì¼:** `checkup_design.py`  
**í•¨ìˆ˜:** `create_checkup_design` (ë¼ì¸ 113~)

**í˜„ì¬ ì‘ë‹µ (ì¶”ì •):**
```json
{
  "success": true,
  "data": {
    "step1_result": {
      "patient_summary": "...",
      "analysis": "...",
      "risk_profile": [...]
    }
  }
}
```

**ê°œì„  ì‘ë‹µ:**
```json
{
  "success": true,
  "data": {
    "step1_result": {
      "patient_summary": "...",
      "analysis": "...",
      "risk_profile": [...],
      "persona_result": {  // â­ ì‹ ê·œ ì¶”ê°€
        "primary_persona": "Worrier",
        "persona_score": {
          "Worrier": 85,
          "Symptom Solver": 40,
          "Manager": 30,
          "Optimizer": 10,
          "Minimalist": 0
        },
        "bridge_strategy": "Peace of Mind",
        "tone": "ê³µê°, ì•ˆì‹¬, í™•ì‹ "
      }
    }
  }
}
```

**ìˆ˜ì • í•„ìš”:** API ì—”ë“œí¬ì¸íŠ¸ì—ì„œ persona_resultë¥¼ ì‘ë‹µì— í¬í•¨

---

## ğŸ“‹ 3. ê±·ì–´ë‚¼ ë¶€ë¶„ ìš”ì•½

### 3.1 í”„ë¡ íŠ¸ì—”ë“œ

| í•­ëª© | ë¼ì¸ | ì œê±° ì‚¬ìœ  |
|-----|------|---------|
| **optional_questions_enabled í•„ë“œ** | 19 | ë¶„ê¸° ë¡œì§ ì œê±° |
| **ì„ íƒ ì§ˆë¬¸ í•„ë“œ 6ê°œ** | 20~26 | ë¶ˆí•„ìš”í•œ ì§ˆë¬¸ ì œê±° |
| **optionalQuestions ë°°ì—´** | 193~281 | ì„ íƒ ì§ˆë¬¸ ì „ì²´ ì œê±° |
| **optional_questions_enabled ì§ˆë¬¸** | 181~189 | ë¶„ê¸° ì§ˆë¬¸ ì œê±° |
| **ì¡°ê±´ë¶€ questions ê³„ì‚°** | 284~293 | ë¶„ê¸° ë¡œì§ ì œê±° |
| **ìë™ ì œì¶œ ë¡œì§** | 322~335 | ë¶„ê¸° ê´€ë ¨ ë¡œì§ ì œê±° |
| **useEffect ì¡°ê±´ë¶€ ì´ë™** | 346~355 | ë¶„ê¸° ê´€ë ¨ ë¡œì§ ì œê±° |
| **ê²€ì¦ ë¡œì§ ì¡°ê±´ë¶€ ë¶„ê¸°** | 419~432 | ë‹¨ìˆœí™” |

**ì´ ì œê±° ë¼ì¸:** ì•½ 150~200ë¼ì¸  
**ê²°ê³¼:** ì½”ë“œ ë³µì¡ë„ ëŒ€í­ ê°ì†Œ, ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ

---

### 3.2 ë°±ì—”ë“œ

| í•­ëª© | ì œê±° ì‚¬ìœ  |
|-----|---------|
| **ì„ íƒ ì§ˆë¬¸ í•„ë“œ ì²˜ë¦¬ ë¡œì§** | í”„ë¡ íŠ¸ì—ì„œ ì „ì†¡ ì•ˆ í•¨ |
| **optional_questions_enabled ê´€ë ¨ ì¡°ê±´ ë¶„ê¸°** | ë¶„ê¸° ë¡œì§ ì œê±° |

**ì´ ì œê±° ë¼ì¸:** ì•½ 20~30ë¼ì¸ (ì¶”ì •)

---

## ğŸ”§ 4. ê°œì„ í•  ë¶€ë¶„ ìš”ì•½

### 4.1 í”„ë¡ íŠ¸ì—”ë“œ

| í•­ëª© | ì‘ì—… | ì˜ˆìƒ ë¼ì¸ | ë‚œì´ë„ |
|-----|------|:--------:|:-----:|
| **daily_routine ì§ˆë¬¸ ì¶”ê°€** | ì‹ ê·œ ì§ˆë¬¸ ì‚½ì… | +20 | â­ |
| **colonoscopy_experience ìŠ¹ê²©** | í•„ìˆ˜ ì§ˆë¬¸ìœ¼ë¡œ ì´ë™ | +20 | â­â­ |
| **35ì„¸ ì´ìƒ ì¡°ê±´ë¶€ ë¡œì§** | í™˜ì ë‚˜ì´ ê¸°ë°˜ í•„í„°ë§ | +30 | â­â­ |
| **weight_change ì„ íƒì§€ ê°œì„ ** | value/label ìˆ˜ì • | +10 | â­ |
| **ì¸í„°í˜ì´ìŠ¤ ì—…ë°ì´íŠ¸** | SurveyResponses ìˆ˜ì • | +10 | â­ |
| **ê²€ì¦ ë¡œì§ ë‹¨ìˆœí™”** | ì¡°ê±´ë¶€ ë¶„ê¸° ì œê±° | -20 | â­ |

**ì´ ì‘ì—…ëŸ‰:** ì•½ 70ë¼ì¸ ì¶”ê°€, 150ë¼ì¸ ì‚­ì œ = **ìˆœ -80ë¼ì¸**

---

### 4.2 ë°±ì—”ë“œ

| í•­ëª© | ì‘ì—… | ì˜ˆìƒ ë¼ì¸ | ë‚œì´ë„ |
|-----|------|:--------:|:-----:|
| **í˜ë¥´ì†Œë‚˜ íŒì • í•¨ìˆ˜** | determine_persona() êµ¬í˜„ | +180 | â­â­â­ |
| **í…ìŠ¤íŠ¸ ë§¤í•‘ í•¨ìˆ˜** | generate_survey_section() êµ¬í˜„ | +120 | â­â­ |
| **STEP1 í”„ë¡¬í”„íŠ¸ ìˆ˜ì •** | í˜ë¥´ì†Œë‚˜ ì •ë³´ í¬í•¨ | +50 | â­â­ |
| **API ì‘ë‹µ êµ¬ì¡° ìˆ˜ì •** | persona_result í¬í•¨ | +10 | â­ |

**ì´ ì‘ì—…ëŸ‰:** ì•½ 360ë¼ì¸ ì¶”ê°€, 30ë¼ì¸ ì‚­ì œ = **ìˆœ +330ë¼ì¸**

---

## ğŸ“Š 5. ì˜í–¥ë„ ë¶„ì„

### 5.1 ë°ì´í„°ë² ì´ìŠ¤

**ì˜í–¥:** ì—†ìŒ  
**ì´ìœ :** survey_responsesëŠ” JSONB í˜•íƒœë¡œ ì €ì¥ë˜ë¯€ë¡œ ìŠ¤í‚¤ë§ˆ ë³€ê²½ ë¶ˆí•„ìš”

### 5.2 API ì—”ë“œí¬ì¸íŠ¸

**ì˜í–¥:** ìµœì†Œ  
**ë³€ê²½ í•„ìš”:** `checkup_design.py`ì˜ ì‘ë‹µ êµ¬ì¡°ì— persona_result ì¶”ê°€

### 5.3 ê¸°ì¡´ ë°ì´í„° í˜¸í™˜ì„±

**ë¬¸ì œ:** ê¸°ì¡´ ì‚¬ìš©ì ë°ì´í„°ì— daily_routine í•„ë“œ ì—†ìŒ

**í•´ê²° ë°©ì•ˆ:**
```python
# ë°±ì—”ë“œì—ì„œ ë°©ì–´ ë¡œì§
survey_responses = survey_responses or {}
daily_routine = survey_responses.get('daily_routine', 'desk_job')  # ê¸°ë³¸ê°’ ì„¤ì •
```

---

## ğŸ¯ 6. ì‘ì—… ìš°ì„ ìˆœìœ„

### Phase 1: ë°±ì—”ë“œ í˜ë¥´ì†Œë‚˜ ë¡œì§ (ì¤‘ìš”ë„: ìµœìƒ)
1. âœ… `determine_persona()` í•¨ìˆ˜ êµ¬í˜„
2. âœ… `generate_survey_section()` í•¨ìˆ˜ êµ¬í˜„
3. âœ… `create_checkup_design_prompt_step1()` ìˆ˜ì •

**ì˜ˆìƒ ì‹œê°„:** 4ì‹œê°„  
**ë‚œì´ë„:** â­â­â­

---

### Phase 2: í”„ë¡ íŠ¸ì—”ë“œ ë¬¸ì§„ ìˆ˜ì • (ì¤‘ìš”ë„: ìƒ)
1. âœ… optionalQuestions ë°°ì—´ ì œê±°
2. âœ… optional_questions_enabled ì§ˆë¬¸ ì œê±°
3. âœ… daily_routine ì§ˆë¬¸ ì¶”ê°€
4. âœ… colonoscopy_experience ìŠ¹ê²©
5. âœ… 35ì„¸ ì´ìƒ ì¡°ê±´ë¶€ ë¡œì§ êµ¬í˜„
6. âœ… weight_change ì„ íƒì§€ ê°œì„ 
7. âœ… SurveyResponses ì¸í„°í˜ì´ìŠ¤ ì—…ë°ì´íŠ¸
8. âœ… ì¡°ê±´ë¶€ ë¡œì§ ì œê±° ë° ë‹¨ìˆœí™”

**ì˜ˆìƒ ì‹œê°„:** 3ì‹œê°„  
**ë‚œì´ë„:** â­â­

---

### Phase 3: í…ŒìŠ¤íŠ¸ (ì¤‘ìš”ë„: ìƒ)
1. âœ… í˜ë¥´ì†Œë‚˜ë³„ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ (5ê°€ì§€)
2. âœ… ì „ì²´ í”Œë¡œìš° í†µí•© í…ŒìŠ¤íŠ¸
3. âœ… 35ì„¸ ë¯¸ë§Œ/ì´ìƒ ì¡°ê±´ë¶€ í…ŒìŠ¤íŠ¸

**ì˜ˆìƒ ì‹œê°„:** 2.5ì‹œê°„  
**ë‚œì´ë„:** â­â­

---

## ğŸ“ 7. ì£¼ìš” íŒŒì¼ ìˆ˜ì • ì²´í¬ë¦¬ìŠ¤íŠ¸

### í”„ë¡ íŠ¸ì—”ë“œ
- [ ] `/planning-platform/frontend/src/components/checkup-design/CheckupDesignSurveyPanel/index.tsx`
  - [ ] SurveyResponses ì¸í„°í˜ì´ìŠ¤ ìˆ˜ì •
  - [ ] basicQuestions ë°°ì—´ ìˆ˜ì •
  - [ ] optionalQuestions ë°°ì—´ ì œê±°
  - [ ] ì¡°ê±´ë¶€ ë¡œì§ ì œê±°
  - [ ] ê²€ì¦ ë¡œì§ ë‹¨ìˆœí™”

### ë°±ì—”ë“œ
- [ ] `/planning-platform/backend/app/services/checkup_design_prompt.py`
  - [ ] determine_persona() í•¨ìˆ˜ ì¶”ê°€
  - [ ] generate_survey_section() í•¨ìˆ˜ ì¶”ê°€
  - [ ] create_checkup_design_prompt_step1() ìˆ˜ì •

- [ ] `/planning-platform/backend/app/api/v1/endpoints/checkup_design.py`
  - [ ] API ì‘ë‹µì— persona_result í¬í•¨

---

## âš ï¸ 8. ì ì¬ì  ìœ„í—˜ ìš”ì†Œ

### 8.1 ê¸°ì¡´ ë°ì´í„° í˜¸í™˜ì„±
**ìœ„í—˜:** ê¸°ì¡´ ì‚¬ìš©ì ë°ì´í„°ì— daily_routine í•„ë“œ ì—†ìŒ  
**ëŒ€ì‘:** ë°±ì—”ë“œì—ì„œ ê¸°ë³¸ê°’ ì²˜ë¦¬ ë¡œì§ ì¶”ê°€

### 8.2 35ì„¸ ë¯¸ë§Œ ì‚¬ìš©ì
**ìœ„í—˜:** colonoscopy_experience ì§ˆë¬¸ì´ í‘œì‹œ ì•ˆ ë¨  
**ëŒ€ì‘:** ì§ˆë¬¸ ìˆ˜ ë™ì ìœ¼ë¡œ ê³„ì‚° (9ê°œ ë˜ëŠ” 10ê°œ)

### 8.3 í˜ë¥´ì†Œë‚˜ íŒì • ì •í™•ë„
**ìœ„í—˜:** ì•Œê³ ë¦¬ì¦˜ì´ ì‹¤ì œ í™˜ê²½ì—ì„œ ì˜ ì‘ë™í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ  
**ëŒ€ì‘:** A/B í…ŒìŠ¤íŠ¸ ë° ì ìˆ˜ ê°€ì¤‘ì¹˜ ì¡°ì •

---

## ğŸš€ 9. ë‹¤ìŒ ë‹¨ê³„

### ì¦‰ì‹œ ì‹œì‘ ê°€ëŠ¥
1. âœ… ë°±ì—”ë“œ í˜ë¥´ì†Œë‚˜ íŒì • ë¡œì§ êµ¬í˜„
2. âœ… ë°±ì—”ë“œ í…ìŠ¤íŠ¸ ë§¤í•‘ í•¨ìˆ˜ êµ¬í˜„

### ë°±ì—”ë“œ ì™„ë£Œ í›„
3. âœ… í”„ë¡ íŠ¸ì—”ë“œ ë¬¸ì§„ êµ¬ì¡° ìˆ˜ì •
4. âœ… í”„ë¡ íŠ¸ì—”ë“œ ì¡°ê±´ë¶€ ë¡œì§ êµ¬í˜„

### ì „ì²´ ì™„ë£Œ í›„
5. âœ… í†µí•© í…ŒìŠ¤íŠ¸
6. âœ… ë°°í¬

---

**ì‘ì„±ì:** AI Assistant  
**ìµœì¢… ìˆ˜ì •:** 2025-12-06  
**ë²„ì „:** 1.0 (ìƒì„¸ ì ê²€ ì™„ë£Œ)

