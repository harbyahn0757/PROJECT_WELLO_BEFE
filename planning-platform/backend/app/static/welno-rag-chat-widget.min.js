!function(n,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.WelnoRagChatWidget=t():n.WelnoRagChatWidget=t()}(this,()=>{return n={803(n,t){var e,s={"5a9bb40b5108ecd8ef864658d5a2d5ab":"/welno-api/static/mdx_icon.png"};class i{constructor(n){if(!n.apiKey)throw new Error("WelnoRagChatWidget: apiKey is required");var t=n.baseUrl||"http://localhost:8082",e=n.chatIconUrl||null;!e&&n.apiKey&&s[n.apiKey]&&(e=t.replace(/\/$/,"")+s[n.apiKey]),this.config={apiKey:n.apiKey,baseUrl:t,uuid:n.uuid||"widget_user_"+Date.now(),hospitalId:n.hospitalId||"widget_partner",partnerData:n.partnerData||null,position:n.position||"bottom-right",theme:n.theme||"default",buttonColor:n.buttonColor||"#A69B8F",chatIconUrl:e,autoOpen:n.autoOpen||!1,welcomeMessage:n.welcomeMessage||"ÏïàÎÖïÌïòÏÑ∏Ïöî! Í±¥Í∞ïÍ≥º ÏòÅÏñëÏóê ÎåÄÌï¥ Í∂ÅÍ∏àÌïú Ï†êÏùÑ Î¨ºÏñ¥Î≥¥ÏÑ∏Ïöî. üòä",onOpen:n.onOpen||null,onClose:n.onClose||null,onMessage:n.onMessage||null,onError:n.onError||null},this.state={isOpen:!1,isLoading:!1,messages:[],sessionId:null,suggestions:[],isInitialized:!1},this.elements={container:null,button:null,window:null,messagesContainer:null,input:null,sendButton:null},this.cssPrefix="welno-rag-widget",console.log("[WelnoRagChatWidget] Ï¥àÍ∏∞Ìôî ÏôÑÎ£å:",this.config)}init(){if(this.state.isInitialized)console.warn("[WelnoRagChatWidget] Ïù¥ÎØ∏ Ï¥àÍ∏∞ÌôîÎê®");else try{this.injectStyles(),this.createDOM(),this.bindEvents(),this.state.sessionId="temp_".concat(this.config.uuid,"_").concat(Date.now()),this.warmup(),this.addMessage("assistant",this.config.welcomeMessage),this.config.autoOpen&&setTimeout(()=>this.open(),500),this.state.isInitialized=!0,console.log("[WelnoRagChatWidget] Ï¥àÍ∏∞Ìôî ÏôÑÎ£å")}catch(n){console.error("[WelnoRagChatWidget] Ï¥àÍ∏∞Ìôî Ïã§Ìå®:",n),this.handleError("ÏúÑÏ†Ø Ï¥àÍ∏∞ÌôîÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.",n)}}injectStyles(){const n="".concat(this.cssPrefix,"-styles");if(document.getElementById(n))return;const t="\n      /* Welno RAG Chat Widget Styles */\n      .".concat(this.cssPrefix,"-container {\n        position: fixed;\n        z-index: 9999;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        font-size: 14px;\n        line-height: 1.4;\n        color: #333;\n        box-sizing: border-box;\n      }\n      \n      .").concat(this.cssPrefix,"-container *,\n      .").concat(this.cssPrefix,"-container *::before,\n      .").concat(this.cssPrefix,"-container *::after {\n        box-sizing: border-box;\n      }\n\n      /* ÏúÑÏπòÎ≥Ñ Ïä§ÌÉÄÏùº */\n      .").concat(this.cssPrefix,"-container.position-bottom-right {\n        bottom: 24px;\n        right: 24px;\n      }\n      \n      .").concat(this.cssPrefix,"-container.position-bottom-left {\n        bottom: 24px;\n        left: 24px;\n      }\n      \n      .").concat(this.cssPrefix,"-container.position-top-right {\n        top: 24px;\n        right: 24px;\n      }\n      \n      .").concat(this.cssPrefix,"-container.position-top-left {\n        top: 24px;\n        left: 24px;\n      }\n\n      /* Ï±ÑÌåÖ Î≤ÑÌäº */\n      .").concat(this.cssPrefix,"-button {\n        width: 56px;\n        height: 56px;\n        min-width: 56px;\n        min-height: 56px;\n        padding: 0;\n        border: none;\n        border-radius: 50%;\n        background: ").concat(this.config.buttonColor,";\n        color: white;\n        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        transition: all 0.3s ease;\n        outline: none;\n        overflow: hidden;\n        position: relative;\n      }\n\n      .").concat(this.cssPrefix,"-button:hover {\n        transform: scale(1.1);\n        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);\n        filter: brightness(0.9);\n      }\n\n      .").concat(this.cssPrefix,"-button.active {\n        filter: brightness(0.9);\n      }\n\n      /* ÌååÌä∏ÎÑà ÏïÑÏù¥ÏΩò: Ïù¥ÎØ∏ÏßÄÏùº ÎïåÎäî ÏõêÌòï Î≤ÑÌäº Ï†ÑÏ≤¥Î•º ÍΩâ Ï±ÑÏõÄ, SVGÎäî 24x24 Ïú†ÏßÄ */\n      .").concat(this.cssPrefix,"-button .").concat(this.cssPrefix,"-icon-slot {\n        position: absolute;\n        inset: 0;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        border-radius: 50%;\n        overflow: hidden;\n      }\n      .").concat(this.cssPrefix,"-button .").concat(this.cssPrefix,"-icon-slot svg {\n        width: 24px;\n        height: 24px;\n        flex-shrink: 0;\n        display: block;\n      }\n      .").concat(this.cssPrefix,"-button .").concat(this.cssPrefix,"-icon-slot img {\n        position: absolute;\n        inset: 0;\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n        object-position: center;\n        display: block;\n      }\n\n      /* Ï±ÑÌåÖ Ï∞Ω */\n      .").concat(this.cssPrefix,"-window {\n        position: absolute;\n        bottom: 70px;\n        right: 0;\n        width: 360px;\n        height: 550px;\n        background: #FFFAF2;\n        border-radius: 20px;\n        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);\n        display: none;\n        flex-direction: column;\n        overflow: hidden;\n        border: 1px solid rgba(123, 94, 79, 0.1);\n        animation: slideInUp 0.3s ease-out;\n      }\n\n      .").concat(this.cssPrefix,"-window.open {\n        display: flex;\n      }\n\n      .").concat(this.cssPrefix,"-container.position-bottom-left .").concat(this.cssPrefix,"-window {\n        right: auto;\n        left: 0;\n      }\n\n      .").concat(this.cssPrefix,"-container.position-top-right .").concat(this.cssPrefix,"-window {\n        bottom: auto;\n        top: 70px;\n      }\n\n      .").concat(this.cssPrefix,"-container.position-top-left .").concat(this.cssPrefix,"-window {\n        bottom: auto;\n        top: 70px;\n        right: auto;\n        left: 0;\n      }\n\n      @keyframes slideInUp {\n        from {\n          transform: translateY(20px);\n          opacity: 0;\n        }\n        to {\n          transform: translateY(0);\n          opacity: 1;\n        }\n      }\n\n      /* Ìó§Îçî */\n      .").concat(this.cssPrefix,"-header {\n        background: #7B5E4F;\n        color: white;\n        padding: 18px 20px;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n      }\n\n      .").concat(this.cssPrefix,"-header h3 {\n        margin: 0;\n        font-size: 17px;\n        font-weight: 600;\n        letter-spacing: -0.5px;\n      }\n\n      .").concat(this.cssPrefix,"-close-button {\n        background: none;\n        border: none;\n        color: white;\n        font-size: 20px;\n        cursor: pointer;\n        padding: 4px;\n        border-radius: 4px;\n        transition: background-color 0.2s;\n      }\n\n      .").concat(this.cssPrefix,"-close-button:hover {\n        background: rgba(255, 255, 255, 0.1);\n      }\n\n      /* Ïõ∞Ïª¥ Î≤ÑÎ∏î - Î∑∞Ìè¨Ìä∏ Í∏∞Ï§Ä Í≥†Ï†ï ÏúÑÏπòÎ°ú Í∞ÄÎ°ú ÎÑàÎπÑ ÌôúÏö© (!important Ï∂îÍ∞ÄÎ°ú Í∞ïÏ†ú Ï†ÅÏö©) */\n      .").concat(this.cssPrefix,"-welcome-bubble {\n        position: fixed !important;\n        background: white !important;\n        padding: 12px 18px !important;\n        border-radius: 16px !important;\n        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1) !important;\n        border: 1px solid #7B5E4F !important;\n        width: max-content !important;\n        min-width: 240px !important;\n        max-width: min(80vw, 320px) !important;\n        white-space: normal !important;\n        word-break: normal !important;\n        opacity: 0;\n        transform: translateY(10px);\n        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n        pointer-events: none;\n        cursor: pointer;\n        z-index: 9998 !important;\n      }\n      .").concat(this.cssPrefix,"-container.position-bottom-right .").concat(this.cssPrefix,"-welcome-bubble {\n        right: 24px !important;\n        bottom: 96px !important;\n        left: auto !important;\n        top: auto !important;\n      }\n      .").concat(this.cssPrefix,"-container.position-bottom-left .").concat(this.cssPrefix,"-welcome-bubble {\n        left: 24px !important;\n        bottom: 96px !important;\n        right: auto !important;\n        top: auto !important;\n      }\n      .").concat(this.cssPrefix,"-container.position-top-right .").concat(this.cssPrefix,"-welcome-bubble {\n        right: 24px !important;\n        top: 96px !important;\n        bottom: auto !important;\n        left: auto !important;\n      }\n      .").concat(this.cssPrefix,"-container.position-top-left .").concat(this.cssPrefix,"-welcome-bubble {\n        left: 24px !important;\n        top: 96px !important;\n        right: auto !important;\n        bottom: auto !important;\n      }\n\n      .").concat(this.cssPrefix,"-welcome-bubble.visible {\n        opacity: 1;\n        transform: translateY(0);\n        pointer-events: auto;\n      }\n\n      .").concat(this.cssPrefix,"-welcome-bubble::after {\n        content: '';\n        position: absolute;\n        bottom: -8px;\n        right: 20px;\n        width: 0;\n        height: 0;\n        border-left: 8px solid transparent;\n        border-right: 8px solid transparent;\n        border-top: 8px solid #7B5E4F;\n      }\n\n      .").concat(this.cssPrefix,"-welcome-bubble::before {\n        content: '';\n        position: absolute;\n        bottom: -6px;\n        right: 21px;\n        width: 0;\n        height: 0;\n        border-left: 7px solid transparent;\n        border-right: 7px solid transparent;\n        border-top: 7px solid white;\n        z-index: 1;\n      }\n\n      .").concat(this.cssPrefix,"-welcome-bubble-text {\n        font-weight: 500;\n        color: #7B5E4F;\n        font-size: 13px;\n        line-height: 1.4;\n      }\n      @media (max-width: 480px) {\n        .").concat(this.cssPrefix,"-welcome-bubble {\n          min-width: 200px;\n          max-width: min(80vw, 320px);\n        }\n      }\n\n      @keyframes bubbleBounce {\n        0%, 100% { transform: translateY(0); }\n        50% { transform: translateY(-5px); }\n      }\n\n      .").concat(this.cssPrefix,"-welcome-bubble.visible {\n        animation: bubbleBounce 3s infinite ease-in-out;\n      }\n\n      /* Î©îÏãúÏßÄ ÏòÅÏó≠ */\n      .").concat(this.cssPrefix,"-messages {\n        flex: 1;\n        overflow-y: auto;\n        padding: 20px;\n        background: #FFFAF2;\n      }\n\n      .").concat(this.cssPrefix,"-message {\n        margin-bottom: 16px;\n        display: flex;\n        flex-direction: column;\n      }\n\n      .").concat(this.cssPrefix,"-message.user {\n        align-items: flex-end;\n      }\n\n      .").concat(this.cssPrefix,"-message.assistant {\n        align-items: flex-start;\n      }\n\n      .").concat(this.cssPrefix,"-message-bubble {\n        max-width: 80%;\n        padding: 12px 16px;\n        border-radius: 18px;\n        word-wrap: break-word;\n        line-height: 1.4;\n      }\n\n      .").concat(this.cssPrefix,"-message.user .").concat(this.cssPrefix,"-message-bubble {\n        background: #7B5E4F;\n        color: white;\n        border-bottom-right-radius: 6px;\n      }\n\n      .").concat(this.cssPrefix,"-message.assistant .").concat(this.cssPrefix,"-message-bubble {\n        background: white;\n        color: #333;\n        border: 1px solid #E5E5E5;\n        border-bottom-left-radius: 6px;\n      }\n\n      .").concat(this.cssPrefix,"-message-bubble strong {\n        font-weight: 700;\n      }\n\n      .").concat(this.cssPrefix,"-message-time {\n        font-size: 11px;\n        color: #999;\n        margin-top: 4px;\n        padding: 0 4px;\n      }\n\n      /* Î°úÎî© Ïù∏ÎîîÏºÄÏù¥ÌÑ∞ (ÎßêÌíçÏÑ† ÏóÜÏù¥ Ï†ê ÏÑ∏ Í∞úÎßå) */\n      .").concat(this.cssPrefix,"-loading-wrap {\n        display: flex;\n        align-items: center;\n        align-self: flex-start;\n        padding: 8px 0;\n      }\n\n      .").concat(this.cssPrefix,"-loading-dots {\n        display: flex;\n        gap: 4px;\n      }\n\n      .").concat(this.cssPrefix,"-loading-dot {\n        width: 8px;\n        height: 8px;\n        border-radius: 50%;\n        background: #999;\n        animation: loadingDot 1.4s infinite ease-in-out both;\n      }\n\n      .").concat(this.cssPrefix,"-loading-dot:nth-child(1) { animation-delay: -0.32s; }\n      .").concat(this.cssPrefix,"-loading-dot:nth-child(2) { animation-delay: -0.16s; }\n\n      @keyframes loadingDot {\n        0%, 80%, 100% {\n          transform: scale(0);\n        }\n        40% {\n          transform: scale(1);\n        }\n      }\n\n      /* ÏûÖÎ†• ÏòÅÏó≠ */\n      .").concat(this.cssPrefix,"-input-area {\n        padding: 16px 20px;\n        background: white;\n        border-top: 1px solid #E5E5E5;\n        display: flex;\n        gap: 12px;\n        align-items: flex-end;\n      }\n\n      .").concat(this.cssPrefix,"-input {\n        flex: 1;\n        border: 1px solid #E5E5E5;\n        border-radius: 20px;\n        padding: 10px 16px;\n        font-size: 14px;\n        outline: none;\n        resize: none;\n        min-height: 20px;\n        max-height: 100px;\n        font-family: inherit;\n      }\n\n      .").concat(this.cssPrefix,"-input:focus {\n        border-color: #7B5E4F;\n      }\n\n      .").concat(this.cssPrefix,"-send-button {\n        width: 40px;\n        height: 40px;\n        border-radius: 50%;\n        background: #7B5E4F;\n        color: white;\n        border: none;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        transition: background-color 0.2s;\n        flex-shrink: 0;\n      }\n\n      .").concat(this.cssPrefix,"-send-button:hover {\n        background: #6B4E3F;\n      }\n\n      .").concat(this.cssPrefix,"-send-button:disabled {\n        background: #CCC;\n        cursor: not-allowed;\n      }\n\n      .").concat(this.cssPrefix,"-send-button svg {\n        width: 16px;\n        height: 16px;\n      }\n\n      /* Î∞òÏùëÌòï */\n      @media (max-width: 480px) {\n        .").concat(this.cssPrefix,"-window {\n          width: calc(100vw - 24px);\n          height: calc(100vh - 100px);\n          max-width: 360px;\n          max-height: 550px;\n        }\n      }\n\n      /* ÏÜåÏä§ ÏïÑÏΩîÎîîÏñ∏ */\n      .").concat(this.cssPrefix,"-sources {\n        margin-top: 8px;\n        font-size: 12px;\n        color: #666;\n      }\n      .").concat(this.cssPrefix,"-sources-header {\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding: 6px 0;\n        user-select: none;\n      }\n      .").concat(this.cssPrefix,"-sources-header:hover { opacity: 0.85; }\n      .").concat(this.cssPrefix,"-sources-chevron {\n        font-size: 10px;\n        display: inline-block;\n        transition: transform 0.2s;\n        transform: rotate(-90deg);\n      }\n      .").concat(this.cssPrefix,"-sources.is-open .").concat(this.cssPrefix,"-sources-chevron {\n        transform: rotate(0deg);\n      }\n      .").concat(this.cssPrefix,"-sources-list {\n        max-height: 0;\n        overflow: hidden;\n        transition: max-height 0.2s ease-out;\n      }\n      .").concat(this.cssPrefix,"-sources.is-open .").concat(this.cssPrefix,"-sources-list {\n        max-height: 400px;\n      }\n      .").concat(this.cssPrefix,"-source {\n        display: block;\n        background: #F0F0F0;\n        padding: 6px 8px;\n        border-radius: 4px;\n        margin: 4px 0 0 0;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n      }\n      .").concat(this.cssPrefix,"-source:first-of-type { margin-top: 6px; }\n\n      /* Ï†úÏïà ÏßàÎ¨∏ */\n      .").concat(this.cssPrefix,"-suggestions {\n        margin-top: 12px;\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .").concat(this.cssPrefix,"-suggestion {\n        background: #F8F8F8;\n        border: 1px solid #E5E5E5;\n        border-radius: 16px;\n        padding: 6px 12px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: all 0.2s;\n      }\n\n      .").concat(this.cssPrefix,"-suggestion:hover {\n        background: #7B5E4F;\n        color: white;\n        border-color: #7B5E4F;\n      }\n    "),e=document.createElement("style");e.id=n,e.textContent=t,document.head.appendChild(e)}createDOM(){this.elements.container=document.createElement("div"),this.elements.container.className="".concat(this.cssPrefix,"-container position-").concat(this.config.position),this.elements.button=document.createElement("button"),this.elements.button.className="".concat(this.cssPrefix,"-button"),this.elements.button.innerHTML=this.getChatIcon(),this.elements.button.setAttribute("aria-label","Ï±ÑÌåÖ Ïó¥Í∏∞"),this.elements.welcomeBubble=document.createElement("div"),this.elements.welcomeBubble.className="".concat(this.cssPrefix,"-welcome-bubble"),this.elements.welcomeBubble.innerHTML='<div class="'.concat(this.cssPrefix,'-welcome-bubble-text">Î∂ÑÏÑù Ï§ë...</div>'),this.elements.window=document.createElement("div"),this.elements.window.className="".concat(this.cssPrefix,"-window");const n=document.createElement("div");n.className="".concat(this.cssPrefix,"-header"),n.innerHTML='\n      <h3>MediArc</h3>\n      <button class="'.concat(this.cssPrefix,'-close-button" aria-label="Ï±ÑÌåÖ Îã´Í∏∞">√ó</button>\n    '),this.elements.messagesContainer=document.createElement("div"),this.elements.messagesContainer.className="".concat(this.cssPrefix,"-messages");const t=document.createElement("div");t.className="".concat(this.cssPrefix,"-input-area"),this.elements.input=document.createElement("textarea"),this.elements.input.className="".concat(this.cssPrefix,"-input"),this.elements.input.placeholder="Î©îÏãúÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî...",this.elements.input.rows=1,this.elements.sendButton=document.createElement("button"),this.elements.sendButton.className="".concat(this.cssPrefix,"-send-button"),this.elements.sendButton.innerHTML=this.getSendIcon(),this.elements.sendButton.setAttribute("aria-label","Î©îÏãúÏßÄ Ï†ÑÏÜ°"),t.appendChild(this.elements.input),t.appendChild(this.elements.sendButton),this.elements.window.appendChild(n),this.elements.window.appendChild(this.elements.messagesContainer),this.elements.window.appendChild(t),this.elements.container.appendChild(this.elements.welcomeBubble),this.elements.container.appendChild(this.elements.button),this.elements.container.appendChild(this.elements.window),document.body.appendChild(this.elements.container)}bindEvents(){this.elements.button.addEventListener("click",()=>{this.state.isOpen?this.close():this.open()}),this.elements.welcomeBubble.addEventListener("click",()=>{this.open(),this.elements.welcomeBubble.classList.remove("visible")}),this.elements.window.querySelector(".".concat(this.cssPrefix,"-close-button")).addEventListener("click",()=>this.close()),this.elements.sendButton.addEventListener("click",()=>this.sendMessage()),this.elements.input.addEventListener("keydown",n=>{"Enter"!==n.key||n.shiftKey||(n.preventDefault(),this.sendMessage())}),this.elements.input.addEventListener("input",()=>{this.elements.input.style.height="auto",this.elements.input.style.height=Math.min(this.elements.input.scrollHeight,100)+"px"}),document.addEventListener("click",n=>{this.state.isOpen&&this.elements.container.contains(n.target)})}open(){this.state.isOpen||(this.state.isOpen=!0,this.elements.window.classList.add("open"),this.elements.button.classList.add("active"),this.elements.button.innerHTML=this.getCloseIcon(),this.elements.welcomeBubble&&this.elements.welcomeBubble.classList.remove("visible"),setTimeout(()=>{this.elements.input.focus()},300),this.config.onOpen&&this.config.onOpen(),console.log("[WelnoRagChatWidget] Ï±ÑÌåÖÏ∞Ω Ïó¥Î¶º"))}close(){this.state.isOpen&&(this.state.isOpen=!1,this.elements.window.classList.remove("open"),this.elements.button.classList.remove("active"),this.elements.button.innerHTML=this.getChatIcon(),this.config.onClose&&this.config.onClose(),console.log("[WelnoRagChatWidget] Ï±ÑÌåÖÏ∞Ω Îã´Ìûò"))}async sendMessage(){const n=this.elements.input.value.trim();if(n&&!this.state.isLoading)try{this.addMessage("user",n),this.elements.input.value="",this.elements.input.style.height="auto",this.setLoading(!0),await this.callPartnerAPI(n)}catch(n){console.error("[WelnoRagChatWidget] Î©îÏãúÏßÄ Ï†ÑÏÜ° Ïã§Ìå®:",n),"AbortError"===n.name?this.handleError("ÏùëÎãµ ÏãúÍ∞ÑÏù¥ Ï¥àÍ≥ºÎêòÏóàÏäµÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.",n):this.handleError("Î©îÏãúÏßÄ Ï†ÑÏÜ°Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.",n)}finally{this.setLoading(!1)}}async callPartnerAPI(n){const t={uuid:this.config.uuid,hospital_id:this.config.hospitalId,message:n,session_id:this.state.sessionId};this.config.partnerData&&(t.health_data=this.config.partnerData);const e=new AbortController,s=setTimeout(()=>e.abort(),3e4),i=await fetch("".concat(this.config.baseUrl,"/welno-api/v1/rag-chat/partner/message"),{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":this.config.apiKey},body:JSON.stringify(t),signal:e.signal});if(clearTimeout(s),!i.ok){const n=await i.json().catch(()=>({}));throw new Error(n.detail||"HTTP ".concat(i.status,": ").concat(i.statusText))}await this.handleStreamingResponse(i)}async handleStreamingResponse(n){const t=n.body.getReader(),e=new TextDecoder;let s="",i="",o=null;const a=n=>{if(n.startsWith("data: "))try{const t=JSON.parse(n.slice(6));t.answer&&(i+=t.answer,o||(o=this.addMessage("assistant","")),this.updateMessageContent(o,i)),t.done&&(t.sources&&t.sources.length>0&&this.addSources(o,t.sources),t.suggestions&&t.suggestions.length>0&&this.addSuggestions(o,t.suggestions))}catch(n){}};try{for(;;){const{done:n,value:i}=await t.read();if(n)break;s+=e.decode(i,{stream:!0});const o=s.split("\n");s=o.pop()||"";for(const n of o)a(n.trim())}s.trim()&&a(s.trim())}finally{t.releaseLock()}}_renderMessageHtml(n){return null==n||""===n?"":String(n).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>").replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>")}addMessage(n,t){const e=document.createElement("div");e.className="".concat(this.cssPrefix,"-message ").concat(n);const s=document.createElement("div");s.className="".concat(this.cssPrefix,"-message-bubble"),s.innerHTML=this._renderMessageHtml(t);const i=document.createElement("div");return i.className="".concat(this.cssPrefix,"-message-time"),i.textContent=(new Date).toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit"}),e.appendChild(s),e.appendChild(i),this.elements.messagesContainer.appendChild(e),this.scrollToBottom(),this.state.messages.push({role:n,content:t,timestamp:(new Date).toISOString()}),this.config.onMessage&&this.config.onMessage({role:n,content:t}),e}updateMessageContent(n,t){n.querySelector(".".concat(this.cssPrefix,"-message-bubble")).innerHTML=this._renderMessageHtml(t),this.scrollToBottom()}addSources(n,t){if(!t||0===t.length)return;const e=document.createElement("div");e.className="".concat(this.cssPrefix,"-sources");const s=document.createElement("button");s.type="button",s.className="".concat(this.cssPrefix,"-sources-header"),s.innerHTML='<span>Ï∞∏Í≥† Î¨∏Ìóå</span><span class="'.concat(this.cssPrefix,'-sources-chevron" aria-hidden="true">‚ñº</span>'),s.addEventListener("click",()=>{e.classList.toggle("is-open")});const i=document.createElement("div");i.className="".concat(this.cssPrefix,"-sources-list"),t.forEach(n=>{const t=document.createElement("div");t.className="".concat(this.cssPrefix,"-source"),t.textContent=n.title||"Ï∞∏Í≥†ÏûêÎ£å",t.title=(n.text||"").substring(0,200),i.appendChild(t)}),e.appendChild(s),e.appendChild(i),n.appendChild(e)}addSuggestions(n,t){if(!t||0===t.length)return;const e=document.createElement("div");e.className="".concat(this.cssPrefix,"-suggestions"),t.slice(0,3).forEach(n=>{const t=document.createElement("button");t.className="".concat(this.cssPrefix,"-suggestion"),t.textContent=n,t.addEventListener("click",()=>{this.elements.input.value=n,this.elements.input.focus()}),e.appendChild(t)}),n.appendChild(e)}setLoading(n){if(this.state.isLoading=n,this.elements.sendButton.disabled=n,n){const n=document.createElement("div");n.className="".concat(this.cssPrefix,"-loading-wrap"),n.id="loading-indicator",n.innerHTML='\n        <div class="'.concat(this.cssPrefix,'-loading-dots">\n          <div class="').concat(this.cssPrefix,'-loading-dot"></div>\n          <div class="').concat(this.cssPrefix,'-loading-dot"></div>\n          <div class="').concat(this.cssPrefix,'-loading-dot"></div>\n        </div>\n      '),this.elements.messagesContainer.appendChild(n),this.scrollToBottom()}else{const n=document.getElementById("loading-indicator");n&&n.remove()}}scrollToBottom(){setTimeout(()=>{this.elements.messagesContainer.scrollTop=this.elements.messagesContainer.scrollHeight},100)}handleError(n,t){console.error("[WelnoRagChatWidget] ÏóêÎü¨:",t),this.addMessage("assistant","Ï£ÑÏÜ°Ìï©ÎãàÎã§. ".concat(n)),this.config.onError&&this.config.onError(t)}getChatIcon(){const n="".concat(this.cssPrefix,"-icon-slot");return this.config.chatIconUrl?'<span class="'.concat(n,'"><img src="').concat(this.config.chatIconUrl,'" alt="Ï±ÑÌåÖ Ïó¥Í∏∞" /></span>'):'\n      <span class="'.concat(n,'">\n        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">\n          <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n        </svg>\n      </span>\n    ')}getCloseIcon(){return'\n      <svg width="24" height="24" viewBox="0 0 24 24" fill="none">\n        <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>\n      </svg>\n    '}getSendIcon(){return'\n      <svg width="16" height="16" viewBox="0 0 24 24" fill="none">\n        <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n      </svg>\n    '}async warmup(){if(this.config.partnerData)try{const n=await fetch("".concat(this.config.baseUrl,"/welno-api/v1/rag-chat/partner/warmup"),{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":this.config.apiKey},body:JSON.stringify({uuid:this.config.uuid,hospital_id:this.config.hospitalId,health_data:this.config.partnerData})});if(n.ok){const t=await n.json();if(t.session_id&&(this.state.sessionId=t.session_id,console.log("[WelnoRagChatWidget] ÏÑ∏ÏÖò ÎèôÍ∏∞Ìôî ÏôÑÎ£å:",this.state.sessionId)),t.greeting){const n=(t.greeting||"").replace(/<br\s*\/?>/gi," ").replace(/\s+/g," ").trim();this.elements.welcomeBubble.querySelector(".".concat(this.cssPrefix,"-welcome-bubble-text")).textContent=n,setTimeout(()=>{this.state.isOpen||this.elements.welcomeBubble.classList.add("visible")},1e3)}}}catch(n){console.warn("[WelnoRagChatWidget] ÏõúÏóÖ Ïã§Ìå®:",n)}}destroy(){this.elements.container&&this.elements.container.parentNode&&this.elements.container.parentNode.removeChild(this.elements.container);const n=document.getElementById("".concat(this.cssPrefix,"-styles"));n&&!document.querySelector(".".concat(this.cssPrefix,"-container"))&&n.remove(),this.state.isInitialized=!1,console.log("[WelnoRagChatWidget] ÏúÑÏ†Ø Ï†úÍ±∞Îê®")}}n.exports?(n.exports=i,n.exports.default=i):void 0===(e=function(){return i}.apply(t,[]))||(n.exports=e),console.log("[WelnoRagChatWidget] Î°úÎìú ÏôÑÎ£å")}},t={},function e(s){var i=t[s];if(void 0!==i)return i.exports;var o=t[s]={exports:{}};return n[s](o,o.exports,e),o.exports}(803).default;var n,t});