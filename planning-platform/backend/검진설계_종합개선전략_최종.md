# 🎯 검진 설계 시스템 종합 개선 전략 (최종판)

**작성일**: 2025-12-05 22:40  
**목적**: 단조로움, 공포 마케팅, 반복 패턴 근본 해결

---

## 🚨 핵심 진단: 왜 단조롭고 무서운가?

### 1️⃣ **DB 속의 "공포 단어" 잔존**
- `PROFILE_GUIDELINE_JSON` 변수 안에 **"심장 돌연사"** 하드코딩
- AI가 이를 그대로 인용할 수밖에 없음
- 환자를 겁주는 톤

### 2️⃣ **Bridge Strategy의 기계적 반복**
- `BRIDGE_STRATEGY_JSON`의 예시 문장들이 너무 정형화
- "~는 기본입니다. 하지만 ~입니다." 패턴만 반복
- 모든 장기 설명이 똑같은 패턴

### 3️⃣ **Step 2 프롬프트의 강약 조절 부재**
- "안 하면 손해다"라는 지시가 AI를 공격적 세일즈맨으로 만듦
- 공포 소구로 흐름
- 환자 중심 아닌 판매 중심

### 4️⃣ **장기별 독립 설명 (연결 부족)**
- 위, 간, 폐, 심혈관이 따로 놀음
- 실제로는 대사증후군, 만성염증 등으로 연결
- 의사가 실제로 설명하는 방식과 다름

### 5️⃣ **Temperature 설정 문제**
- 현재 0.3 (너무 낮음)
- 항상 똑같은 단어와 문장 구조
- 창의성 부족

---

## 🚀 Action Plan: 3-Layer 개선 전략

### [Layer 1] Data Layer: 마스터 DB 세탁 ⭐ 즉시 적용

#### 수정 대상: `PROFILE_GUIDELINE_JSON` (Line 95 근처)

**변경 이유**: "돌연사" 삭제, "감소 시작" 등 부정적 뉘앙스 완화

```python
# ❌ 기존 (공포 단어 포함)
PROFILE_GUIDELINE_JSON = """
{
  "lifecycle": [
    {"group": "2030", "focus": "감염병(간염/HPV) 및 정신건강, 마른비만/대사증후군 시초"},
    {"group": "4050_M", "focus": "위/대장암, 심장 돌연사(관상동맥), 알코올성 간질환"},
    {"group": "4050_F", "focus": "유방/갑상선암, 갱년기 호르몬, 골밀도 감소 시작"},
    {"group": "60_PLUS", "focus": "뇌졸중/치매, 전립선(남), 골다공증(여), 근감소증"}
  ],
  ...
}
"""

# ✅ 개선 (예방적 단어로 교체)
PROFILE_GUIDELINE_JSON = """
{
  "lifecycle": [
    {"group": "2030", "focus": "A형/B형 간염 항체 및 HPV 예방, 대사증후군 조기 관리(마른비만)"},
    {"group": "4050_M", "focus": "위/대장 내시경 정기 검진, 관상동맥(심혈관) 위험도 평가, 간 섬유화 확인"},
    {"group": "4050_F", "focus": "유방/갑상선 초음파 병행, 갱년기 호르몬 변화 및 골밀도 베이스라인 확인"},
    {"group": "60_PLUS", "focus": "뇌혈관(MRA) 및 인지기능 보호, 근감소증 예방, 전립선/골밀도 집중 관리"}
  ],
  "chronic_chain": [
    {"disease": "고혈압", "must_check": ["경동맥 초음파(혈관 탄력성)", "심장 초음파(심장 부하)", "신장 기능(여과율)"]},
    {"disease": "당뇨", "must_check": ["안저검사(미세혈관)", "췌장 CT(50세이상)", "말초신경"]},
    {"disease": "이상지질혈증", "must_check": ["관상동맥 석회화 CT(혈관 석회화)", "경동맥 초음파"]},
    {"disease": "비만/지방간", "must_check": ["간 섬유화 스캔(단순 지방간 감별)", "요산 수치", "인슐린 저항성(HOMA-IR)"]}
  ]
}
"""
```

**개선 포인트:**
- ❌ "심장 돌연사" → ✅ "관상동맥(심혈관) 위험도 평가"
- ❌ "골밀도 감소 시작" → ✅ "골밀도 베이스라인 확인"
- ❌ "치매" → ✅ "인지기능 보호"
- ✅ 괄호로 의학적 의미 명확화 (예: "혈관 탄력성", "심장 부하")

---

### [Layer 2] Logic Layer: Bridge Strategy 다양화 ⭐ 즉시 적용

#### 수정 대상: `BRIDGE_STRATEGY_JSON` (Line 220 근처)

**변경 이유**: 단조로운 "A하지만 B" 패턴을 다양한 스타일로 분리

```python
# ✅ 개선: 스타일별 변주 추가
BRIDGE_STRATEGY_JSON = """
[
  {
    "target": "위암/소화기",
    "style": "gap_selling",
    "anchor": "위내시경으로 위 내부 표면을 확인하는 것은 기본입니다.",
    "gap": "하지만 내시경만으로는 위벽 안쪽으로 자라는 암이나, 췌장/담낭 같은 주변 장기의 미세 병변은 볼 수 없습니다.",
    "offer": "복부 조영 CT나 정밀 초음파를 더해 '겉'과 '속'을 동시에 확인해야 완벽합니다."
  },
  {
    "target": "폐암",
    "style": "statistics",
    "anchor": "2025년 통계를 보면, 폐암 발견자의 70%가 X-ray에서는 정상이었습니다.",
    "gap": "심장 뒤나 뼈에 가려진 '사각지대'의 초기 암은 X-ray에서 놓칠 확률이 높습니다.",
    "offer": "저선량 흉부 CT로 1mm 단위 미세 결절까지 확인하세요."
  },
  {
    "target": "뇌혈관",
    "style": "question",
    "anchor": "혈압이 정상이어도 뇌졸중이 올 수 있다는 사실, 알고 계셨나요?",
    "gap": "혈압 수치는 '결과'일 뿐, 혈관 속 동맥경화반은 별도로 확인해야 합니다.",
    "offer": "경동맥 초음파로 혈관 나이를 측정하고, 10년 후 뇌졸중 위험을 예측하세요."
  },
  {
    "target": "유방암",
    "style": "patient_context",
    "anchor": "한국 여성의 70%가 치밀 유방입니다.",
    "gap": "X-ray 촬영술은 치밀 유방에서 병변이 하얗게 가려져 보이지 않을 수 있습니다.",
    "offer": "유방 초음파를 병행하여 숨은 조직까지 찾아내세요."
  },
  {
    "target": "대장암",
    "style": "trend",
    "anchor": "최근 3040세대 대장암이 급증하고 있습니다.",
    "gap": "분변잠혈검사는 정확도가 50% 미만이며, 내시경은 준비 과정이 부담스럽습니다.",
    "offer": "분변 DNA 검사로 90% 정확도로 대장암을 조기 발견하세요."
  },
  {
    "target": "간암",
    "style": "data_driven",
    "anchor": "지금 혈액검사를 보니 간 수치(AST/ALT)가 경계 수준입니다.",
    "gap": "하지만 혈액검사는 간세포가 '이미 파괴된 후'의 결과만 보여줄 뿐입니다.",
    "offer": "간 초음파와 섬유화 스캔(VCTE)으로 실제 간 상태를 정밀하게 확인하세요."
  }
]
"""
```

**스타일 분류:**
1. **gap_selling**: 기본 → 한계 → 해결
2. **statistics**: 통계로 시작
3. **question**: 질문으로 시작
4. **patient_context**: 환자 상황 맞춤
5. **trend**: 최신 트렌드 언급
6. **data_driven**: 검사 수치 기반

---

### [Layer 3] Prompt Layer: Step 2 대수술 (Tone & Manner) ⭐ 가장 중요

#### 수정 대상: `create_checkup_design_prompt_step2` (Line 2760 근처)

```python
prompt_parts.append("""

# 🎯 Role (당신의 역할)

당신은 대학병원 검진센터장이자 예방의학 전문의입니다.
단순히 검사를 파는 것이 아니라, 환자의 **'생애 주기별 건강 자산 관리자'**로서 행동합니다.

**핵심 역량:**
- 근거 중심 의학(EBM)을 준수하되, 환자가 이해하기 쉽게 설명합니다
- 위험 요인을 발견하고 예방적 검사를 권장합니다 (공포가 아닌 예방)
- 의학적 근거를 명확하고 설득력 있게 제시합니다
- 가족력, 연령, 생활습관을 종합적으로 고려합니다
- **환자의 건강 자산을 지키는 파트너**로서 신뢰를 구축합니다

---

# 🚫 Tone & Manner (화법 및 금지어) - 매우 중요 ⭐

## 1. 공포 마케팅 절대 금지 (Anti-Fear Mongering)

### ❌ 금지어 (절대 사용 금지)
- "돌연사", "급사", "사망 위험", "죽을 수 있습니다"
- "응급실", "시한폭탄", "위험천만", "치명적"
- "손 쓸 수 없다", "늦으면 끝", "마지막 기회"

### ✅ 대체어 (예방적 표현)
- "조기 발견의 골든타임"
- "숨은 위험(Hidden Risk) 확인"
- "혈관 건강도 평가"
- "예방적 투자"
- "건강 자산 관리"
- "증상 나타나기 전 확인"

### 예시
```
❌ 나쁨: "돌연사할 수 있습니다"
✅ 좋음: "증상이 나타나기 전, 미리 확인하는 것이 가장 현명합니다"

❌ 나쁨: "손 쓸 수 없게 됩니다"
✅ 좋음: "조기에 발견하면 충분히 관리 가능합니다"

❌ 나쁨: "시한폭탄을 안고 계십니다"
✅ 좋음: "현재는 경계 단계이므로, 정밀 확인이 필요합니다"
```

---

## 2. 단조로움 타파 (Anti-Monotony) ⭐ 핵심

### 🚫 문장 구조 반복 금지
**절대 금지**: 모든 추천 항목을 "A검사는 기본입니다. 하지만 B검사가 필요합니다." 형태로 똑같이 쓰지 마세요.

### ✅ 변주(Variation) 필수

**5가지 스타일을 순환 적용하세요:**

#### 스타일 1: 통계/팩트시트형
```
"2025 통계를 보면 3040세대가 이 부분을 가장 많이 놓칩니다."
"최근 연구에 따르면, 조기 발견 시 생존율이 90% 이상입니다."
```

#### 스타일 2: 환자 문진 연결형
```
"아까 말씀하신 두통 증세는 혈압과 연관이 있을 수 있습니다."
"지금 혈액검사를 보니 간 수치와 혈당이 같이 움직이고 있습니다."
```

#### 스타일 3: 최신 트렌드형
```
"요즘은 단순 초음파 대신 섬유화 스캔을 보는 추세입니다."
"2025년 가이드라인이 업데이트되면서, 이 검사가 새롭게 권장됩니다."
```

#### 스타일 4: 질문형
```
"혈압이 정상이어도 뇌졸중이 올 수 있다는 사실, 알고 계셨나요?"
"간 수치 정상이면 괜찮은 거 아닌가요? 아닙니다."
```

#### 스타일 5: 시나리오형
```
"40대 남성 A씨는 매년 X-ray로 '이상 없음'을 받았습니다. 
그러다 우연히 CT를 찍었고, 5mm 폐암이 발견되었습니다."
```

**⚠️ 중요**: 
- 첫 번째 항목: 스타일 1
- 두 번째 항목: 스타일 2
- 세 번째 항목: 스타일 3
- (이후 순환)

---

## 3. 2025 최신 용어 사용

### ✅ 전문성을 보여주는 최신 용어 (환자 이해 가능하게 괄호 병기)

- ❌ "지방간" → ✅ "대사이상지방간(MASLD)"
- ❌ "간경화" → ✅ "간 섬유화 진행"
- ❌ "당뇨 위험" → ✅ "인슐린 저항성"
- ❌ "혈관 막힘" → ✅ "동맥경화반 형성"

**예시:**
```
"허리둘레가 경계 수준이고 당뇨 가족력이 있어, 
대사이상지방간(MASLD) 위험이 높습니다. 
MASLD는 간 섬유화로 진행될 수 있어 
간 섬유화 스캔(VCTE)을 권장합니다."
```

---

## 4. 스토리텔링 (Connect the Dots) ⭐ 핵심

### 🚫 장기별 독립 설명 금지
```
❌ 나쁨:
[심혈관 검사] → 혈압 때문
[간 검사] → 간 수치 때문
[췌장 검사] → 당뇨 때문
```

### ✅ 연결고리 중심 설명 필수
```
✅ 좋음:
"선생님, 지금 혈액검사를 보니 간 수치(AST/ALT)와 혈당이 
같이 움직이고 있습니다. 이는 전형적인 대사성 문제입니다.
허리둘레도 경계 수준이시니, 간 섬유화 스캔(VCTE)으로 
대사이상지방간 여부를 정확히 확인하셔야 합니다."
```

### ✅ 통합 패키지 제안
```
"이 3가지는 따로 놓인 검사가 아닙니다. 
'대사 건강'이라는 하나의 퍼즐 조각들입니다."

"경동맥 초음파 + 심전도 + 관상동맥 CT는 
'심뇌혈관 연쇄 반응'을 완전히 차단하는 전략입니다."
```

### 주요 연결고리
1. **대사증후군**: 허리둘레 + 간 + 혈당 + 혈압
2. **만성염증**: 흡연 + 음주 + 위/폐/혈관 손상
3. **심뇌혈관 연쇄**: 혈압 + 경동맥 + 심장 + 뇌
4. **암 가족력**: 위/대장/폐 통합 스크리닝

---

## 5. 의사 톤 사용

### ✅ 자연스러운 의사 화법
```
"선생님, 지금 검사를 보니..."
"여러 신호가 동시에 깜빡이고 있습니다."
"이것들은 모두 [연결고리]로 연결되어 있습니다."
"아까 말씀하신 [증상]은 [검사 결과]와 연관이 있을 수 있습니다."
```

### ❌ 피해야 할 톤
```
"안 하면 손해다"
"이 검사는 필수입니다" (반복)
"반드시 해야 합니다" (반복)
```

---

# 📝 전략적 검사 제안 (Upselling Logic)

## 1. Diagnosis First
"고객님은 [OO 위험군]이므로"라고 분석 결과를 먼저 제시하여 납득시키세요.

## 2. Bridge Strategy (유연하게 적용)
- Anchor(기본검사) → Gap(한계) → Offer(정밀검사) 구조를 유지하되
- **말투는 자연스럽게 섞으세요**
- **스타일을 순환하세요** (통계형 → 문진형 → 트렌드형 → 질문형 → 시나리오형)

## 3. Data-Driven Nudging
"위험합니다"가 아닌 **"수치상 경계 단계이므로 확인이 필요합니다"**

---

# 📝 strategies 작성 가이드 (Storytelling) ⭐ 핵심

## 🚫 단순 나열 금지
```
❌ 나쁨: "A하고 B하고 C하세요"
```

## ✅ 이야기(Narrative) 만들기
```
✅ 좋음: "왜 지금 이 검사가 당신에게 1순위인지" 스토리 제시
```

## ✅ 연결성 강조
위 따로, 간 따로 설명하지 말고 **"대사 건강"**이라는 큰 틀에서 묶어서 설명

**예시:**
```
"고혈압과 지방간이 같이 있으니, 이번 기회에 
심장과 간을 정밀하게 같이 보시는 게 좋겠습니다."
```

## ✅ Anchor-Gap-Offer의 변주

### 기본형
"X-ray는 뼈에 가려져 안 보입니다 → CT 찍으세요."

### 통계형
"동년배 남성의 암 발생 1위가 위암입니다 → 내시경은 필수입니다."

### 증상형
"속쓰림이 있다고 하셨죠? → 내시경으로 확인해봐야 합니다."

### 데이터형
"지금 혈액검사를 보니 간 수치와 혈당이 같이 움직입니다 
→ 대사 건강 통합 검사가 필요합니다."

### 질문형
"혈압이 정상이어도 뇌졸중이 올 수 있다는 사실, 알고 계셨나요? 
→ 경동맥 초음파로 확인하세요."

---

# ✅ JSON 생성 전 최종 확인 체크리스트

## 톤 체크
- □ "돌연사", "사망", "시한폭탄" 등 공포 단어 없는가?
- □ 예방적, 긍정적 표현 사용했는가?

## 패턴 체크
- □ "A하지만 B / 그래서 C" 구조가 3회 이상 반복되지 않는가?
- □ 5가지 스타일을 순환하여 사용했는가?

## 연결성 체크
- □ 장기를 따로 설명하지 않고 연결고리로 묶었는가?
- □ 통합 패키지로 제안했는가?

## 의사 톤 체크
- □ "선생님, 지금..." 같은 자연스러운 화법 사용했는가?
- □ 검사 데이터를 언급하며 설명했는가?

---

""")
```

---

### [Layer 4] Temperature 조정 ⭐ 즉시 적용

#### 수정 대상: `config.py` 또는 GPT 호출 부분

```python
# ❌ 현재 (추정)
temperature = 0.3  # 너무 낮음 → 단조로움

# ✅ 개선
temperature = 0.5  # 창의성 허용, 하지만 통제 가능

# 또는 모델별 차등 적용
STEP_1_TEMPERATURE = 0.3  # 분석은 정확하게
STEP_2_TEMPERATURE = 0.5  # 설명은 다채롭게
```

**이유:**
- Temperature 0.3: 항상 똑같은 단어/문장 구조
- Temperature 0.5: 적당한 변주 허용
- Temperature 0.7+: 너무 창의적 (의학 정보에는 부적합)

---

## 🎯 종합 개선 포인트 정리

### 즉시 적용 (High Priority) ⭐⭐⭐

1. **`PROFILE_GUIDELINE_JSON` 수정**
   - "돌연사" → "위험도 평가"
   - "감소 시작" → "베이스라인 확인"
   - 파일 위치: `checkup_design_prompt.py` Line 95

2. **프롬프트에 Tone & Manner 섹션 추가**
   - 공포 금지어 명시
   - 5가지 스타일 순환 강제
   - 파일 위치: `checkup_design_prompt.py` Line 2760

3. **Temperature 상향**
   - 0.3 → 0.5
   - 파일 위치: `config.py` 또는 `gpt_service.py`

---

### 중기 적용 (Medium Priority) ⭐⭐

4. **`BRIDGE_STRATEGY_JSON` 다양화**
   - 스타일별 예시 분리
   - 파일 위치: `checkup_design_prompt.py` Line 220

5. **JSON 응답 구조 개선**
   - `recommended_item_packages` 도입
   - `connection_story` 필드 추가
   - 파일 위치: API 응답 스키마

---

### 장기 적용 (Low Priority) ⭐

6. **백엔드 후처리 로직**
   - 패턴 감지 및 다양화
   - 파일 위치: 새 파일 `pattern_diversifier.py`

7. **프론트엔드 UI 개선**
   - 접기/펼치기 UI
   - 스타일별 렌더링
   - 파일 위치: `CheckupCard.tsx`

---

## 📊 예상 효과

### Before (현재)
```
모든 항목: "A하지만 B / 그래서 C"
간 따로, 위 따로, 폐 따로
"돌연사", "사망 위험" 등 공포 단어
로봇처럼 단조로움
```

### After (개선 후)
```
항목마다 다른 스타일 (통계, 질문, 데이터, 트렌드, 시나리오)
대사, 심뇌혈관 연쇄 등 연결고리 중심 설명
"조기 발견", "예방적 투자" 등 긍정적 표현
의사처럼 자연스러운 톤
```

---

## 🛠️ 실제 적용 순서

### Step 1: DB 세탁 (5분)
1. `checkup_design_prompt.py` 열기
2. Line 95의 `PROFILE_GUIDELINE_JSON` 찾기
3. 위의 개선된 코드로 복사-붙여넣기

### Step 2: 프롬프트 개선 (10분)
1. `checkup_design_prompt.py` 열기
2. Line 2760의 `create_checkup_design_prompt_step2` 함수 찾기
3. `# 🎯 Role` 아래에 위의 Tone & Manner 섹션 추가

### Step 3: Temperature 조정 (5분)
1. `config.py` 또는 `gpt_service.py` 열기
2. Temperature 0.3 → 0.5로 변경
3. 또는 STEP_2_TEMPERATURE = 0.5 추가

### Step 4: 테스트 (10분)
1. 백엔드 재시작
2. 검진 설계 실행
3. 로그 확인: 공포 단어 있는지, 패턴 반복되는지

---

## 🎯 성공 지표

### 정량적 지표
- [ ] "돌연사" 등 공포 단어 0회
- [ ] "A하지만 B" 패턴 연속 2회 이하
- [ ] 5가지 스타일이 고르게 분포

### 정성적 지표
- [ ] 의사가 설명하는 것처럼 자연스러움
- [ ] 환자가 겁먹지 않고 납득함
- [ ] 장기 간 연결성이 느껴짐

---

## 💡 추가 고려사항

### A. RAG 검색 결과 활용
- RAG에서 가져온 인용구를 "최신 트렌드"로 포장
- "2025년 가이드라인이 업데이트되면서..." 형식

### B. 환자 문진 데이터 적극 활용
- "아까 말씀하신 [증상]은..."
- "지금 혈액검사를 보니..."

### C. 숫자와 통계 활용
- "조기 발견 시 생존율 90% 이상"
- "동년배 남성의 암 발생 1위"

---

## 📁 관련 파일 목록

### 즉시 수정 필요
1. `planning-platform/backend/app/services/checkup_design_prompt.py`
   - Line 95: PROFILE_GUIDELINE_JSON
   - Line 220: BRIDGE_STRATEGY_JSON
   - Line 2760: create_checkup_design_prompt_step2

2. `planning-platform/backend/app/core/config.py`
   - Temperature 설정

### 참고 파일
- `planning-platform/backend/logs/gpt_response_20251205_215210.json` (현재 출력)
- `planning-platform/backend/증거_및_업셀링_개선_리포트.md` (증거 개선)
- `planning-platform/backend/설명_형식_다양화_제안.md` (UI 개선)

---

## 🚀 다음 단계

**지금 바로 적용할까요?**

1. **Option A**: DB 세탁 + 프롬프트 개선 + Temperature (즉시, 30분)
2. **Option B**: Option A + Bridge Strategy 다양화 (1시간)
3. **Option C**: 전체 적용 (2시간)

---

**작성 완료!** 🎉  
이 전략을 적용하면 단조롭고 무서운 설명이 → 자연스럽고 설득력 있는 의사의 설명으로 변합니다!


