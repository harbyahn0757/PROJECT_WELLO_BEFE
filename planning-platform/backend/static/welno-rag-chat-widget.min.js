!function(n,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.WelnoRagChatWidget=t():n.WelnoRagChatWidget=t()}(this,()=>{return n={803(n,t){var e,s={"5a9bb40b5108ecd8ef864658d5a2d5ab":"/welno-api/static/mdx_icon.png"},i={default:{headerBg:"#7B5E4F",accent:"#7B5E4F",accentHover:"#6B4E3F",welcomeText:"#7B5E4F",userBubble:"#7B5E4F",buttonColor:"#A69B8F",borderSubtle:"rgba(123, 94, 79, 0.1)"},navy:{headerBg:"#1e3a5f",accent:"#2c5282",accentHover:"#234a75",welcomeText:"#1e3a5f",userBubble:"#2c5282",buttonColor:"#2c5282",borderSubtle:"rgba(30, 58, 95, 0.12)"}};class o{constructor(n){if(!n.apiKey)throw new Error("WelnoRagChatWidget: apiKey is required");var t=n.baseUrl||("undefined"!=typeof window?window.location.origin:""),e=n.chatIconUrl||null;!e&&n.apiKey&&s[n.apiKey]&&(e=t.replace(/\/$/,"")+s[n.apiKey]),this.config={apiKey:n.apiKey,baseUrl:t,uuid:n.uuid||"widget_user_"+Date.now(),hospitalId:n.hospitalId||"widget_partner",partnerData:n.partnerData||null,position:n.position||"bottom-right",theme:n.theme||"default",buttonColor:n.buttonColor||"#A69B8F",chatIconUrl:e,autoOpen:n.autoOpen||!1,welcomeMessage:n.welcomeMessage||"ì•ˆë…•í•˜ì„¸ìš”! ê±´ê°•ê³¼ ì˜ì–‘ì— ëŒ€í•´ ê¶ê¸ˆí•œ ì ì„ ë¬¼ì–´ë³´ì„¸ìš”. ğŸ˜Š",onOpen:n.onOpen||null,onClose:n.onClose||null,onMessage:n.onMessage||null,onError:n.onError||null},this.state={isOpen:!1,isLoading:!1,messages:[],sessionId:null,suggestions:[],isInitialized:!1,assistantMsgCount:0},this.elements={container:null,button:null,window:null,messagesContainer:null,input:null,sendButton:null},this.cssPrefix="welno-rag-widget"}async init(){if(this.state.isInitialized)console.warn("[WelnoRagChatWidget] ì´ë¯¸ ì´ˆê¸°í™”ë¨");else try{await this.fetchRemoteConfig(),this.injectStyles(),this.createDOM(),this.bindEvents(),this.state.sessionId="temp_".concat(this.config.uuid,"_").concat(Date.now()),this.warmup(),this.addMessage("assistant",this.config.welcomeMessage),this.config.autoOpen&&setTimeout(()=>this.open(),500),this.state.isInitialized=!0}catch(n){console.warn("[WelnoRagChatWidget] ìœ„ì ¯ í™œì„±í™” ì¡°ê±´ ë¯¸ì¶©ì¡± (ë“±ë¡ë˜ì§€ ì•Šì€ íŒŒíŠ¸ë„ˆ/ë³‘ì›):",n.message),this.destroy()}}async fetchRemoteConfig(){try{var n="welno";"5a9bb40b5108ecd8ef864658d5a2d5ab"===this.config.apiKey&&(n="medilinx");var t="".concat(this.config.baseUrl,"/welno-api/v1/admin/embedding/config/frontend?partner_id=").concat(n);this.config.hospitalId&&(t+="&hospital_id=".concat(this.config.hospitalId));const e=await fetch(t);if(!e.ok)throw new Error("ë“±ë¡ë˜ì§€ ì•Šì€ ë³‘ì› ë˜ëŠ” íŒŒíŠ¸ë„ˆì…ë‹ˆë‹¤. (HTTP ".concat(e.status,")"));{const n=await e.json();n.theme&&n.theme.primary_color&&(this.config.buttonColor=n.theme.primary_color,this.config.themeData=n.theme),n.theme&&n.theme.icon_url&&(this.config.chatIconUrl=n.theme.icon_url),n.welcome_message&&(this.config.welcomeMessage=n.welcome_message),n.partner_name&&(this.config.partnerName=n.partner_name)}}catch(n){throw console.error("[WelnoRagChatWidget] ì„œë²„ ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:",n),n}}injectStyles(){const n="".concat(this.cssPrefix,"-styles");if(document.getElementById(n))return;if(!document.getElementById("welno-noto-sans-kr"))try{const n=document.createElement("link");n.id="welno-noto-sans-kr",n.rel="stylesheet",n.href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap",n.onerror=function(){},document.head.appendChild(n)}catch(n){}var t="navy"===this.config.theme?"navy":"default",e=i[t],s=this.config.buttonColor||e.buttonColor,o=this.config.themeData&&this.config.themeData.primary_color||e.headerBg;const a="\n      /* Welno RAG Chat Widget Styles */\n      .".concat(this.cssPrefix,"-container {\n        position: fixed;\n        z-index: 9999;\n        font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        font-size: 15px;\n        line-height: 1.4;\n        color: #333;\n        box-sizing: border-box;\n      }\n      \n      .").concat(this.cssPrefix,"-container *,\n      .").concat(this.cssPrefix,"-container *::before,\n      .").concat(this.cssPrefix,"-container *::after {\n        box-sizing: border-box;\n      }\n\n      /* ìœ„ì¹˜ë³„ ìŠ¤íƒ€ì¼ */\n      .").concat(this.cssPrefix,"-container.position-bottom-right {\n        bottom: 24px;\n        right: 24px;\n      }\n      \n      .").concat(this.cssPrefix,"-container.position-bottom-left {\n        bottom: 24px;\n        left: 24px;\n      }\n      \n      .").concat(this.cssPrefix,"-container.position-top-right {\n        top: 24px;\n        right: 24px;\n      }\n      \n      .").concat(this.cssPrefix,"-container.position-top-left {\n        top: 24px;\n        left: 24px;\n      }\n\n      /* ì±„íŒ… ë²„íŠ¼ */\n      .").concat(this.cssPrefix,"-button {\n        width: 56px;\n        height: 56px;\n        min-width: 56px;\n        min-height: 56px;\n        padding: 0;\n        border: none;\n        border-radius: 50%;\n        background: ").concat(s,";\n        color: white;\n        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        transition: all 0.3s ease;\n        outline: none;\n        overflow: hidden;\n        position: relative;\n      }\n\n      .").concat(this.cssPrefix,"-button:hover {\n        transform: scale(1.1);\n        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);\n        filter: brightness(0.9);\n      }\n\n      .").concat(this.cssPrefix,"-button.active {\n        filter: brightness(0.9);\n      }\n\n      /* íŒŒíŠ¸ë„ˆ ì•„ì´ì½˜: ì´ë¯¸ì§€ì¼ ë•ŒëŠ” ì›í˜• ë²„íŠ¼ ì „ì²´ë¥¼ ê½‰ ì±„ì›€, SVGëŠ” 24x24 ìœ ì§€ */\n      .").concat(this.cssPrefix,"-button .").concat(this.cssPrefix,"-icon-slot {\n        position: absolute;\n        inset: 0;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        border-radius: 50%;\n        overflow: hidden;\n      }\n      .").concat(this.cssPrefix,"-button .").concat(this.cssPrefix,"-icon-slot svg {\n        width: 24px;\n        height: 24px;\n        flex-shrink: 0;\n        display: block;\n      }\n      .").concat(this.cssPrefix,"-button .").concat(this.cssPrefix,"-icon-slot img {\n        position: absolute;\n        inset: 0;\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n        object-position: center;\n        display: block;\n      }\n\n      /* ì±„íŒ… ì°½ */\n      .").concat(this.cssPrefix,"-window {\n        position: absolute;\n        bottom: 70px;\n        right: 0;\n        width: 400px; /* 360px -> 400px */\n        height: 650px; /* 550px -> 650px */\n        background: #FFFAF2;\n        border-radius: 20px;\n        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);\n        display: none;\n        flex-direction: column;\n        overflow: hidden;\n        border: 1px solid ").concat(e.borderSubtle,";\n        animation: slideInUp 0.3s ease-out;\n      }\n\n      .").concat(this.cssPrefix,"-window.open {\n        display: flex;\n      }\n\n      .").concat(this.cssPrefix,"-container.position-bottom-left .").concat(this.cssPrefix,"-window {\n        right: auto;\n        left: 0;\n      }\n\n      .").concat(this.cssPrefix,"-container.position-top-right .").concat(this.cssPrefix,"-window {\n        bottom: auto;\n        top: 70px;\n      }\n\n      .").concat(this.cssPrefix,"-container.position-top-left .").concat(this.cssPrefix,"-window {\n        bottom: auto;\n        top: 70px;\n        right: auto;\n        left: 0;\n      }\n\n      @keyframes slideInUp {\n        from {\n          transform: translateY(20px);\n          opacity: 0;\n        }\n        to {\n          transform: translateY(0);\n          opacity: 1;\n        }\n      }\n\n      /* í—¤ë” */\n      .").concat(this.cssPrefix,"-header {\n        background: ").concat(o,";\n        color: white;\n        padding: 12px 16px;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n      }\n\n      .").concat(this.cssPrefix,"-header h3 {\n        margin: 0;\n        font-size: 16px;\n        font-weight: 600;\n        letter-spacing: -0.5px;\n      }\n\n      .").concat(this.cssPrefix,"-close-button {\n        background: none;\n        border: none;\n        color: white;\n        font-size: 20px;\n        cursor: pointer;\n        padding: 4px;\n        border-radius: 4px;\n        transition: background-color 0.2s;\n      }\n\n      .").concat(this.cssPrefix,"-close-button:hover {\n        background: rgba(255, 255, 255, 0.1);\n      }\n\n      /* ì›°ì»´ ë²„ë¸” - ë·°í¬íŠ¸ ê¸°ì¤€ ê³ ì • ìœ„ì¹˜ë¡œ ê°€ë¡œ ë„ˆë¹„ í™œìš© (!important ì¶”ê°€ë¡œ ê°•ì œ ì ìš©) */\n      .").concat(this.cssPrefix,"-welcome-bubble {\n        position: fixed !important;\n        background: white !important;\n        padding: 12px 18px !important;\n        border-radius: 16px !important;\n        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1) !important;\n        border: 1px solid ").concat(s," !important;\n        width: max-content !important;\n        min-width: 240px !important;\n        max-width: min(80vw, 320px) !important;\n        white-space: normal !important;\n        word-break: normal !important;\n        opacity: 0;\n        transform: translateY(10px);\n        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n        pointer-events: none;\n        cursor: pointer;\n        z-index: 9998 !important;\n      }\n      .").concat(this.cssPrefix,"-container.position-bottom-right .").concat(this.cssPrefix,"-welcome-bubble {\n        right: 24px !important;\n        bottom: 96px !important;\n        left: auto !important;\n        top: auto !important;\n      }\n      .").concat(this.cssPrefix,"-container.position-bottom-left .").concat(this.cssPrefix,"-welcome-bubble {\n        left: 24px !important;\n        bottom: 96px !important;\n        right: auto !important;\n        top: auto !important;\n      }\n      .").concat(this.cssPrefix,"-container.position-top-right .").concat(this.cssPrefix,"-welcome-bubble {\n        right: 24px !important;\n        top: 96px !important;\n        bottom: auto !important;\n        left: auto !important;\n      }\n      .").concat(this.cssPrefix,"-container.position-top-left .").concat(this.cssPrefix,"-welcome-bubble {\n        left: 24px !important;\n        top: 96px !important;\n        right: auto !important;\n        bottom: auto !important;\n      }\n\n      .").concat(this.cssPrefix,"-welcome-bubble.visible {\n        opacity: 1;\n        transform: translateY(0);\n        pointer-events: auto;\n      }\n\n      .").concat(this.cssPrefix,"-welcome-bubble::after {\n        content: '';\n        position: absolute;\n        bottom: -8px;\n        right: 20px;\n        width: 0;\n        height: 0;\n        border-left: 8px solid transparent;\n        border-right: 8px solid transparent;\n        border-top: 8px solid ").concat(s,";\n      }\n\n      .").concat(this.cssPrefix,"-welcome-bubble::before {\n        content: '';\n        position: absolute;\n        bottom: -6px;\n        right: 21px;\n        width: 0;\n        height: 0;\n        border-left: 7px solid transparent;\n        border-right: 7px solid transparent;\n        border-top: 7px solid white;\n        z-index: 1;\n      }\n\n      .").concat(this.cssPrefix,"-welcome-bubble-text {\n        font-weight: 500;\n        color: ").concat(s,";\n        font-size: 14px;\n        line-height: 1.4;\n      }\n      @media (max-width: 480px) {\n        .").concat(this.cssPrefix,"-welcome-bubble {\n          min-width: 200px;\n          max-width: min(80vw, 320px);\n        }\n      }\n\n      @keyframes bubbleBounce {\n        0%, 100% { transform: translateY(0); }\n        50% { transform: translateY(-5px); }\n      }\n\n      .").concat(this.cssPrefix,"-welcome-bubble.visible {\n        animation: bubbleBounce 3s infinite ease-in-out;\n      }\n\n      /* ë©”ì‹œì§€ ì˜ì—­ - ë©”ì‹œì§€ê°€ ì ì„ ë•Œ í•˜ë‹¨ë¶€í„° ìŒ“ì„ (ì±„íŒ… UX) */\n      .").concat(this.cssPrefix,"-messages {\n        flex: 1;\n        overflow-y: auto;\n        padding: 20px;\n        background: #FFFAF2;\n        display: flex;\n        flex-direction: column;\n      }\n\n      /* ë©”ì‹œì§€ê°€ ì ì„ ë•Œ ë¹ˆ ê³µê°„ì„ ìœ„ìª½ìœ¼ë¡œ ë°€ì–´ ë©”ì‹œì§€ë¥¼ ì…ë ¥ì°½ ê°€ê¹Œì´ ë°°ì¹˜ */\n      .").concat(this.cssPrefix,"-messages::before {\n        content: '';\n        flex: 1 1 auto;\n      }\n\n      .").concat(this.cssPrefix,"-message {\n        margin-bottom: 16px;\n        display: flex;\n        flex-direction: column;\n      }\n\n      .").concat(this.cssPrefix,"-message.user {\n        align-items: flex-end;\n      }\n\n      .").concat(this.cssPrefix,"-message.assistant {\n        align-items: flex-start;\n      }\n\n      .").concat(this.cssPrefix,"-message-bubble {\n        max-width: 85%;\n        padding: 12px 16px;\n        border-radius: 18px;\n        word-wrap: break-word;\n        line-height: 1.6;\n        font-size: 14.5px;\n      }\n\n      .").concat(this.cssPrefix,"-message.user .").concat(this.cssPrefix,"-message-bubble {\n        background: ").concat(s,";\n        color: white;\n        border-bottom-right-radius: 2px;\n        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n      }\n\n      .").concat(this.cssPrefix,"-message.assistant .").concat(this.cssPrefix,"-message-bubble {\n        background: #F8EDDA;\n        color: #4A3A34;\n        border-bottom-left-radius: 2px;\n        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);\n      }\n\n      .").concat(this.cssPrefix,"-message-bubble ul,\n      .").concat(this.cssPrefix,"-message-bubble ol {\n        margin: 4px 0 !important;\n        padding-left: 20px !important;\n        list-style: disc !important;\n      }\n      .").concat(this.cssPrefix,"-message-bubble ol {\n        list-style: decimal !important;\n      }\n      .").concat(this.cssPrefix,"-message-bubble li {\n        margin: 2px 0 !important;\n        display: list-item !important;\n        line-height: 1.5 !important;\n      }\n\n      .").concat(this.cssPrefix,"-message-footer {\n        margin-top: 4px;\n        padding: 0 4px;\n      }\n\n      .").concat(this.cssPrefix,"-message-footer-row {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 8px;\n      }\n\n      .").concat(this.cssPrefix,"-message-time {\n        font-size: 11px;\n        color: #999;\n      }\n\n      /* ë¡œë”© ì¸ë””ì¼€ì´í„° (ë§í’ì„  ì—†ì´ ì  ì„¸ ê°œë§Œ) */\n      .").concat(this.cssPrefix,"-loading-wrap {\n        display: flex;\n        align-items: center;\n        align-self: flex-start;\n        padding: 8px 0;\n      }\n\n      .").concat(this.cssPrefix,"-loading-dots {\n        display: flex;\n        gap: 4px;\n      }\n\n      .").concat(this.cssPrefix,"-loading-dot {\n        width: 8px;\n        height: 8px;\n        border-radius: 50%;\n        background: #999;\n        animation: loadingDot 1.4s infinite ease-in-out both;\n      }\n\n      .").concat(this.cssPrefix,"-loading-dot:nth-child(1) { animation-delay: -0.32s; }\n      .").concat(this.cssPrefix,"-loading-dot:nth-child(2) { animation-delay: -0.16s; }\n\n      @keyframes loadingDot {\n        0%, 80%, 100% {\n          transform: scale(0);\n        }\n        40% {\n          transform: scale(1);\n        }\n      }\n\n      /* ì…ë ¥ ì˜ì—­ */\n      .").concat(this.cssPrefix,"-input-area {\n        padding: 16px 20px;\n        background: white;\n        border-top: 1px solid #E5E5E5;\n        display: flex;\n        gap: 12px;\n        align-items: flex-end;\n      }\n\n      .").concat(this.cssPrefix,"-input {\n        flex: 1;\n        border: 1px solid #E5E5E5;\n        border-radius: 20px;\n        padding: 10px 16px;\n        font-size: 15px;\n        outline: none;\n        resize: none;\n        min-height: 20px;\n        max-height: 100px;\n        font-family: inherit;\n      }\n\n      .").concat(this.cssPrefix,"-input:focus {\n        border-color: ").concat(s,";\n      }\n\n      .").concat(this.cssPrefix,"-send-button {\n        width: 40px;\n        height: 40px;\n        border-radius: 50%;\n        background: ").concat(s,";\n        color: white;\n        border: none;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        transition: background-color 0.2s;\n        flex-shrink: 0;\n      }\n\n      .").concat(this.cssPrefix,"-send-button:hover {\n        filter: brightness(0.9);\n      }\n\n      .").concat(this.cssPrefix,"-send-button:disabled {\n        background: #CCC;\n        cursor: not-allowed;\n      }\n\n      .").concat(this.cssPrefix,"-send-button svg {\n        width: 16px;\n        height: 16px;\n      }\n\n      /* ë°˜ì‘í˜•: ëª¨ë°”ì¼ì—ì„œ ì „ì²´ í™”ë©´ ê½‰ ì±„ìš°ê¸° */\n      @media (max-width: 480px) {\n        .").concat(this.cssPrefix,"-window {\n          width: 100% !important;\n          height: 100dvh !important;\n          height: 100vh !important;\n          height: -webkit-fill-available !important;\n          bottom: 0 !important;\n          right: 0 !important;\n          top: 0 !important;\n          left: 0 !important;\n          border-radius: 0 !important;\n          max-width: none !important;\n          max-height: none !important;\n          position: fixed !important;\n        }\n\n        .").concat(this.cssPrefix,"-window .").concat(this.cssPrefix,"-header {\n          padding-top: max(12px, env(safe-area-inset-top));\n          flex-shrink: 0;\n        }\n\n        .").concat(this.cssPrefix,"-window .").concat(this.cssPrefix,"-messages {\n          flex: 1;\n          min-height: 0;\n          overflow-y: auto;\n          -webkit-overflow-scrolling: touch;\n        }\n\n        .").concat(this.cssPrefix,"-window .").concat(this.cssPrefix,"-input-area {\n          flex-shrink: 0;\n          padding-bottom: max(16px, env(safe-area-inset-bottom));\n          position: sticky;\n          bottom: 0;\n          z-index: 10;\n          background: white;\n        }\n\n        .").concat(this.cssPrefix,"-container {\n          bottom: 0 !important;\n          right: 0 !important;\n          width: 100% !important;\n          height: 100% !important;\n          pointer-events: none; /* ì»¨í…Œì´ë„ˆ ìì²´ëŠ” í´ë¦­ í†µê³¼ */\n        }\n\n        .").concat(this.cssPrefix,"-container > * {\n          pointer-events: auto; /* ìì‹ ìš”ì†ŒëŠ” í´ë¦­ ê°€ëŠ¥ */\n        }\n\n        .").concat(this.cssPrefix,"-button {\n          bottom: 24px !important;\n          right: 24px !important;\n          position: fixed !important;\n          z-index: 10001;\n        }\n\n        /* ì±„íŒ…ì°½ì´ ì—´ë ¸ì„ ë•Œ í•˜ë‹¨ í”Œë¡œíŒ… ë²„íŠ¼ ìˆ¨ê¸°ê¸° (ì»¨í…Œì´ë„ˆ í´ë˜ìŠ¤ ê¸°ì¤€) */\n        .").concat(this.cssPrefix,"-container.is-open .").concat(this.cssPrefix,"-button {\n          display: none !important;\n        }\n      }\n\n      /* í—¤ë” ê³ ì • ë° ë©”ì‹œì§€ ì˜ì—­ ë…ë¦½ ìŠ¤í¬ë¡¤ ê°•í™” */\n      .").concat(this.cssPrefix,"-window {\n        display: none;\n        flex-direction: column;\n        height: 650px;\n        position: relative; /* ìì‹ ìš”ì†Œ í¬ì§€ì…”ë‹ ê¸°ì¤€ */\n      }\n      .").concat(this.cssPrefix,"-window.open {\n        display: flex !important;\n      }\n      .").concat(this.cssPrefix,"-header {\n        flex-shrink: 0;\n        z-index: 2;\n      }\n      .").concat(this.cssPrefix,"-messages {\n        flex: 1;\n        overflow-y: auto;\n        -webkit-overflow-scrolling: touch;\n        padding-bottom: 20px;\n      }\n      .").concat(this.cssPrefix,"-input-area {\n        flex-shrink: 0;\n        z-index: 2;\n        background: white;\n      }\n\n      /* ì†ŒìŠ¤ ì•„ì½”ë””ì–¸: ì‹œê°„ ì˜† í† ê¸€ + ì•„ë˜ì— ë¦¬ìŠ¤íŠ¸ í™•ì¥ */\n      .").concat(this.cssPrefix,"-sources-toggle {\n        cursor: pointer;\n        display: inline-flex;\n        align-items: center;\n        gap: 3px;\n        padding: 0;\n        border: none;\n        background: none;\n        font-size: 11px;\n        font-weight: 600;\n        color: ").concat(s,";\n        user-select: none;\n        white-space: nowrap;\n      }\n      .").concat(this.cssPrefix,"-sources-toggle:hover { opacity: 0.7; }\n      .").concat(this.cssPrefix,"-sources-chevron {\n        font-size: 7px;\n        display: inline-block;\n        transition: transform 0.2s;\n      }\n      .").concat(this.cssPrefix,"-sources-toggle.is-open .").concat(this.cssPrefix,"-sources-chevron {\n        transform: rotate(180deg);\n      }\n      .").concat(this.cssPrefix,"-sources-list {\n        margin: 6px 0 0 !important;\n        padding: 0 !important;\n        flex-direction: column !important;\n        gap: 4px !important;\n      }\n      .").concat(this.cssPrefix,'-sources-list[data-open="false"] {\n        display: none !important;\n      }\n      .').concat(this.cssPrefix,'-sources-list[data-open="true"] {\n        display: flex !important;\n      }\n      .').concat(this.cssPrefix,"-source {\n        display: block !important;\n        font-size: 12px !important;\n        color: #555 !important;\n        padding: 6px 8px !important;\n        background: rgba(0,0,0,0.04) !important;\n        border-radius: 6px !important;\n        border-left: 2px solid ").concat(s," !important;\n        white-space: normal !important;\n        word-break: break-word !important;\n        line-height: 1.4 !important;\n        visibility: visible !important;\n        opacity: 1 !important;\n        height: auto !important;\n        overflow: visible !important;\n      }\n\n      /* ì œì•ˆ ì§ˆë¬¸ */\n      .").concat(this.cssPrefix,"-suggestions {\n        margin-top: 12px;\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .").concat(this.cssPrefix,"-suggestion {\n        background: #F8F8F8;\n        border: 1px solid #E5E5E5;\n        border-radius: 16px;\n        padding: 6px 12px;\n        font-size: 13px;\n        cursor: pointer;\n        transition: all 0.2s;\n      }\n\n      .").concat(this.cssPrefix,"-suggestion:hover {\n        background: ").concat(s,";\n        color: white;\n        border-color: ").concat(s,";\n      }\n\n      .").concat(this.cssPrefix,"-disclaimer {\n        text-align: center;\n        padding: 6px 12px;\n        margin: 4px 0 12px;\n        font-size: 11px;\n        color: #999;\n        background: #f5f5f5;\n        border-radius: 8px;\n        line-height: 1.5;\n      }\n    "),r=document.createElement("style");r.id=n,r.textContent=a,document.head.appendChild(r)}createDOM(){this.elements.container=document.createElement("div"),this.elements.container.className="".concat(this.cssPrefix,"-container position-").concat(this.config.position),this.elements.button=document.createElement("button"),this.elements.button.className="".concat(this.cssPrefix,"-button"),this.elements.button.innerHTML=this.getChatIcon(),this.elements.button.setAttribute("aria-label","ì±„íŒ… ì—´ê¸°"),this.elements.welcomeBubble=document.createElement("div"),this.elements.welcomeBubble.className="".concat(this.cssPrefix,"-welcome-bubble"),this.elements.welcomeBubble.innerHTML='<div class="'.concat(this.cssPrefix,'-welcome-bubble-text">ê²€ì§„ ê²°ê³¼ í™•ì¸í•˜ê¸° âœ¨</div>'),this.elements.window=document.createElement("div"),this.elements.window.className="".concat(this.cssPrefix,"-window");const n=document.createElement("div");n.className="".concat(this.cssPrefix,"-header"),n.innerHTML='\n      <h3>MediArc</h3>\n      <button class="'.concat(this.cssPrefix,'-close-button" aria-label="ì±„íŒ… ë‹«ê¸°">Ã—</button>\n    '),this.elements.messagesContainer=document.createElement("div"),this.elements.messagesContainer.className="".concat(this.cssPrefix,"-messages");const t=document.createElement("div");t.className="".concat(this.cssPrefix,"-input-area"),this.elements.input=document.createElement("textarea"),this.elements.input.className="".concat(this.cssPrefix,"-input"),this.elements.input.placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”...",this.elements.input.rows=1,this.elements.sendButton=document.createElement("button"),this.elements.sendButton.className="".concat(this.cssPrefix,"-send-button"),this.elements.sendButton.innerHTML=this.getSendIcon(),this.elements.sendButton.setAttribute("aria-label","ë©”ì‹œì§€ ì „ì†¡"),t.appendChild(this.elements.input),t.appendChild(this.elements.sendButton),this.elements.window.appendChild(n),this.elements.window.appendChild(this.elements.messagesContainer),this.elements.window.appendChild(t),this.elements.container.appendChild(this.elements.welcomeBubble),this.elements.container.appendChild(this.elements.button),this.elements.container.appendChild(this.elements.window),document.body.appendChild(this.elements.container)}bindEvents(){this.elements.button.addEventListener("click",()=>{this.state.isOpen?this.close():this.open()}),this.elements.welcomeBubble.addEventListener("click",()=>{this.open(),this.elements.welcomeBubble.classList.remove("visible")}),this.elements.window.querySelector(".".concat(this.cssPrefix,"-close-button")).addEventListener("click",()=>this.close()),this.elements.sendButton.addEventListener("click",()=>this.sendMessage()),this.elements.input.addEventListener("keydown",n=>{"Enter"!==n.key||n.shiftKey||(n.preventDefault(),this.sendMessage())}),this.elements.input.addEventListener("input",()=>{this.elements.input.style.height="auto",this.elements.input.style.height=Math.min(this.elements.input.scrollHeight,100)+"px"}),document.addEventListener("click",n=>{this.state.isOpen&&this.elements.container.contains(n.target)}),window.innerWidth<=480&&window.visualViewport&&(this._handleViewportResize=()=>{if(!this.state.isOpen)return;const n=window.visualViewport.height;window.innerHeight-n>50?(this.elements.window.style.height="".concat(n,"px"),this.elements.window.style.top="".concat(window.visualViewport.offsetTop,"px"),this.scrollToBottom()):(this.elements.window.style.height="",this.elements.window.style.top="")},window.visualViewport.addEventListener("resize",this._handleViewportResize),window.visualViewport.addEventListener("scroll",this._handleViewportResize)),this.elements.input.addEventListener("focus",()=>{setTimeout(()=>this.scrollToBottom(),300)})}open(){this.state.isOpen||(this.state.isOpen=!0,this.elements.window.classList.add("open"),this.elements.container.classList.add("is-open"),this.elements.button.classList.add("active"),this.elements.button.innerHTML=this.getCloseIcon(),this.elements.welcomeBubble&&this.elements.welcomeBubble.classList.remove("visible"),window.innerWidth<=480&&(this._prevBodyOverflow=document.body.style.overflow,document.body.style.overflow="hidden"),setTimeout(()=>{this.elements.input.focus()},300),this.config.onOpen&&this.config.onOpen())}close(){this.state.isOpen&&(this.state.isOpen=!1,this.elements.window.classList.remove("open"),this.elements.container.classList.remove("is-open"),this.elements.button.classList.remove("active"),this.elements.button.innerHTML=this.getChatIcon(),window.innerWidth<=480&&(document.body.style.overflow=this._prevBodyOverflow||"",this.elements.window.style.height="",this.elements.window.style.top=""),this.config.onClose&&this.config.onClose())}async sendMessage(){const n=this.elements.input.value.trim();if(n&&!this.state.isLoading)try{this.addMessage("user",n),this.elements.input.value="",this.elements.input.style.height="auto",this.setLoading(!0),await this.callPartnerAPI(n)}catch(n){console.error("[WelnoRagChatWidget] ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨:",n),"AbortError"===n.name?this.handleError("ì‘ë‹µ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",n):this.handleError("ë©”ì‹œì§€ ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",n)}finally{this.setLoading(!1)}}async callPartnerAPI(n){const t={uuid:this.config.uuid,hospital_id:this.config.hospitalId,message:n,session_id:this.state.sessionId},e=new AbortController,s=setTimeout(()=>e.abort(),3e4),i=await fetch("".concat(this.config.baseUrl,"/welno-api/v1/rag-chat/partner/message"),{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":this.config.apiKey},body:JSON.stringify(t),signal:e.signal});if(clearTimeout(s),!i.ok){const n=await i.json().catch(()=>({}));throw new Error(n.detail||"HTTP ".concat(i.status,": ").concat(i.statusText))}await this.handleStreamingResponse(i)}async handleStreamingResponse(n){const t=n.body.getReader(),e=new TextDecoder;let s="",i="",o=null;const a=n=>{if(n.startsWith("data: "))try{const t=JSON.parse(n.slice(6));t.answer&&(i+=t.answer,o||(o=this.addMessage("assistant","")),this.updateMessageContent(o,i)),t.done&&(t.sources&&t.sources.length>0&&this.addSources(o,t.sources),t.suggestions&&t.suggestions.length>0&&this.addSuggestions(o,t.suggestions),this.state.assistantMsgCount++,1===this.state.assistantMsgCount&&this.addDisclaimer())}catch(t){console.error("[WelnoWidget] SSE íŒŒì‹± ì—ëŸ¬:",t.message,"| line:",n.substring(0,200))}};try{for(;;){const{done:n,value:i}=await t.read();if(n)break;s+=e.decode(i,{stream:!0});const o=s.split("\n");s=o.pop()||"";for(const n of o)a(n.trim())}s.trim()&&a(s.trim())}finally{t.releaseLock()}}_renderMessageHtml(n){if(null==n||""===n)return"";for(var t=String(n).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),e=(t=t.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>")).split("\n"),s=[],i=!1,o=!1,a=0;a<e.length;a++){var r=e[a],c=r.match(/^\s*[*\-]\s+(.+)$/),l=c?null:r.match(/^\s*(\d+)[.)]\s+(.+)$/);c?(o&&(s.push("</ol>"),o=!1),i||(s.push("<ul>"),i=!0),s.push("<li>"+c[1]+"</li>")):l?(i&&(s.push("</ul>"),i=!1),o||(s.push("<ol>"),o=!0),s.push("<li>"+l[2]+"</li>")):(i&&(s.push("</ul>"),i=!1),o&&(s.push("</ol>"),o=!1),""===r.trim()?s.push("<br>"):s.push(r+"<br>"))}return i&&s.push("</ul>"),o&&s.push("</ol>"),s.join("")}addMessage(n,t){const e=document.createElement("div");e.className="".concat(this.cssPrefix,"-message ").concat(n);const s=document.createElement("div");s.className="".concat(this.cssPrefix,"-message-bubble"),s.innerHTML=this._renderMessageHtml(t);const i=document.createElement("div");i.className="".concat(this.cssPrefix,"-message-footer");const o=document.createElement("div");o.className="".concat(this.cssPrefix,"-message-footer-row");const a=document.createElement("div");return a.className="".concat(this.cssPrefix,"-message-time"),a.textContent=(new Date).toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit"}),o.appendChild(a),i.appendChild(o),e.appendChild(s),e.appendChild(i),this.elements.messagesContainer.appendChild(e),this.scrollToBottom(),this.state.messages.push({role:n,content:t,timestamp:(new Date).toISOString()}),this.config.onMessage&&this.config.onMessage({role:n,content:t}),e}updateMessageContent(n,t){n.querySelector(".".concat(this.cssPrefix,"-message-bubble")).innerHTML=this._renderMessageHtml(t),this._scrollRAF||(this._scrollRAF=requestAnimationFrame(()=>{this._scrollRAF=null;const n=this.elements.messagesContainer;n&&n.scrollHeight-n.scrollTop-n.clientHeight<80&&(n.scrollTop=n.scrollHeight)}))}addSources(n,t){if(!t||0===t.length)return;if(!n)return;const e=this.cssPrefix,s=document.createElement("span");s.setAttribute("role","button"),s.setAttribute("tabindex","0"),s.className="".concat(e,"-sources-toggle"),s.innerHTML='<span>ì°¸ê³  ë¬¸í—Œ</span><span class="'.concat(e,'-sources-chevron" aria-hidden="true">â–¼</span>');const i=document.createElement("div");i.className="".concat(e,"-sources-list"),i.setAttribute("data-open","true"),s.classList.add("is-open"),t.forEach(n=>{const t=document.createElement("div");t.className="".concat(e,"-source");let s="";n.category?s+="[".concat(n.category,"] "):"hospital"===n.source_type&&(s+="[ë³‘ì› ìë£Œ] "),s+=n.title||"ì°¸ê³ ìë£Œ",n.page&&(s+=" (p.".concat(n.page,")")),t.textContent=s,t.title=(n.text||"").substring(0,200),i.appendChild(t)}),s.onclick=function(n){n.preventDefault(),n.stopPropagation();var t="true"===i.getAttribute("data-open");return i.setAttribute("data-open",t?"false":"true"),s.classList.toggle("is-open"),!1};const o=n.querySelector(".".concat(e,"-message-footer-row")),a=n.querySelector(".".concat(e,"-message-footer"));o&&o.appendChild(s),a?a.appendChild(i):n.appendChild(i);const r=n.querySelector(".".concat(e,"-message-bubble"));r&&a&&(a.style.width=r.offsetWidth+"px")}addSuggestions(n,t){if(!t||0===t.length)return;const e=document.createElement("div");e.className="".concat(this.cssPrefix,"-suggestions"),t.slice(0,3).forEach(n=>{const t=document.createElement("button");t.className="".concat(this.cssPrefix,"-suggestion"),t.textContent=n,t.addEventListener("click",()=>{this.elements.input.value=n,this.elements.input.focus()}),e.appendChild(t)}),n.appendChild(e)}addDisclaimer(){const n=document.createElement("div");n.className="".concat(this.cssPrefix,"-disclaimer"),n.textContent="ë³¸ ì„œë¹„ìŠ¤ëŠ” ì°¸ê³ ìš©ì´ë©°, ì˜í•™ì  ìë¬¸ì´ë‚˜ ì§„ë‹¨ì„ ëŒ€ì²´í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. í•„ìš”ì‹œ ì „ë¬¸ ì˜ë£Œì§„ê³¼ ìƒë‹´í•˜ì„¸ìš”.",this.elements.messagesContainer.appendChild(n),this.scrollToBottom()}setLoading(n){if(this.state.isLoading=n,this.elements.sendButton.disabled=n,n){const n=document.createElement("div");n.className="".concat(this.cssPrefix,"-loading-wrap"),n.id="loading-indicator",n.innerHTML='\n        <div class="'.concat(this.cssPrefix,'-loading-dots">\n          <div class="').concat(this.cssPrefix,'-loading-dot"></div>\n          <div class="').concat(this.cssPrefix,'-loading-dot"></div>\n          <div class="').concat(this.cssPrefix,'-loading-dot"></div>\n        </div>\n      '),this.elements.messagesContainer.appendChild(n),this.scrollToBottom()}else{const n=document.getElementById("loading-indicator");n&&n.remove()}}scrollToBottom(){requestAnimationFrame(()=>{const n=this.elements.messagesContainer;n&&n.scrollTo({top:n.scrollHeight,behavior:"smooth"})})}handleError(n,t){console.error("[WelnoRagChatWidget] ì—ëŸ¬:",t),this.addMessage("assistant","ì£„ì†¡í•©ë‹ˆë‹¤. ".concat(n)),this.config.onError&&this.config.onError(t)}getChatIcon(){const n="".concat(this.cssPrefix,"-icon-slot");return this.config.chatIconUrl?'<span class="'.concat(n,'"><img src="').concat(this.config.chatIconUrl,'" alt="ì±„íŒ… ì—´ê¸°" /></span>'):'\n      <span class="'.concat(n,'">\n        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">\n          <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n        </svg>\n      </span>\n    ')}getCloseIcon(){return'\n      <svg width="24" height="24" viewBox="0 0 24 24" fill="none">\n        <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>\n      </svg>\n    '}getSendIcon(){return'\n      <svg width="16" height="16" viewBox="0 0 24 24" fill="none">\n        <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n      </svg>\n    '}async warmup(){if(this.config.partnerData)try{const n=await fetch("".concat(this.config.baseUrl,"/welno-api/v1/rag-chat/partner/warmup"),{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":this.config.apiKey},body:JSON.stringify({uuid:this.config.uuid,hospital_id:this.config.hospitalId,health_data:this.config.partnerData})});if(n.ok){const t=await n.json();if(t.session_id&&(this.state.sessionId=t.session_id),t.greeting){const n=(t.greeting||"").replace(/<br\s*\/?>/gi," ").replace(/\s+/g," ").trim();this.elements.welcomeBubble.querySelector(".".concat(this.cssPrefix,"-welcome-bubble-text")).textContent=n,setTimeout(()=>{this.state.isOpen||this.elements.welcomeBubble.classList.add("visible")},1e3)}}}catch(n){console.warn("[WelnoRagChatWidget] ì›œì—… ì‹¤íŒ¨:",n)}}destroy(){this._handleViewportResize&&window.visualViewport&&(window.visualViewport.removeEventListener("resize",this._handleViewportResize),window.visualViewport.removeEventListener("scroll",this._handleViewportResize)),window.innerWidth<=480&&(document.body.style.overflow=this._prevBodyOverflow||""),this.elements.container&&this.elements.container.parentNode&&this.elements.container.parentNode.removeChild(this.elements.container);const n=document.getElementById("".concat(this.cssPrefix,"-styles"));n&&!document.querySelector(".".concat(this.cssPrefix,"-container"))&&n.remove(),this.state.isInitialized=!1}}n.exports?(n.exports=o,n.exports.default=o):void 0===(e=function(){return o}.apply(t,[]))||(n.exports=e)}},t={},function e(s){var i=t[s];if(void 0!==i)return i.exports;var o=t[s]={exports:{}};return n[s](o,o.exports,e),o.exports}(803).default;var n,t});